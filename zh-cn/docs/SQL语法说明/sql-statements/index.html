<!DOCTYPE HTML>
<html lang="en,zh-cn,default">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="SQL Statements, ByConity keywords">
    <meta name="description" content="theme.home.header.description">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>SQL Statements | ByConity</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByConity" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ByConity</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/zh-cn/docs" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Docs</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a target="_blank" rel="noopener" href="https://github.com/byconity" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>Community</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ByConity</div>
        <div class="logo-desc">
            
            theme.home.header.description
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/zh-cn/docs" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Docs
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a target="_blank" rel="noopener" href="https://github.com/byconity" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			Community
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/byConity" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Contribute with us
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/byConity" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Contribute with us" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/banner/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">SQL Statements</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Docs/">
                                <span class="chip bg-color">Docs</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Docs/" class="post-category">
                                Docs
                            </a>
                        
                            <a href="/categories/Docs/SQL-Syntax/" class="post-category">
                                SQL_Syntax
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2023-01-18
                </div>
                

                

                

                

                
                
                <div class="info-break-policy">
                    
                    <style>
                        .github-edit-link {
                            padding: 0 2px;
                            color: #42b983;
                            font-weight: 500;
                            text-decoration: underline;
                            word-wrap: break-word;
                        }
                    </style>
                    <a class="github-edit-link" href="https://github.com/byConity/byconity.github.io/edit/main/source/_posts/zh-cn/docs/SQL%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E/sql-statements.md" target="_blank">
                        <i class="far fa-edit fa-fw"></i>Edit post
                    </a>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>The supported statements in ByteHouse are similar to ClickHouse, but it is still recommended to follow the ByteHouse manual to ensure proper use. Some of the examples below are referenced from <a target="_blank" rel="noopener" href="https://clickhouse.tech/docs/en/sql-reference/statements/">ClickHouse Documentation</a> but have been adapted and modified to work in ByteHouse.<br>[block:callout]<br>{<br>  “type”: “info”,<br>  “body”: “Symbols between token [] are optional. For example [IF NOT EXISTS]\nToken | means or\nToken … means can repeat more times”,<br>  “title”: “Note”<br>}<br>[&#x2F;block]</p>
<h2 id="Alter-Statement"><a href="#Alter-Statement" class="headerlink" title="Alter Statement"></a>Alter Statement</h2><h3 id="ADD-COLUMN"><a href="#ADD-COLUMN" class="headerlink" title="ADD COLUMN"></a>ADD COLUMN</h3><p>Adds a new column to the table.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] [tableColumnDfnt] [AFTER name_after]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>IF NOT EXISTS</code> clause is included, the query won’t return an error if the column already exists. </p>
</li>
<li><p><code>AFTER name_after</code> (the name of another column), the column is added after the specified one in the list of table columns.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> db_name.table_name</span><br><span class="line">(</span><br><span class="line">    `order_by_column ` String</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column `)</span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: <span class="keyword">add</span> <span class="keyword">column</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> db_name.table_name <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> column_name String COMMENT <span class="string">&#x27;column comment here&#x27;</span> AFTER order_by_column</span><br></pre></td></tr></table></figure>
<h3 id="MODIFY-COLUMN"><a href="#MODIFY-COLUMN" class="headerlink" title="MODIFY COLUMN"></a>MODIFY COLUMN</h3><p>** Syntax**</p>
<p>Modify Column</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] MODIFY <span class="keyword">COLUMN</span> [IF <span class="keyword">EXISTS</span>] [tableColumnDfnt] </span><br></pre></td></tr></table></figure>
<p>If the modify column is:</p>
<ul>
<li><p>Order by column: can modify its default_expr, comment, codec. </p>
</li>
<li><p>Partition by column: can modify its comment. </p>
</li>
<li><p>Normal column: can modify itstype, default_expr, comment, codec.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> db_name.table_name</span><br><span class="line">(</span><br><span class="line">    `order_by_column ` String,</span><br><span class="line">    `normal_column` Int64 <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column `)</span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: modify <span class="keyword">column</span> normal_column_name <span class="operator">&amp;</span> <span class="keyword">update</span> its data type, comment <span class="keyword">and</span> <span class="keyword">default</span> <span class="keyword">value</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> db_name.table_name MODIFY <span class="keyword">COLUMN</span> IF <span class="keyword">EXISTS</span> normal_column String <span class="keyword">DEFAULT</span> <span class="string">&#x27;new_default_value&#x27;</span> COMMENT <span class="string">&#x27;new comment&#x27;</span> </span><br></pre></td></tr></table></figure>
<h3 id="DROP-COLUMN"><a href="#DROP-COLUMN" class="headerlink" title="DROP COLUMN"></a>DROP COLUMN</h3><p>Deletes a column in the table. Partition by columns and order by columns are not allowed to drop.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> [IF <span class="keyword">EXISTS</span>] column_name;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>IF EXISTS</code> clause is specified, the query won’t return an error if the column does not exist.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> db_name.table_name</span><br><span class="line">(</span><br><span class="line">    `order_by_column` String,</span><br><span class="line">    `normal_column` Int64</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column`)</span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: <span class="keyword">drop</span> the normal <span class="keyword">column</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> db_name.table_name <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> IF <span class="keyword">EXISTS</span> normal_column</span><br></pre></td></tr></table></figure>
<h3 id="RENAME-COLUMN"><a href="#RENAME-COLUMN" class="headerlink" title="RENAME COLUMN"></a>RENAME COLUMN</h3><p>Rename a column in the table. There are some usage notes:</p>
<ul>
<li><p>Cannot rename column to an existing column. </p>
</li>
<li><p>Cannot rename column to itself. </p>
</li>
<li><p>Rename from column must exists.</p>
</li>
</ul>
<p>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] RENAME <span class="keyword">COLUMN</span> [IF <span class="keyword">EXISTS</span>] column_name_from <span class="keyword">TO</span> column_name_to;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>IF EXISTS</code> clause is specified, the query won’t return an error if the column does not exist.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> db_name.table_name</span><br><span class="line">(</span><br><span class="line">    `order_by_column` String,</span><br><span class="line">    `old_column_name` Int64</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`old_column_name`)</span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: rename <span class="keyword">column</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> db_name.table_name RENAME <span class="keyword">COLUMN</span> old_column_name <span class="keyword">TO</span> new_column_name</span><br></pre></td></tr></table></figure>
<h3 id="ADD-CONSTRAINT"><a href="#ADD-CONSTRAINT" class="headerlink" title="ADD CONSTRAINT"></a>ADD CONSTRAINT</h3><p>Adds a constraint to the table.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] constraint_name <span class="keyword">CHECK</span> columnExpr;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>IF NOT EXISTS</code> clause is included, the query won’t return an error if the constraint already exists.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `order_by_column` String</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column`)</span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: <span class="keyword">add</span> <span class="keyword">constraint</span> check_str</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> example_table <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> check_str <span class="keyword">CHECK</span> order_by_column <span class="operator">!=</span> <span class="string">&#x27;forbidden_string&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="DROP-CONSTRAINT"><a href="#DROP-CONSTRAINT" class="headerlink" title="DROP CONSTRAINT"></a>DROP CONSTRAINT</h3><p>Deletes a constraint to the table.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> [IF <span class="keyword">EXISTS</span>] constraint_name;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>IF EXISTS</code> clause is specified, the query won’t return an error if the constraint does not exist.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span> <span class="keyword">with</span> the <span class="keyword">constraint</span> check_str</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `order_by_column` String,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> check_str <span class="keyword">CHECK</span> order_by_column <span class="operator">!=</span> <span class="string">&#x27;forbidden_string&#x27;</span></span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column`)</span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: <span class="keyword">drop</span> <span class="keyword">constraint</span> check_str</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> example_table <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> IF <span class="keyword">EXISTS</span> check_str</span><br></pre></td></tr></table></figure>
<h3 id="MODIFYTTL"><a href="#MODIFYTTL" class="headerlink" title="MODIFYTTL"></a>MODIFYTTL</h3><p>Change table TTL. Columns used in ttl Clause must be in partition by columns.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] MODIFY [ttlClause];</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span> <span class="keyword">with</span> <span class="keyword">table</span> TTL <span class="keyword">to</span> be <span class="number">1</span> <span class="keyword">day</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `d` DateTime</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> d</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> `d`</span><br><span class="line">TTL d <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span></span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: modify <span class="keyword">table</span> ttl <span class="operator">&amp;</span> change the TTL <span class="keyword">to</span> <span class="number">2</span> <span class="keyword">month</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> example_table</span><br><span class="line">    MODIFY TTL d <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">2</span> <span class="keyword">MONTH</span></span><br></pre></td></tr></table></figure>
<h3 id="REMOVETTL"><a href="#REMOVETTL" class="headerlink" title="REMOVETTL"></a>REMOVETTL</h3><p>Remove table TTL.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> [tableIdentifier] REMOVE TTL;</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span> <span class="keyword">with</span> <span class="keyword">table</span> TTL <span class="keyword">to</span> be <span class="number">1</span> <span class="keyword">day</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `d` DateTime</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> d</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> d</span><br><span class="line">TTL d <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span></span><br><span class="line"></span><br><span class="line"># Step <span class="number">2</span>: remove <span class="keyword">table</span> ttl</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> example_table</span><br><span class="line">    REMOVE TTL</span><br></pre></td></tr></table></figure>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="AST-Statement"><a href="#AST-Statement" class="headerlink" title="AST Statement"></a>AST Statement</h2><p>Shows the execution plan of a statement. Dumps the query AST.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AST query</span><br></pre></td></tr></table></figure>
<p><strong>Output</strong></p>
<table>
<thead>
<tr>
<th><strong>Column</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody><tr>
<td>explain</td>
<td>The parsedASTof the statement</td>
</tr>
</tbody></table>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AST <span class="keyword">SELECT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Explain ParsedAST (children 1)</span><br><span class="line"> SelectWithUnionQuery (children 1)</span><br><span class="line"> ExpressionList (children 1)</span><br><span class="line">  SelectQuery (children 1)</span><br><span class="line">  ExpressionList (children 1)</span><br><span class="line">   Literal UInt64_1</span><br></pre></td></tr></table></figure>
<h2 id="Create-Statement"><a href="#Create-Statement" class="headerlink" title="Create Statement"></a>Create Statement</h2><h3 id="CREATE-DATABASE"><a href="#CREATE-DATABASE" class="headerlink" title="CREATE DATABASE"></a>CREATE DATABASE</h3><p>Creates a new database<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] [databaseIdentifier] [ENGINE<span class="operator">=</span>Cnch]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>IF NOT EXISTS</code> : query won’t return an error if the database already exists.</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Create database with default database engine.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Create database with optional engine clause. Currently only Cnch engine is allowed.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test ENGINE<span class="operator">=</span>Cnch;</span><br></pre></td></tr></table></figure>
<h3 id="CREATE-TABLE"><a href="#CREATE-TABLE" class="headerlink" title="CREATE TABLE"></a>CREATE TABLE</h3><p>Creates a new table.</p>
<h4 id="Create-Table-With-Explicit-Schema"><a href="#Create-Table-With-Explicit-Schema" class="headerlink" title="Create Table With Explicit Schema"></a>Create Table With Explicit Schema</h4><p>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] [tableIdentifier] [UUID uuid]</span><br><span class="line">(</span><br><span class="line">    [tableColumnDfnt],</span><br><span class="line">    [<span class="keyword">CONSTRAINT</span> constraint_name <span class="keyword">CHECK</span> columnExpr,]</span><br><span class="line">    ...</span><br><span class="line">) [engineClause]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>IF NOT EXISTS</code> : query won’t return an error if the table already exists. </p>
</li>
<li><p><code>UUID</code> : table will have an uuid provided by user. Otherwise, a generated uuid will be used. </p>
</li>
<li><p><code>[CONSTRAINT constraint_name CHECK columnExpr]</code> : add a constraint to table. </p>
<ul>
<li><p>columnExpr after <code>CHECK</code> should be a boolean expression. </p>
</li>
<li><p>If constraints are checked for every row in <code>INSERT</code> query. Exception will be raised if any constraint is not satisfied. </p>
</li>
<li><p>Adding large amount of constraints can negatively affect performance of big <code>INSERT</code> queries.</p>
</li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Create Table</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.createTable(</span><br><span class="line">    id UInt32,</span><br><span class="line">    name String <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> constraint1 <span class="keyword">CHECK</span> id <span class="operator">&gt;</span> <span class="number">10</span></span><br><span class="line">) </span><br><span class="line">ENGINE<span class="operator">=</span>CnchMergeTree</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br></pre></td></tr></table></figure>
<h3 id="CREATE-VIEW"><a href="#CREATE-VIEW" class="headerlink" title="CREATE VIEW"></a>CREATE VIEW</h3><h4 id="CREATE-NORMAL-VIEW"><a href="#CREATE-NORMAL-VIEW" class="headerlink" title="CREATE NORMAL VIEW"></a>CREATE NORMAL VIEW</h4><p>Normal views don’t store any data. They just perform a read from another table on each access. In other words, a normal view is nothing more than a saved query. When reading from a view, this saved query is used as a subquery in the FROM clause.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> REPLACE] <span class="keyword">VIEW</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] [tableIdentifier] [UUID uuid] <span class="keyword">AS</span> [selectUnionStmt]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>OR REPLACE</code> is included, ByteHouse will create a new view and replace the old view with the same name. </p>
</li>
<li><p><code>IF NOT EXISTS</code> clause is included, the query won’t return an error if the table already exists. </p>
</li>
<li><p><code>UUID</code> is specified, table will have an uuid provided by user. Otherwise, a generated uuid will be used.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `order_by_column` String</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column`)</span><br><span class="line"></span><br><span class="line"># step <span class="number">2</span>: <span class="keyword">create</span> a <span class="keyword">view</span> based <span class="keyword">on</span> the created <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> example_view <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> example_table</span><br></pre></td></tr></table></figure>
<h2 id="Describe-Statement"><a href="#Describe-Statement" class="headerlink" title="Describe Statement"></a>Describe Statement</h2><p>Returns the columns definition of a table<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESC</span><span class="operator">|</span><span class="keyword">DESCRIBE</span> [<span class="keyword">TABLE</span>] [tableIdentifier]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> example_view</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>N</strong> <strong>ame</strong></th>
<th><strong>Type</strong></th>
<th><strong>DefaultType</strong></th>
<th><strong>DefaultExpression</strong></th>
<th><strong>Comment</strong></th>
<th><strong>CodecExpression</strong></th>
<th><strong>TTLExpression</strong></th>
<th><strong>LastQueriedAt</strong></th>
<th><strong>LastQueriedBy</strong></th>
</tr>
</thead>
<tbody><tr>
<td>order_by_column</td>
<td>String</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="Explain-Statement"><a href="#Explain-Statement" class="headerlink" title="Explain Statement"></a>Explain Statement</h2><h3 id="EXPLAIN-SYNTAX"><a href="#EXPLAIN-SYNTAX" class="headerlink" title="EXPLAIN SYNTAX"></a>EXPLAIN SYNTAX</h3><p>checks the syntax validity.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SYNTAX query</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SYNTAX <span class="keyword">SELECT</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th><strong>syntax_correct</strong></th>
<th><strong>syntax_message</strong></th>
<th><strong>has_join</strong></th>
<th><strong>has_asterisk</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td></td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<h2 id="Drop-Statement"><a href="#Drop-Statement" class="headerlink" title="Drop Statement"></a>Drop Statement</h2><h3 id="DROP-DATABASE"><a href="#DROP-DATABASE" class="headerlink" title="DROP DATABASE"></a>DROP DATABASE</h3><p>Deletes the Database.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE [IF <span class="keyword">EXISTS</span>] [databaseIdentifier]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">create</span> a database</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE example_db</span><br><span class="line"></span><br><span class="line"># <span class="keyword">drop</span> a database</span><br><span class="line"><span class="keyword">DROP</span> DATABASE example_db</span><br></pre></td></tr></table></figure>
<h3 id="DROP-TABLE"><a href="#DROP-TABLE" class="headerlink" title="DROP TABLE"></a>DROP TABLE</h3><p>Deletes the table.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> [IF <span class="keyword">EXISTS</span>] [tableIdentifier]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `order_by_column` String</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column`)</span><br><span class="line"></span><br><span class="line"># step <span class="number">2</span>: <span class="keyword">drop</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> example_table</span><br></pre></td></tr></table></figure>


<h2 id="Insert-Statement"><a href="#Insert-Statement" class="headerlink" title="Insert Statement"></a>Insert Statement</h2><p>Adds data into a table.</p>
<h3 id="INSERT-VALUES"><a href="#INSERT-VALUES" class="headerlink" title="INSERT VALUES"></a>INSERT VALUES</h3><p>Data can be inserted with this basic query format.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [<span class="keyword">TABLE</span>] [tableIdentifier] [columnsClause] <span class="keyword">VALUES</span></span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `a` Int8,</span><br><span class="line">    `b` String,</span><br><span class="line">    `c` <span class="type">Date</span></span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`a`)</span><br><span class="line"></span><br><span class="line"># step <span class="number">2</span>: <span class="keyword">insert</span> <span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">into</span> the <span class="keyword">table</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> example_table <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;2021-07-27&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;2021-07-27&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="INSERT-FORMAT"><a href="#INSERT-FORMAT" class="headerlink" title="INSERT FORMAT"></a>INSERT FORMAT</h3><p>Data can be passed to the INSERT in aformatsupported by ByteHouse.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [<span class="keyword">TABLE</span>] [tableIdentifier] [columnsClause] FORMAT format_name</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `a` Int8,</span><br><span class="line">    `b` String,</span><br><span class="line">    `c` <span class="type">Date</span></span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`a`) </span><br><span class="line"></span><br><span class="line"># step <span class="number">2</span>: <span class="keyword">insert</span> <span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">value</span> format <span class="keyword">into</span> the <span class="keyword">table</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> example_table FORMAT <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;2021-07-27&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;2021-07-27&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="INSERT-SELECT"><a href="#INSERT-SELECT" class="headerlink" title="INSERT SELECT"></a>INSERT SELECT</h3><p>Inserts the results of a SELECT query.  Columns are mapped according to their position in the SELECT clause. However, their names in the SELECT expression and the table for INSERT may differ. If necessary, typecasting is performed.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [<span class="keyword">TABLE</span>] [tableIdentifier] [columnsClause] [selectUnionStmt]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> example_table <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> example_table</span><br></pre></td></tr></table></figure>
<h3 id="INSERT-INFILE"><a href="#INSERT-INFILE" class="headerlink" title="INSERT INFILE"></a>INSERT INFILE</h3><p>Insert data to a table from a file.  gateway-client only<br>Supported file format:</p>
<ul>
<li><p>.csv </p>
</li>
<li><p>.json </p>
</li>
<li><p>.avro </p>
</li>
<li><p>.parquet</p>
</li>
</ul>
<p>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> [<span class="keyword">TABLE</span>] [tableIdentifier] [columnsClause] [FORMAT format_name] INFILE filepath</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> my_table FORMAT csvwithnames INFILE <span class="string">&#x27;/Users/my_name/Downloads/ETH-USD.csv&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="Rename-Statement"><a href="#Rename-Statement" class="headerlink" title="Rename Statement"></a>Rename Statement</h2><h3 id="RENAME-TABLE"><a href="#RENAME-TABLE" class="headerlink" title="RENAME TABLE"></a>RENAME TABLE</h3><p>Renames one or more tables.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> [tableIdentifier] <span class="keyword">TO</span> [tableIdentifier], [tableIdentifier] <span class="keyword">TO</span> [tableIdentifier]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `a` Int8,</span><br><span class="line">    `b` String,</span><br><span class="line">    `c` <span class="type">Date</span></span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`a`)</span><br><span class="line"></span><br><span class="line"># step <span class="number">2</span>: rename the <span class="keyword">new</span> created <span class="keyword">table</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> example_table <span class="keyword">to</span> new_table_name</span><br></pre></td></tr></table></figure>
<h2 id="Select-Union-Statement"><a href="#Select-Union-Statement" class="headerlink" title="Select Union Statement"></a>Select Union Statement</h2><p>SELECT query,  possibly with UNION ALL.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[selectStmt] [<span class="keyword">UNION</span> <span class="keyword">ALL</span> [selectStmt]...</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.example_table1 (column1 <span class="type">Date</span>, column2 UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> column1;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.example_table2 (column1 <span class="type">Date</span>, column2 UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> column1;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.example_table1 <span class="keyword">VALUES</span> (<span class="string">&#x27;2015-08-07&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.example_table2 <span class="keyword">VALUES</span> (<span class="string">&#x27;2015-08-08&#x27;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.example_table1 <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.example_table2;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th><strong>column1</strong></th>
<th><strong>column2</strong></th>
</tr>
</thead>
<tbody><tr>
<td>2015-08-07</td>
<td>1</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><strong>column1</strong></th>
<th><strong>column2</strong></th>
</tr>
</thead>
<tbody><tr>
<td>2015-08-08</td>
<td>2</td>
</tr>
</tbody></table>
<h2 id="Select-Statement"><a href="#Select-Statement" class="headerlink" title="Select Statement"></a>Select Statement</h2><p><code>SELECT</code> queries perform data retrieval from tables.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[withClause]</span><br><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>][columnExprList])</span><br><span class="line">[fromClause]</span><br><span class="line">[arrayJoinClause]</span><br><span class="line">[joinClause]</span><br><span class="line">[prewhereClause]</span><br><span class="line">[whereClause]</span><br><span class="line">[groupByClause]</span><br><span class="line">[havingClause]</span><br><span class="line">[orderByClause]</span><br><span class="line">[limitByClause]</span><br><span class="line">[limitClause]</span><br><span class="line">[settingsClause]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>DISTINCT</code> , only unique rows will remain in a query result. It works with NULL as if <code>NULL</code> were a specific value, and <code>NULL==NULL</code> . </p>
</li>
<li><p><code>Asterisk symbol (*)</code> , An asterisk can be put in any part of a query instead of an expression. When the query is analyzed, the asterisk is expanded to a list of all table columns (excluding the <code>MATERIALIZED</code> and <code>ALIAS</code> columns).</p>
</li>
</ul>
<h2 id="Set-Statement"><a href="#Set-Statement" class="headerlink" title="Set Statement"></a>Set Statement</h2><p>Set a list of settings for the current session.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> [settingExprList]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">set</span> virtual warehouse</span><br><span class="line"><span class="keyword">SET</span> WAREHOUSE your_warehouse_name</span><br><span class="line"></span><br><span class="line"># <span class="keyword">set</span> role</span><br><span class="line"><span class="keyword">SET</span> ROLE AccountAdmin</span><br><span class="line"></span><br><span class="line"># <span class="keyword">set</span> if <span class="keyword">to</span> choose ansi mode <span class="keyword">or</span> <span class="keyword">not</span></span><br><span class="line"><span class="keyword">SET</span> ansi_sql <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="Show-Statement"><a href="#Show-Statement" class="headerlink" title="Show Statement"></a>Show Statement</h2><h3 id="SHOW-DATABASES"><a href="#SHOW-DATABASES" class="headerlink" title="SHOW DATABASES"></a>SHOW DATABASES</h3><p>Prints a list of all databases. The command does not require a running warehouse to execute.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASES</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong>s</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASES</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>CreatedAt</strong></th>
<th><strong>CreatedBy</strong></th>
<th><strong>UpdatedAt</strong></th>
<th><strong>UpdatedBy</strong></th>
<th><strong>LastQueriedAt</strong></th>
<th><strong>LastQueriedBy</strong></th>
<th><strong>Comments</strong></th>
<th><strong>Engine</strong></th>
</tr>
</thead>
<tbody><tr>
<td>db_name1</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>comment here</td>
<td></td>
</tr>
<tr>
<td>db_name2</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>comment here</td>
<td></td>
</tr>
</tbody></table>
<h3 id="SHOW-TABLES"><a href="#SHOW-TABLES" class="headerlink" title="SHOW TABLES"></a>SHOW TABLES</h3><p>Displays a list of tables. The command does not require a running warehouse to execute.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TABLES [<span class="keyword">FROM</span> [databaseIdentifier] [<span class="keyword">LIKE</span> STRING_LITERAL]</span><br></pre></td></tr></table></figure>
<p>If the <code>FROM</code> clause is not specified, the query returns the list of tables from the current database.<br><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TABLES <span class="keyword">FROM</span> my_db <span class="keyword">LIKE</span> <span class="string">&#x27;%table&#x27;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>CreatedAt</strong></th>
<th><strong>CreatedBy</strong></th>
<th><strong>UpdatedAt</strong></th>
<th><strong>UpdatedBy</strong></th>
<th><strong>LastQueriedAt</strong></th>
<th><strong>LastQueriedBy</strong></th>
<th><strong>Type</strong></th>
<th><strong>HasUniqueKey</strong></th>
</tr>
</thead>
<tbody><tr>
<td>sells_table</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>TABLE</td>
<td>0</td>
</tr>
<tr>
<td>view_table</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>1627366525</td>
<td>123456</td>
<td>VIEW</td>
<td>0</td>
</tr>
</tbody></table>
<h3 id="SHOW-CREATE-TABLE"><a href="#SHOW-CREATE-TABLE" class="headerlink" title="SHOW CREATE TABLE"></a>SHOW CREATE TABLE</h3><p>Display table create sql<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> [<span class="keyword">TABLE</span>] [tableIdentifier]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># step <span class="number">1</span>: <span class="keyword">create</span> a <span class="keyword">table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `example_table`</span><br><span class="line">(</span><br><span class="line">    `order_by_column` String</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> `CnchMergeTree`</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (`order_by_column`)</span><br><span class="line"></span><br><span class="line"># step <span class="number">2</span>: <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> example_table</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Query</th>
</tr>
</thead>
<tbody><tr>
<td><code>CREATE TABLE </code>example_db<code>.</code>example_table<code>COMMENT &#39;&#39;,(,   </code>order_by_column<code> String,),ENGINE=</code>CnchMergeTree<code>,PRIMARY KEY </code>order_by_column<code>,ORDER BY </code>order_by_column<code>;</code></td>
</tr>
</tbody></table>
<h2 id="Truncate-Statement"><a href="#Truncate-Statement" class="headerlink" title="Truncate Statement"></a>Truncate Statement</h2><p>Removes all data from a table.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> [IF <span class="keyword">EXISTS</span>] [tableIdentifier]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> example_table</span><br></pre></td></tr></table></figure>
<h2 id="Use-Statement"><a href="#Use-Statement" class="headerlink" title="Use Statement"></a>Use Statement</h2><p>Sets the current database for the session. The current database is used for searching for tables if the database is not explicitly defined in the query with a dot before the table name.<br>Note: This query can’t be made when using the HTTP protocol, since there is no concept of a session.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE [databaseIdentifier];</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE example_db</span><br></pre></td></tr></table></figure>
<h2 id="Database-Identifier"><a href="#Database-Identifier" class="headerlink" title="Database Identifier"></a>Database Identifier</h2><p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database_name</span><br></pre></td></tr></table></figure>
<ul>
<li>database_name: String. Name of the database.</li>
</ul>
<h2 id="Table-Identifier"><a href="#Table-Identifier" class="headerlink" title="Table Identifier"></a>Table Identifier</h2><p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[database_name.]table_name</span><br></pre></td></tr></table></figure>
<ul>
<li><p>database_name: String. Name of the database. </p>
</li>
<li><p>table_name: String. Name of the table. </p>
</li>
<li><p>If database_name is not provided, current database will be used.</p>
</li>
</ul>
<h2 id="Table-Column-Definition"><a href="#Table-Column-Definition" class="headerlink" title="Table Column Definition"></a>Table Column Definition</h2><p>Column definition</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column_name column_type [tableColumnPropertyExpr] [COMMENT comment] [codecExpr]</span><br><span class="line">column_name [column_type] [tableColumnPropertyExpr] [COMMENT comment] [codecExpr]</span><br></pre></td></tr></table></figure>
<ul>
<li>If column_type is not explicit declared, [tableColumnPropertyExpr] must be provided for column type inference.</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Column with explicit type</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id UInt32</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Column with inexplicit type but type can be inferred from [tableColumnPropertyExpr] .</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id <span class="keyword">DEFAULT</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Column with comment</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id UInt32 COMMENT <span class="string">&#x27;id&#x27;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Column with codec</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id UInt32 CODEC(LZ4)</span><br></pre></td></tr></table></figure>
<h2 id="Table-Column-Property-Expression"><a href="#Table-Column-Property-Expression" class="headerlink" title="Table Column Property Expression"></a>Table Column Property Expression</h2><p>Column properties.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DEFAULT</span> [columnExpr]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>DEFAULT columnExpr</code> : Normal default value. If the INSERT query doesn’t specify the corresponding column, it will be filled in by computing the corresponding expression.</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Column with default expression</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id UInt32 <span class="keyword">DEFAULT</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="Setting-Expression-List"><a href="#Setting-Expression-List" class="headerlink" title="Setting Expression List"></a>Setting Expression List</h2><p><strong>Syntax</strong></p>
<p>settingExprList</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">settingExpr [,settingExpr]...</span><br></pre></td></tr></table></figure>
<p>settingExpr</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setting_name<span class="operator">=</span>setting_val</span><br></pre></td></tr></table></figure>
<ul>
<li><p>setting_name: String. Name of the setting. </p>
</li>
<li><p>setting_val: number or string. Value of the setting.</p>
</li>
</ul>
<h2 id="EngineClause"><a href="#EngineClause" class="headerlink" title="EngineClause"></a>EngineClause</h2><p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ENGINE<span class="operator">=</span>engine_name</span><br><span class="line"><span class="comment">-- below are optinal field for table engine only</span></span><br><span class="line">[orderByClause]</span><br><span class="line">[partitionByClause]</span><br><span class="line">[primaryKeyClause]</span><br><span class="line">[uniqueKeyClause]</span><br><span class="line">[sampleByClause]</span><br><span class="line">[ttlClause]</span><br><span class="line">[settingsClause]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>For database engine, engine_name can only be Cnch. </p>
</li>
<li><p>For table engine, engine_name can only be CnchMergeTree.</p>
</li>
</ul>
<h2 id="orderByClause"><a href="#orderByClause" class="headerlink" title="orderByClause"></a>orderByClause</h2><p><strong>Syntax</strong></p>
<p>orderByClause</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> orderExpr [,orderExpr]...</span><br></pre></td></tr></table></figure>
<p>orderExpr</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[columnExpr] [ASCENDING<span class="operator">|</span><span class="keyword">ASC</span><span class="operator">|</span>DESCENDING<span class="operator">|</span><span class="keyword">DESC</span>] [NULLS [<span class="keyword">FIRST</span><span class="operator">|</span><span class="keyword">LAST</span>] [<span class="keyword">COLLATE</span> STRING_LITERAL]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>[ASCENDING|ASC|DESCENDING|DESC]</code> : determines the sorting direction. If the direction is not specified, <code>ASC</code> is assumed. </p>
</li>
<li><p><code>[NULLS [FIRST|LAST]</code> : determines <code>NaN</code> and <code>NULL</code> sorting order. </p>
<ul>
<li><p>By default or with the <code>NULLS LAST</code> modifier: first the values, then <code>NaN</code> , then <code>NULL</code> . </p>
</li>
<li><p>With the <code>NULLS FIRST</code> modifier: first <code>NULL</code> , then <code>NaN</code> , then other values.</p>
</li>
</ul>
</li>
<li><p><code>[COLLATE STRING_LITERAL]</code> : For sorting by String values, you can specify collation. </p>
<ul>
<li><p>Collate is supported in LowCardinality, Nullable, Array and Tuple </p>
</li>
<li><p>When using <code>COLLATE</code> , sorting is always case-insensitive. </p>
</li>
<li><p>only recommend using <code>COLLATE</code> for final sorting of a small number of rows, since sorting with <code>COLLATE</code> is less efficient than normal sorting by bytes.</p>
</li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Order by multiple orderExpr</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.orderByClause (id UInt32, val UInt32) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> test.orderByClause <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">5</span>),(<span class="number">1</span>,<span class="number">15</span>),(<span class="number">2</span>,<span class="number">5</span>),(<span class="number">2</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.orderByClause <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">ASC</span>, val <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Order by NULLS FIRST</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.orderByClause (id UInt32, val Nullable(UInt32)) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.orderByClause <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>),(<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">3</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">3</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.orderByClause <span class="keyword">ORDER</span> <span class="keyword">BY</span> val <span class="keyword">DESC</span> NULLS <span class="keyword">FIRST</span>;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Order by with COLLATE</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.orderByClause (x UInt32, s Nullable(String)) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.orderByClause <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;bca&#x27;</span>),(<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">3</span>,<span class="string">&#x27;ABC&#x27;</span>),(<span class="number">4</span>,<span class="string">&#x27;123a&#x27;</span>),(<span class="number">5</span>,<span class="string">&#x27;abc&#x27;</span>),(<span class="number">6</span>,<span class="keyword">NULL</span>),(<span class="number">7</span>,<span class="string">&#x27;BCA&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.orderByClause <span class="keyword">ORDER</span> <span class="keyword">BY</span> s <span class="keyword">ASC</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;ru&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="partitionByClause"><a href="#partitionByClause" class="headerlink" title="partitionByClause"></a>partitionByClause</h2><p>Used by engineClause to define the partition key. Partition key can be any expression from the table columns.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> [columnExpr]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<ol>
<li>Partition key defined by a columnExpr</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.partitionByClause</span><br><span class="line">(</span><br><span class="line">    VisitDate <span class="type">Date</span>,</span><br><span class="line">    <span class="keyword">Hour</span> UInt8,</span><br><span class="line">    ClientID UUID</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> CnchMergeTree</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> VisitDate</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">Hour</span>;</span><br></pre></td></tr></table></figure>
<p>In this example, records will be partitioned by the VisitDate.<br>2. Partition key defined in a tuple of columnExpr </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.partitionByClause</span><br><span class="line">(</span><br><span class="line">    VisitDate <span class="type">Date</span>,</span><br><span class="line">    <span class="keyword">Hour</span> UInt8,</span><br><span class="line">    ClientID UUID</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> CnchMergeTree</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> (VisitDate,<span class="keyword">Hour</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">Hour</span>;</span><br></pre></td></tr></table></figure>
<p>In this example, records will be partitioned by the hour of the visitDate.</p>
<h2 id="primaryKeyClause"><a href="#primaryKeyClause" class="headerlink" title="primaryKeyClause"></a>primaryKeyClause</h2><p>Used by engineClause to define the primary key if it differs from order by key.<br>By default the primary key is the same as the order by key. Thus in most cases it is unnecessary to specify a separate primaryKeyClause.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PRIMARY</span> KEY [columnExpr]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.primaryKeyClause</span><br><span class="line">(</span><br><span class="line">    VisitDate <span class="type">Date</span>,</span><br><span class="line">    <span class="keyword">Hour</span> UInt8,</span><br><span class="line">    ClientID UUID</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> CnchMergeTree</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (VisitDate,<span class="keyword">Hour</span>)</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY VisitDate;</span><br></pre></td></tr></table></figure>
<h2 id="uniqueKeyClause"><a href="#uniqueKeyClause" class="headerlink" title="uniqueKeyClause"></a>uniqueKeyClause</h2><p>Used by engineClause to define the unique key. If specified, the table creates a partition-level constraint that all unique key values in the same partition must be distinct. If you try to insert a row with a unique key that matches an existing row, it will first delete the old row and then insert the new row.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UNIQUE</span> KEY [columnExpr]</span><br></pre></td></tr></table></figure>
<p>Note that only expressions with the following data types can be used in UNIQUE KEY</p>
<ul>
<li><p>Primary data type: <code>[U]Int8/16/32/64, Boolean, Date, DateTime, String</code> </p>
</li>
<li><p>Composite date type: <code>Tuple</code> composed of elements in supported primary data types</p>
</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Unique key defined by a single column</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.uniqueKeyClause</span><br><span class="line">(</span><br><span class="line">  `event_date` <span class="type">Date</span>,</span><br><span class="line">  `order_id` UInt64,</span><br><span class="line">  `state` UInt32,</span><br><span class="line">  `amount` UInt64</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> CnchMergeTree</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> event_date</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> state</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY order_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- rows with the same key will replace previous rows</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.uniqueKeyClause <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;2021-03-01&#x27;</span>, <span class="number">1001</span>, <span class="number">1</span>, <span class="number">100</span>),</span><br><span class="line">(<span class="string">&#x27;2021-03-01&#x27;</span>, <span class="number">1002</span>, <span class="number">1</span>, <span class="number">200</span>),</span><br><span class="line">(<span class="string">&#x27;2021-03-01&#x27;</span>, <span class="number">1001</span>, <span class="number">2</span>, <span class="number">100</span>),</span><br><span class="line">(<span class="string">&#x27;2021-03-02&#x27;</span>, <span class="number">1001</span>, <span class="number">1</span>, <span class="number">400</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.uniqueKeyClause <span class="keyword">ORDER</span> <span class="keyword">BY</span> event_date, order_id;</span><br><span class="line">┌─event_date─┬─order_id─┬─state─┬─amount─┐</span><br><span class="line">│ <span class="number">2021</span><span class="number">-03</span><span class="number">-01</span> │     <span class="number">1001</span> │     <span class="number">2</span> │    <span class="number">100</span> │</span><br><span class="line">│ <span class="number">2021</span><span class="number">-03</span><span class="number">-01</span> │     <span class="number">1002</span> │     <span class="number">1</span> │    <span class="number">200</span> │</span><br><span class="line">│ <span class="number">2021</span><span class="number">-03</span><span class="number">-02</span> │     <span class="number">1001</span> │     <span class="number">1</span> │    <span class="number">400</span> │</span><br><span class="line">└────────────┴──────────┴───────┴────────┘</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.uniqueKeyClause <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;2021-03-01&#x27;</span>, <span class="number">1002</span>, <span class="number">2</span>, <span class="number">200</span>),</span><br><span class="line">(<span class="string">&#x27;2021-03-02&#x27;</span>, <span class="number">1001</span>, <span class="number">2</span>, <span class="number">400</span>),</span><br><span class="line">(<span class="string">&#x27;2021-03-02&#x27;</span>, <span class="number">1002</span>, <span class="number">1</span>, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.uniqueKeyClause <span class="keyword">ORDER</span> <span class="keyword">BY</span> event_date, order_id;</span><br><span class="line">┌─event_date─┬─order_id─┬─state─┬─amount─┐</span><br><span class="line">│ <span class="number">2021</span><span class="number">-03</span><span class="number">-01</span> │     <span class="number">1001</span> │     <span class="number">2</span> │    <span class="number">100</span> │</span><br><span class="line">│ <span class="number">2021</span><span class="number">-03</span><span class="number">-01</span> │     <span class="number">1002</span> │     <span class="number">2</span> │    <span class="number">200</span> │</span><br><span class="line">│ <span class="number">2021</span><span class="number">-03</span><span class="number">-02</span> │     <span class="number">1001</span> │     <span class="number">2</span> │    <span class="number">400</span> │</span><br><span class="line">│ <span class="number">2021</span><span class="number">-03</span><span class="number">-02</span> │     <span class="number">1002</span> │     <span class="number">1</span> │    <span class="number">300</span> │</span><br><span class="line">└────────────┴──────────┴───────┴────────┘</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Composite unique key</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.uniqueKeyClause</span><br><span class="line">(</span><br><span class="line">  `event_date` <span class="type">Date</span>,</span><br><span class="line">  `region` UInt64,</span><br><span class="line">  `state` String,</span><br><span class="line">  `amount` UInt64</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> CnchMergeTree</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> event_date</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> state</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY (region, state);</span><br></pre></td></tr></table></figure>
<h2 id="sampleByClause"><a href="#sampleByClause" class="headerlink" title="sampleByClause"></a>sampleByClause</h2><p>Used by engineClause to define the sample key. The sampling expression must contain primary key and result of sampling expression must be unsigned integer.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SAMPLE <span class="keyword">BY</span> [columnExpr]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.sampleByClause </span><br><span class="line">(</span><br><span class="line">    id UInt32</span><br><span class="line">) </span><br><span class="line">ENGINE<span class="operator">=</span>CnchMergeTree </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id </span><br><span class="line">SAMPLE <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure>
<h2 id="ttlClause"><a href="#ttlClause" class="headerlink" title="ttlClause"></a>ttlClause</h2><p>Expression to specify storage duration of rows.</p>
<ul>
<li><p>columnExpr return results must have one <code>Date</code> or <code>DateTime</code> column. </p>
</li>
<li><p>Columns used in ttlClause must be in partition by columns.</p>
</li>
</ul>
<p>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TTL [columnExpr]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.ttlClause</span><br><span class="line">(</span><br><span class="line">    VisitDate <span class="type">Date</span>,</span><br><span class="line">    <span class="keyword">Hour</span> UInt8,</span><br><span class="line">    ClientID UUID</span><br><span class="line">)</span><br><span class="line">ENGINE <span class="operator">=</span> CnchMergeTree</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">Hour</span></span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> VisitDate</span><br><span class="line">TTL VisitDate <span class="operator">+</span> <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>；</span><br></pre></td></tr></table></figure>
<h2 id="settingsClause"><a href="#settingsClause" class="headerlink" title="settingsClause"></a>settingsClause</h2><p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETTINGS [settingExprList]</span><br></pre></td></tr></table></figure>
<h2 id="columnsClause"><a href="#columnsClause" class="headerlink" title="columnsClause"></a>columnsClause</h2><p>Used by insertStmt to represent a list of columns.<br><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(column_name[,column_name]...)</span><br></pre></td></tr></table></figure>
<h2 id="withClause"><a href="#withClause" class="headerlink" title="withClause"></a>withClause</h2><p>Bytehouse supports Common Table Expressions( <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Hierarchical_and_recursive_queries_in_SQL">CTE</a> ). The results of WITH clause can be used in the remaining <code>SELECT</code> query. There are certain limitations to the support, including</p>
<ul>
<li><p>Recursions are not allowed in CTE </p>
</li>
<li><p>Subqueries are not allowed in CTE</p>
</li>
</ul>
<p>We only support below syntax.</p>
<p>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> [columnExpr] <span class="keyword">AS</span> identifier</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<ol>
<li>Using constant expression as “variable”</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="string">&#x27;2019-08-01 15:23:00&#x27;</span> <span class="keyword">as</span> ts <span class="keyword">SELECT</span> ts</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Using results of a scalar subquery (1 row)</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* this example would return TOP 10 of most huge tables */</span></span><br><span class="line"><span class="keyword">WITH</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line">) <span class="keyword">AS</span> number</span><br><span class="line"><span class="keyword">SELECT</span> number;</span><br></pre></td></tr></table></figure>
<h2 id="limitClause"><a href="#limitClause" class="headerlink" title="limitClause"></a>limitClause</h2><p>** Syntax**</p>
<p>select the first <code>m</code> rows from the result.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT m</span><br></pre></td></tr></table></figure>
<p>select the <code>m</code> rows from the result after skipping the first <code>n</code> rows.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LIMIT n, m</span><br><span class="line">LIMIT m <span class="keyword">OFFSET</span> n</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>n</code> and <code>m</code> must be non-negative integers. </p>
</li>
<li><p>If there is no orderByClause that explicitly sorts results, the choice of rows for the result may be arbitrary and non-deterministic.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Example of Limit m.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.limitClause (id UInt32) engine<span class="operator">=</span>CnchMergeTree() <span class="keyword">order</span> <span class="keyword">by</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.limitClause <span class="keyword">VALUES</span> (<span class="number">1</span>),(<span class="number">2</span>),(<span class="number">3</span>),(<span class="number">4</span>),(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.limitClause LIMIT <span class="number">2</span>; <span class="comment">-- first 2 values will be return</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Example of Limit n,m</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.limitClause (id UInt32) engine<span class="operator">=</span>CnchMergeTree() <span class="keyword">order</span> <span class="keyword">by</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.limitClause <span class="keyword">VALUES</span> (<span class="number">1</span>),(<span class="number">2</span>),(<span class="number">3</span>),(<span class="number">4</span>),(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.limitClause LIMIT <span class="number">1</span>,<span class="number">2</span>; <span class="comment">-- skip first value，next 2 values will be return</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.limitClause LIMIT <span class="number">2</span> <span class="keyword">OFFSET</span> <span class="number">1</span>; <span class="comment">-- skip first value，next 2 values will be return</span></span><br></pre></td></tr></table></figure>
<h2 id="limitByClause"><a href="#limitByClause" class="headerlink" title="limitByClause"></a>limitByClause</h2><p>select the <code>m</code> rows for each distinct value of <code>expressions</code><br>** Syntax**</p>
<p>select the first <code>m</code> rows from the result for each distinct value of columnExpr.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT m <span class="keyword">BY</span> [columnExprList]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<ol>
<li>Example of Limit m by columnExpr</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.limitByClause(id UInt32, val UInt32) ENGINE <span class="operator">=</span> CnchMergeTree() <span class="keyword">order</span> <span class="keyword">by</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.limitByClause <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">10</span>), (<span class="number">1</span>, <span class="number">11</span>), (<span class="number">1</span>, <span class="number">12</span>), (<span class="number">2</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="number">21</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.limitByClause <span class="keyword">ORDER</span> <span class="keyword">BY</span> id, val LIMIT <span class="number">2</span> <span class="keyword">BY</span> id; <span class="comment">-- expect 4 rows. (1, 10), (1, 11), (2, 20), (2, 21) </span></span><br></pre></td></tr></table></figure>
<p>In this example, for each id (include value 1 and 2), we need to return 2 rows.</p>
<h2 id="havingClause"><a href="#havingClause" class="headerlink" title="havingClause"></a>havingClause</h2><p>Filtering the aggregation results produced by groupByClause. It is similar to the whereClause, but the difference is that <code>WHERE</code> is performed before aggregation, while <code>HAVING</code> is performed after it.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">HAVING</span> [columnExpr](http:<span class="operator">/</span><span class="operator">/</span>columnexpr<span class="operator">/</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.havingClause(id UInt32, val UInt32) ENGINE <span class="operator">=</span> CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.havingClause <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">10</span>), (<span class="number">1</span>, <span class="number">11</span>), (<span class="number">1</span>, <span class="number">12</span>), (<span class="number">2</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="number">21</span>);</span><br><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> test.havingClause <span class="keyword">GROUP</span> <span class="keyword">BY</span> id <span class="keyword">HAVING</span> <span class="built_in">count</span>(id)<span class="operator">&gt;</span><span class="number">2</span>; <span class="comment">-- only 1 is expected. </span></span><br></pre></td></tr></table></figure>
<h2 id="arrayJoinClause"><a href="#arrayJoinClause" class="headerlink" title="arrayJoinClause"></a>arrayJoinClause</h2><p>For table contains array column, array join can produce a new table that has a column with each individual array element of that initial column, while values of other columns are duplicated<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">LEFT</span>] <span class="keyword">ARRAY</span> <span class="keyword">JOIN</span> [columnExprList]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>You can specify only one arrayJoinClause in a <code>SELECT</code> query. </p>
</li>
<li><p><code>[LEFT] ARRAY JOIN</code> : types of ARRAY JOIN </p>
<ul>
<li><p><code>ARRAY JOIN</code> - In base case, empty arrays are not included in the result of <code>JOIN</code> . </p>
</li>
<li><p><code>LEFT ARRAY JOIN</code> - The result of <code>JOIN</code> contains rows with empty arrays. The value for an empty array is set to the default value for the array element type (usually 0, empty string or NULL).</p>
</li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.arrayJoinClause(s String, arr <span class="keyword">Array</span>(UInt8)) ENGINE <span class="operator">=</span> CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> s;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.arrayJoinClause <span class="keyword">VALUES</span> (<span class="string">&#x27;Hello&#x27;</span>, [<span class="number">1</span>,<span class="number">2</span>]), (<span class="string">&#x27;World&#x27;</span>, [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]), (<span class="string">&#x27;Goodbye&#x27;</span>, []);</span><br><span class="line"><span class="keyword">SELECT</span> s, arr <span class="keyword">FROM</span> test.arrayJoinClause <span class="keyword">ARRAY</span> <span class="keyword">JOIN</span> arr;</span><br></pre></td></tr></table></figure>
<h2 id="prewhereClause"><a href="#prewhereClause" class="headerlink" title="prewhereClause"></a>prewhereClause</h2><p>Prewhere is an optimization to apply filtering more efficiently. It is enabled by default even if <code>PREWHERE</code> clause is not specified explicitly. It works by automatically moving part of WHERE condition to prewhere stage. The role of <code>PREWHERE</code> clause is only to control this optimization if you think that you know how to do it better than it happens by default.<br>With prewhere optimization, at first only the columns necessary for executing prewhere expression are read. Then the other columns are read that are needed for running the rest of the query, but only those blocks where the prewhere expression is “true” at least for some rows. If there are a lot of blocks where prewhere expression is “false” for all rows and prewhere needs less columns than other parts of query, this often allows to read a lot less data from disk for query execution.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PREWHERE [columnExpr](http:<span class="operator">/</span><span class="operator">/</span>columnexpr<span class="operator">/</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.prewhereClause(id UInt32, val UInt32) ENGINE <span class="operator">=</span> CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.prewhereClause <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">10</span>), (<span class="number">1</span>, <span class="number">11</span>), (<span class="number">1</span>, <span class="number">12</span>), (<span class="number">2</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="number">21</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.prewhereClause PREWHERE id<span class="operator">=</span><span class="number">1</span> <span class="keyword">WHERE</span> val<span class="operator">&gt;</span><span class="number">10</span>; <span class="comment">-- (1, 11), (1, 12) expected</span></span><br></pre></td></tr></table></figure>
<h2 id="whereClause"><a href="#whereClause" class="headerlink" title="whereClause"></a>whereClause</h2><p>whereClause allows to filter the data that is coming from fromClause of <code>SELECT</code> . It must contain an expression with the <code>UInt8</code> type. This is usually an expression with comparison and logical operators.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> [columnExpr]</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.whereClause(id UInt32, val UInt32) ENGINE <span class="operator">=</span> CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.whereClause <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">10</span>), (<span class="number">1</span>, <span class="number">11</span>), (<span class="number">1</span>, <span class="number">12</span>), (<span class="number">2</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="number">21</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.whereClause <span class="keyword">WHERE</span> val<span class="operator">&gt;</span><span class="number">10</span>; <span class="comment">-- (1, 11), (1, 12), (2, 20), (2, 21) expected</span></span><br></pre></td></tr></table></figure>
<h2 id="fromClause"><a href="#fromClause" class="headerlink" title="fromClause"></a>fromClause</h2><p>The fromClause specifies the source to read data from:</p>
<ul>
<li><p>Table </p>
</li>
<li><p>Subquery </p>
</li>
<li><p>Table Function</p>
</li>
</ul>
<p>** Syntax**</p>
<p>Read data from table:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> [tableIdentifier] [<span class="keyword">FINAL</span>] [sampleClause] </span><br></pre></td></tr></table></figure>
<p>Read data from subquery:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ([selectUnionStmt]) [<span class="keyword">FINAL</span>] [sampleClause]</span><br></pre></td></tr></table></figure>
<p>Read data from table function:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> tableFunctionExpr [<span class="keyword">FINAL</span>] [sampleClause]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>FINAL</code> : When <code>FINAL</code> is specified, ByteHouse fully merges the data before returning the result and thus performs all data transformations that happen during merges.</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Select from table</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.fromClause (id UInt32, val UInt32) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.fromClause <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">10</span>), (<span class="number">1</span>, <span class="number">11</span>), (<span class="number">1</span>, <span class="number">12</span>), (<span class="number">2</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="number">21</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.fromClause; <span class="comment">-- expect 5 rows </span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Select from subquery</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.fromClause (id UInt32, val UInt32) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.fromClause <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">10</span>), (<span class="number">1</span>, <span class="number">11</span>), (<span class="number">1</span>, <span class="number">12</span>), (<span class="number">2</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="number">21</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test.fromClause LIMIT <span class="number">3</span>); <span class="comment">-- expect 3 rows </span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Select from tableFunctionExpr</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> numbers(<span class="number">10</span>); <span class="comment">-- expect 10 rows </span></span><br></pre></td></tr></table></figure>
<p>We use table function numbers here to generate a table with 10 rows.</p>
<h2 id="groupByClause"><a href="#groupByClause" class="headerlink" title="groupByClause"></a>groupByClause</h2><p><code>groupByClause</code> switches the <code>SELECT</code> query into an aggregation mode. [columnExprList] under <code>groupByClause</code> acts as grouping key and result of aggregating <code>SELECT</code> query will contain as many rows as there were unique values of grouping key in source table.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> [(][columnExprList][)] [<span class="keyword">WITH</span> <span class="keyword">ROLLUP</span><span class="operator">|</span><span class="keyword">WITH</span> <span class="keyword">CUBE</span>] [<span class="keyword">WITH</span> TOTALS]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>NULL processing</code> : ByteHouse interprets NULL as a value. If group by keys contains NULL value, it will appear in the result. </p>
</li>
<li><p><code>[WITH ROLLUP]</code> :  calculate subtotals for the key expressions, based on their order in the <code>GROUP BY</code> list. </p>
<ul>
<li><p>The subtotals rows are added after the result table. </p>
</li>
<li><p>In the subtotals rows the values of already “grouped” key expressions are set to <code>0</code> or empty line.</p>
</li>
</ul>
</li>
<li><p><code>[WITH CUBE]</code> : calculate subtotals for every combination of the key expressions in the <code>GROUP BY</code> list. </p>
</li>
<li><p><code>[WITH TOTALS]</code> : calculate subtotals for a combination of all key expressions in the <code>GROUP BY</code> list.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<ol>
<li>Group by key contains NULL value.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.groupByClause (x UInt32, y Nullable(UInt32)) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.groupByClause <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>),(<span class="number">2</span>,<span class="keyword">NULL</span>),(<span class="number">3</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">3</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">sum</span>(x), y <span class="keyword">FROM</span> test.groupByClause <span class="keyword">GROUP</span> <span class="keyword">BY</span> y; </span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th><strong>sum(x)</strong></th>
<th><strong>y</strong></th>
</tr>
</thead>
<tbody><tr>
<td>4</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>NULL</td>
</tr>
</tbody></table>
<ol start="2">
<li>Group by WITH ROLLUP modifier</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.groupByClause (<span class="keyword">year</span> UInt32, <span class="keyword">month</span> UInt32, <span class="keyword">day</span> UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.groupByClause <span class="keyword">VALUES</span> (<span class="number">2019</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2019</span>,<span class="number">1</span>,<span class="number">15</span>),(<span class="number">2020</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2020</span>,<span class="number">1</span>,<span class="number">15</span>),(<span class="number">2021</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2021</span>,<span class="number">1</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="built_in">count</span>() <span class="keyword">FROM</span> test.groupByClause <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span>, <span class="keyword">month</span>, <span class="keyword">day</span> <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br></pre></td></tr></table></figure>
<p>As <code>GROUP BY</code> section has three key expressions, the result contains four tables with subtotals “rolled up” from right to left:</p>
<ul>
<li><p><code>GROUP BY year, month, day</code> ; </p>
</li>
<li><p><code>GROUP BY year, month</code> (and <code>day</code> column is filled with zeros); </p>
</li>
<li><p><code>GROUP BY year</code> (now <code>month, day</code> columns are both filled with zeros); </p>
</li>
<li><p>and totals (and all three key expression columns are zeros).</p>
</li>
</ul>
<ol start="3">
<li>Group by WITH CUBE modifier</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.groupByClause (<span class="keyword">year</span> UInt32, <span class="keyword">month</span> UInt32, <span class="keyword">day</span> UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.groupByClause <span class="keyword">VALUES</span> (<span class="number">2019</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2019</span>,<span class="number">1</span>,<span class="number">15</span>),(<span class="number">2020</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2020</span>,<span class="number">1</span>,<span class="number">15</span>),(<span class="number">2021</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2021</span>,<span class="number">1</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="built_in">count</span>() <span class="keyword">FROM</span> test.groupByClause <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span>, <span class="keyword">month</span>, <span class="keyword">day</span> <span class="keyword">WITH</span> <span class="keyword">CUBE</span>;</span><br></pre></td></tr></table></figure>
<p>As <code>GROUP BY</code> section has three key expressions, the result contains eight tables with subtotals for all key expression combinations:</p>
<ul>
<li><p><code>GROUP BY year, month, day</code> </p>
</li>
<li><p><code>GROUP BY year, month</code> </p>
</li>
<li><p><code>GROUP BY year, day</code> </p>
</li>
<li><p><code>GROUP BY year</code> </p>
</li>
<li><p><code>GROUP BY month, day</code> </p>
</li>
<li><p><code>GROUP BY month</code> </p>
</li>
<li><p><code>GROUP BY day</code> </p>
</li>
<li><p>and totals. (and all three key expression columns are zeros).</p>
</li>
</ul>
<ol start="4">
<li>Group by WITH TOTAL modifier</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.groupByClause (<span class="keyword">year</span> UInt32, <span class="keyword">month</span> UInt32, <span class="keyword">day</span> UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">year</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.groupByClause <span class="keyword">VALUES</span> (<span class="number">2019</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2019</span>,<span class="number">1</span>,<span class="number">15</span>),(<span class="number">2020</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2020</span>,<span class="number">1</span>,<span class="number">15</span>),(<span class="number">2021</span>,<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2021</span>,<span class="number">1</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">year</span>, <span class="keyword">month</span>, <span class="keyword">day</span>, <span class="built_in">count</span>() <span class="keyword">FROM</span> test.groupByClause <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">year</span>, <span class="keyword">month</span>, <span class="keyword">day</span> <span class="keyword">WITH</span> TOTALS;</span><br></pre></td></tr></table></figure>
<p>If the <code>WITH TOTALS</code> modifier is specified, another row will be calculated.</p>
<ul>
<li><p><code>GROUP BY year, month, day</code> </p>
</li>
<li><p>and totals. (and all three key expression columns are zeros).</p>
</li>
</ul>
<h2 id="subqueryClause"><a href="#subqueryClause" class="headerlink" title="subqueryClause"></a>subqueryClause</h2><p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">AS</span> [selectUnionStmt]</span><br></pre></td></tr></table></figure>
<h2 id="sampleClause"><a href="#sampleClause" class="headerlink" title="sampleClause"></a>sampleClause</h2><p>The sampleClause allows for approximated <code>SELECT</code> query processing. With sampleClause enabled, query is not performed on all the data, but only on a certain fraction of data. This is useful when:</p>
<ul>
<li><p>Have strict timing requirements (like &lt;100ms) but you can’t justify the cost of additional hardware resources to meet them. </p>
</li>
<li><p>Raw data is not accurate, so approximation does not noticeably degrade the quality. </p>
</li>
<li><p>Business requirements target approximate results (for cost-effectiveness, or to market exact results to premium users).</p>
</li>
</ul>
<p>Note: To use sampling, you must declare sampling expression was specified during CnchMergeTree table creation, see [sampleByClause].<br><strong>Syntax</strong></p>
<p>Sample K. K is the number from 0 to 1.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SAMPLE K</span><br></pre></td></tr></table></figure>
<p>Sample N. N is integer larger than 1.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SAMPLE N</span><br></pre></td></tr></table></figure>
<p>SAMPLE K OFFSET M. K and M are numbers from 0 to 1.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SAMPLE K <span class="keyword">OFFSET</span> M</span><br></pre></td></tr></table></figure>
<p><strong>Example</strong></p>
<ol>
<li>Sample K</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.sampleClause (id UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> id SAMPLE <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.sampleClause <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> numbers(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>() <span class="keyword">FROM</span> test.sampleClause SAMPLE <span class="number">0.1</span>; <span class="comment">-- 1000 is expected</span></span><br></pre></td></tr></table></figure>
<p>In this example, 10% of data will be used for approximation.<br>2. Sample N </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.sampleClause (id UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> id SAMPLE <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.sampleClause <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> numbers(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>() <span class="keyword">FROM</span> test.sampleClause SAMPLE <span class="number">2</span>; <span class="comment">-- 1000 is expected</span></span><br></pre></td></tr></table></figure>
<p>In this example 2 rows of data will be used for approximation.<br>3. SAMPLE K OFFSET M </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.sampleClause (id UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> id SAMPLE <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.sampleClause <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> numbers(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>() <span class="keyword">FROM</span> test.sampleClause SAMPLE <span class="number">0.1</span> <span class="keyword">OFFSET</span> <span class="number">0.2</span>;</span><br></pre></td></tr></table></figure>
<p>In this example, 10% of data will be used for approximation after skipping 20% of data.</p>
<h2 id="joinClause"><a href="#joinClause" class="headerlink" title="joinClause"></a>joinClause</h2><p>Join produces a new table by combining columns from one or multiple tables by using values common to each.<br>** Syntax**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">GLOBAL</span><span class="operator">|</span><span class="keyword">LOCAL</span>] [<span class="keyword">ANY</span><span class="operator">|</span><span class="keyword">ALL</span><span class="operator">|</span>ASOF] [<span class="keyword">INNER</span><span class="operator">|</span><span class="keyword">LEFT</span><span class="operator">|</span><span class="keyword">RIGHT</span><span class="operator">|</span><span class="keyword">FULL</span><span class="operator">|</span><span class="keyword">CROSS</span>] [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> [tableIdentifier] <span class="keyword">ON</span><span class="operator">|</span><span class="keyword">USING</span> [columnExprList]</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>[GLOBAL|LOCAL]</code> : </p>
<pre><code>- `GLOBAL` , broadcast Join. Broadcast joins cannot be used when joining two large DataFrames. 
  
- `LOCAL` , local join. Using distribution keys on the join columns can use local join. 
</code></pre>
</li>
<li><p><code>[ANY|ALL|ASOF]</code> : </p>
<ul>
<li><p><code>ANY</code> ,  If the right table has several matching rows, only the first one found is joined. If the right table has only one matching row, the results of ANY and ALL are the same. </p>
</li>
<li><p><code>ALL</code> , If the right table has several matching rows, ByteHouse creates a Cartesian product from matching rows. This is the normal JOIN behaviour from standard SQL. </p>
</li>
<li><p><code>ASOF</code> ,  For joining sequences with an uncertain match.</p>
</li>
</ul>
</li>
<li><p><code>[INNER|LEFT|RIGHT|FULL|CROSS]</code> : All standard <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Join_(SQL)">SQL JOIN</a> types </p>
<ul>
<li><p><code>INNER JOIN</code> , only matching rows are returned. </p>
</li>
<li><p><code>LEFT OUTER JOIN</code> , non-matching rows from left table are returned in addition to matching rows. </p>
</li>
<li><p><code>RIGHT OUTER JOIN</code> , non-matching rows from right table are returned in addition to matching rows. </p>
</li>
<li><p><code>FULL OUTER JOIN</code> , non-matching rows from both tables are returned in addition to matching rows. </p>
</li>
<li><p><code>CROSS JOIN</code> , produces cartesian product of whole tables, “join keys” are not specified.</p>
</li>
</ul>
</li>
<li><p><code>ON|USING</code> : Expressions from <code>ON</code> clause and columns from <code>USING</code> clause are called “join keys”.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.joinClause (number UInt64) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> number;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.joinClause <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> number, joined <span class="keyword">FROM</span> test.joinClause <span class="keyword">ANY</span> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> number <span class="operator">*</span> <span class="number">2</span> <span class="keyword">AS</span> number, number <span class="operator">*</span> <span class="number">10</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> joined <span class="keyword">FROM</span> test.joinClause LIMIT <span class="number">10</span>) js2 <span class="keyword">USING</span> number LIMIT <span class="number">10</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th><strong>number</strong></th>
<th><strong>joined</strong></th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>NULL</td>
</tr>
<tr>
<td>2</td>
<td>21</td>
</tr>
<tr>
<td>3</td>
<td>NULL</td>
</tr>
<tr>
<td>4</td>
<td>41</td>
</tr>
<tr>
<td>5</td>
<td>NULL</td>
</tr>
<tr>
<td>6</td>
<td>61</td>
</tr>
<tr>
<td>7</td>
<td>NULL</td>
</tr>
<tr>
<td>8</td>
<td>81</td>
</tr>
<tr>
<td>9</td>
<td>NULL</td>
</tr>
</tbody></table>
<h2 id="columnExprList"><a href="#columnExprList" class="headerlink" title="columnExprList"></a>columnExprList</h2><p>A list of columnExpr seperate by Comma.<br>** Syntax**</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[columnExpr] [columnExpr]...</span><br></pre></td></tr></table></figure>
<h2 id="columnExpr"><a href="#columnExpr" class="headerlink" title="columnExpr"></a>columnExpr</h2><p>A columnExpr is a function, identifier, literal, application of an operator, expression in brackets, subquery, or asterisk. It can also contain an alias.</p>

                
            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Docs/">
                                    <span class="chip bg-color">Docs</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    


</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2023</span>
            
            <!-- <span id="year">2022</span> -->
            <a href="/about" target="_blank">ByteDance Inc.</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/byconity" class="tooltipped" target="_blank" data-tooltip="GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>















    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
