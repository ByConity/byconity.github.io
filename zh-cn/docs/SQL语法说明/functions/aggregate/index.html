<!DOCTYPE HTML>
<html lang="en,zh-cn,default">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Aggregation, ByConity keywords">
    <meta name="description" content="theme.home.header.description">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Aggregation | ByConity</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByConity" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ByConity</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Home</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/zh-cn/docs" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Docs</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a target="_blank" rel="noopener" href="https://github.com/byconity" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>Community</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ByConity</div>
        <div class="logo-desc">
            
            theme.home.header.description
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Home
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/zh-cn/docs" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Docs
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a target="_blank" rel="noopener" href="https://github.com/byconity" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			Community
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/byConity" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Contribute with us
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/byConity" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Contribute with us" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/22.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Aggregation</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Docs/" class="post-category">
                                Docs
                            </a>
                        
                            <a href="/categories/Docs/SQL-Syntax/" class="post-category">
                                SQL_Syntax
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2023-01-06
                </div>
                

                

                

                

                
                
                <div class="info-break-policy">
                    
                    <style>
                        .github-edit-link {
                            padding: 0 2px;
                            color: #42b983;
                            font-weight: 500;
                            text-decoration: underline;
                            word-wrap: break-word;
                        }
                    </style>
                    <a class="github-edit-link" href="https://github.com/byConity/byconity.github.io/edit/main/source/_posts/SQL%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E/functions/aggregate.md" target="_blank">
                        <i class="far fa-edit fa-fw"></i>Edit post
                    </a>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>Notice:<br>Some of the examples below are referenced from <a target="_blank" rel="noopener" href="https://clickhouse.com/docs/en/sql-reference/functions/">ClickHouse Documentation</a> but have been adapted and modified to work in ByteHouse.</p>
</blockquote>
<h2 id="any"><a href="#any" class="headerlink" title="any"></a>any</h2><p>Selects the first encountered value.<br>The query can be executed in any order and even in a different order each time, so the result of this function is indeterminate.<br>To get a determinate result, you can use the ‘min’ or ‘max’ function instead of ‘any’.</p>
<p>In some cases, you can rely on the order of execution. This applies to cases when SELECT comes from a subquery that uses ORDER BY.</p>
<p>When a <code>SELECT</code> query has the <code>GROUP BY</code> clause or at least one aggregate function, ByteHouse (in contrast to MySQL) requires that all expressions in the <code>SELECT</code> , <code>HAVING</code> , and <code>ORDER BY</code> clauses be calculated from keys or from aggregate functions. In other words, each column selected from the table must be used either in keys or inside aggregate functions. To get behavior like in MySQL, you can put the other columns in the <code>any</code> aggregate function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">any</span>(<span class="keyword">column</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>column</code> – The column name.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>first value encontered. Type is same as input column.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">any</span>(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─any(number)─┐</span><br><span class="line">│ 0           │</span><br><span class="line">└─────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="anyHeavy"><a href="#anyHeavy" class="headerlink" title="anyHeavy"></a>anyHeavy</h2><p>Selects a frequently occurring value using the <a target="_blank" rel="noopener" href="http://www.cs.umd.edu/~samir/498/karp.pdf">heavy hitters</a> algorithm. If there is a value that occurs more than in half the cases in each of the query’s execution threads, this value is returned. Normally, the result is nondeterministic.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anyHeavy(<span class="keyword">column</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>column</code> – The column name.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>most frequent value. Type is same as input column.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionAnyHeavy(id <span class="type">Int</span>) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> id;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionAnyHeavy <span class="keyword">values</span> (<span class="number">1</span>),(<span class="number">1</span>),(<span class="number">1</span>),(<span class="number">2</span>),(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">SELECT</span> anyHeavy(id) <span class="keyword">FROM</span> test.functionAnyHeavy;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─anyHeavy(id)─┐</span><br><span class="line">│ 1            │</span><br><span class="line">└──────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="anyLast"><a href="#anyLast" class="headerlink" title="anyLast"></a>anyLast</h2><p>Selects the last value encountered.<br>The result is just as indeterminate.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anyLast(<span class="keyword">column</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>column</code> – The column name.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>last value encountered. Type is same as input column.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> anyLast(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─anyLast(number)─┐</span><br><span class="line">│ 9               │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>


<h2 id="argMax"><a href="#argMax" class="headerlink" title="argMax"></a>argMax</h2><p>Calculates the <code>arg</code> value for a maximum <code>val</code> value. If there are several different values of <code>arg</code> for maximum values of <code>val</code> , returns the first of these values encountered.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">argMax(arg, val)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>arg</code> — Argument. </li>
<li><code>val</code> — Value.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>arg value that corresponds to maximum val value. Type is same as arg type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionArgMax (<span class="keyword">user</span> String, salary <span class="type">Int</span>) Engine<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionArgMax <span class="keyword">VALUES</span> (<span class="string">&#x27;director&#x27;</span>,<span class="number">5000</span>),(<span class="string">&#x27;manager&#x27;</span>,<span class="number">3000</span>),(<span class="string">&#x27;worker&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">SELECT</span> argMax(<span class="keyword">user</span>, salary) <span class="keyword">FROM</span> test.functionArgMax;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─argMax(user, salary)─┐</span><br><span class="line">│ director             │</span><br><span class="line">└──────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="argMin"><a href="#argMin" class="headerlink" title="argMin"></a>argMin</h2><p>Calculates the <code>arg</code> value for a minimum <code>val</code> value. If there are several different values of <code>arg</code> for minimum values of <code>val</code> , returns the first of these values encountered.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">argMin(arg, val)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>arg</code> — Argument. </li>
<li><code>val</code> — Value.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>arg value that corresponds to minimum val value. Type is same as arg type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionArgMin (<span class="keyword">user</span> String, salary <span class="type">Int</span>) Engine<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionArgMin <span class="keyword">VALUES</span> (<span class="string">&#x27;director&#x27;</span>,<span class="number">5000</span>),(<span class="string">&#x27;manager&#x27;</span>,<span class="number">3000</span>),(<span class="string">&#x27;worker&#x27;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">SELECT</span> argMin(<span class="keyword">user</span>, salary) <span class="keyword">FROM</span> test.functionArgMin;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─argMin(user, salary)─┐</span><br><span class="line">│ worker               │</span><br><span class="line">└──────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="avg"><a href="#avg" class="headerlink" title="avg"></a>avg</h2><p>Calculates the arithmetic mean.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">avg</span>(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>x</code> — input values, must be Integer, Float or Decimal.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>The arithmetic mean, always as Float64. </li>
<li><code>NaN</code> if the input parameter <code>x</code> is empty.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionAvg (x Int8) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionAvg <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> numbers(<span class="number">6</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">avg</span>(x) <span class="keyword">FROM</span> test.functionAvg;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─avg(x)──┐</span><br><span class="line">│ 2.5e+00 │</span><br><span class="line">└─────────┘</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionAvg (x Int8) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">avg</span>(x) <span class="keyword">FROM</span> test.functionAvg;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─avg(x)─┐</span><br><span class="line">│ NaN    │</span><br><span class="line">└────────┘</span><br></pre></td></tr></table></figure>

<h2 id="corr"><a href="#corr" class="headerlink" title="corr"></a>corr</h2><p>Calculates the Pearson correlation coefficient: <code>Σ((x - x̅)(y - y̅)) / sqrt(Σ((x - x̅)^2) * Σ((y - y̅)^2))</code>.<br>This function uses a numerically unstable algorithm. If you need <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Numerical_stability">numerical stability</a> in calculations, use the <code>corrStable</code> function. It works slower but provides a lower computational error.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">corr</span>(x, y)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>x</code> — input values, must be Integer, Float. </li>
<li><code>y</code> — input values, must be Integer, Float.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Pearson correlation coefficient, always as Float64.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionCorr (x Int8, y Int8) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionCorr <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">2</span>),(<span class="number">5</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">corr</span>(x,y) <span class="keyword">FROM</span> test.functionCorr;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─corr(x, y)─┐</span><br><span class="line">│ -1e+00     │</span><br><span class="line">└────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="covarPop"><a href="#covarPop" class="headerlink" title="covarPop"></a>covarPop</h2><p>Calculates the value of <code>Σ((x - x̅)(y - y̅)) / n</code>.<br>This function uses a numerically unstable algorithm. If you need <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Numerical_stability">numerical stability</a> in calculations, use the <code>covarPopStable</code> function. It works slower but provides a lower computational error.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">covarPop(x, y)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>x</code> — input values, must be Integer, Float. </li>
<li><code>y</code> — input values, must be Integer, Float.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li><code>Σ((x - x̅)(y - y̅)) / n</code>, always as Float64.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionCovarPop (x Int8, y Int8) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionCovarPop <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">2</span>),(<span class="number">5</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> covarPop(x,y) <span class="keyword">FROM</span> test.functionCovarPop;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─covarPop(x, y)─┐</span><br><span class="line">│ -2e+00         │</span><br><span class="line">└────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="covarSamp"><a href="#covarSamp" class="headerlink" title="covarSamp"></a>covarSamp</h2><p>Calculates the value of <code>Σ((x - x̅)(y - y̅)) / (n - 1)</code>.<br>This function uses a numerically unstable algorithm. If you need <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Numerical_stability">numerical stability</a> in calculations, use the <code>covarSampStable</code> function. It works slower but provides a lower computational error.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">covarSamp(x, y)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>x</code> — input values, must be Integer, Float. </li>
<li><code>y</code> — input values, must be Integer, Float.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li><code>Σ((x - x̅)(y - y̅)) / (n - 1)</code>, always as Float64.</li>
<li>When n &lt;&#x3D; 1, returns NaN.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionCovarSamp (x Int8, y Int8) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionCovarSamp <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">5</span>),(<span class="number">2</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">2</span>),(<span class="number">5</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> covarSamp(x,y) <span class="keyword">FROM</span> test.functionCovarSamp;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─covarSamp(x, y)─┐</span><br><span class="line">│ -2.5e+00        │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionCovarSamp (x Int8, y Int8) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionCovarSamp <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">SELECT</span> covarSamp(x,y) <span class="keyword">FROM</span> test.functionCovarSamp;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─covarSamp(x, y)─┐</span><br><span class="line">│ NaN             │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="groupArray"><a href="#groupArray" class="headerlink" title="groupArray"></a>groupArray</h2><p>Creates an array of argument values.<br>Values can be added to the array in any (indeterminate) order.</p>
<p>The second version (with the <code>max_size</code> parameter) limits the size of the resulting array to <code>max_size</code> elements. For example, <code>groupArray(1)(x)</code> is equivalent to <code>[any (x)]</code> .</p>
<p>In some cases, you can still rely on the order of execution. This applies to cases when <code>SELECT</code> comes from a subquery that uses <code>ORDER BY</code> .</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupArray(x)</span><br><span class="line">groupArray(max_size)(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>x</code> — input values.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>array of values. Type is Array.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> groupArray(number) <span class="keyword">from</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupArray(number)─────────────┐</span><br><span class="line">│ [0, 1, 2, 3, 4, 5, 6, 7, 8, 9] │</span><br><span class="line">└────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> groupArray(<span class="number">5</span>)(number) <span class="keyword">from</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupArray(5)(number)─┐</span><br><span class="line">│ [0, 1, 2, 3, 4]       │</span><br><span class="line">└───────────────────────┘</span><br></pre></td></tr></table></figure>



<h2 id="groupBitAnd"><a href="#groupBitAnd" class="headerlink" title="groupBitAnd"></a>groupBitAnd</h2><p>Applies bitwise <code>AND</code> for series of numbers.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupBitAnd(expr)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>expr</code> – An expression that results in <code>UInt*</code> type.</li>
</ul>
<p><strong>Return value</strong></p>
<ul>
<li>Value of the <code>UInt*</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.groupBitAnd (num UInt8) ENGINE<span class="operator">=</span>CnchMergeTree() <span class="keyword">ORDER</span> <span class="keyword">BY</span> num;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.groupBitAnd <span class="keyword">VALUES</span> (<span class="number">44</span>),(<span class="number">28</span>),(<span class="number">13</span>),(<span class="number">85</span>);</span><br><span class="line"><span class="keyword">SELECT</span> groupBitAnd(num) <span class="keyword">FROM</span> test.groupBitAnd;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupBitAnd(num)─┐</span><br><span class="line">│ 4                │</span><br><span class="line">└──────────────────┘</span><br></pre></td></tr></table></figure>
<p>Bit representation of 44,28,13 and 85 are 00101100,00011100,00001101 and 01010101. The bit and of the four numbers is 00000100 which is equal to 4.</p>
<h2 id="groupBitOr"><a href="#groupBitOr" class="headerlink" title="groupBitOr"></a>groupBitOr</h2><p>Applies bitwise <code>OR</code> for series of numbers.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupBitOr(expr)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>expr</code> – An expression that results in <code>UInt*</code> type.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Value of the <code>UInt*</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionGroupBitOr (num UInt8) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> num;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionGroupBitOr <span class="keyword">VALUES</span> (<span class="number">44</span>),(<span class="number">28</span>),(<span class="number">13</span>),(<span class="number">85</span>);</span><br><span class="line"><span class="keyword">SELECT</span> groupBitOr(num) <span class="keyword">FROM</span> test.functionGroupBitOr;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupBitOr(num)─┐</span><br><span class="line">│ 125             │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>
<p>Bit representation of 44,28,13 and 85 are 00101100,00011100,00001101 and 01010101. The bit or of the four numbers is 01111101 which is equal to 125.</p>
<h2 id="groupBitXor"><a href="#groupBitXor" class="headerlink" title="groupBitXor"></a>groupBitXor</h2><p>Applies bitwise <code>XOR</code> for series of numbers.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupBitXor(expr)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>expr</code> – An expression that results in <code>UInt*</code> type.</li>
</ul>
<p><strong>Return value</strong></p>
<ul>
<li>Value of the <code>UInt*</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionGroupBitXor (num UInt8) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> num;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionGroupBitXor <span class="keyword">VALUES</span> (<span class="number">44</span>),(<span class="number">28</span>),(<span class="number">13</span>),(<span class="number">85</span>);</span><br><span class="line"><span class="keyword">SELECT</span> groupBitXor(num) <span class="keyword">FROM</span> test.functionGroupBitXor;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupBitXor(num)─┐</span><br><span class="line">│ 104              │</span><br><span class="line">└──────────────────┘</span><br></pre></td></tr></table></figure>
<p>Bit representation of 44,28,13 and 85 are 00101100,00011100,00001101 and 01010101. The bit xor of the four numbers is 01101000 which is equal to 104.</p>
<h2 id="groupBitmap"><a href="#groupBitmap" class="headerlink" title="groupBitmap"></a>groupBitmap</h2><p>Bitmap or Aggregate calculations from a unsigned integer column, return cardinality of type UInt64, if add suffix -State, then return bitmap object.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupBitmap(expr)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>expr</code> – An expression that results in <code>UInt*</code> type.</li>
</ul>
<p><strong>Return value</strong></p>
<ul>
<li>Value of the <code>UInt64</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> groupBitmapState(number) <span class="keyword">FROM</span> numbers(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupBitmap(number)─┐</span><br><span class="line">│ 4                   │</span><br><span class="line">└─────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="groupBitmapAnd"><a href="#groupBitmapAnd" class="headerlink" title="groupBitmapAnd"></a>groupBitmapAnd</h2><p>Calculations the AND of a bitmap column, return cardinality of type UInt64, if add suffix -State, then return bitmap object.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupBitmapAnd(expr)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>expr</code> – An expression that results in <code>AggregateFunction(groupBitmap, UInt*)</code> type.</li>
</ul>
<p><strong>Return value</strong></p>
<ul>
<li>Value of the <code>UInt64</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> bitmap_column_expr_test2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> bitmap_column_expr_test2(tag_id String,z AggregateFunction(groupBitmap, UInt32)) ENGINE <span class="operator">=</span> CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> tag_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag1&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag2&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag3&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">12</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> groupBitmapAnd(z) <span class="keyword">FROM</span> bitmap_column_expr_test2 <span class="keyword">WHERE</span> <span class="keyword">like</span>(tag_id, <span class="string">&#x27;tag%&#x27;</span>);</span><br><span class="line">┌─groupBitmapAnd(z)─┐</span><br><span class="line">│               <span class="number">3</span>   │</span><br><span class="line">└───────────────────┘</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arraySort(bitmapToArray(groupBitmapAndState(z))) <span class="keyword">FROM</span> bitmap_column_expr_test2 <span class="keyword">WHERE</span> <span class="keyword">like</span>(tag_id, <span class="string">&#x27;tag%&#x27;</span>);</span><br><span class="line">┌─arraySort(bitmapToArray(groupBitmapAndState(z)))─┐</span><br><span class="line">│ [<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>]                                         │</span><br><span class="line">└──────────────────────────────────────────────────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="groupBitmapOr"><a href="#groupBitmapOr" class="headerlink" title="groupBitmapOr"></a>groupBitmapOr</h2><p>Calculations the OR of a bitmap column, return cardinality of type UInt64, if add suffix -State, then return bitmap object. This is equivalent to <code>groupBitmapMerge</code> .</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupBitmapOr(expr)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>expr</code> – An expression that results in <code>AggregateFunction(groupBitmap, UInt*)</code> type.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Value of the <code>UInt64</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> bitmap_column_expr_test2;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> bitmap_column_expr_test2(tag_id String,z AggregateFunction(groupBitmap, UInt32)) ENGINE <span class="operator">=</span> CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> tag_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag1&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag2&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag3&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">12</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> groupBitmapOr(z) <span class="keyword">FROM</span> bitmap_column_expr_test2 <span class="keyword">WHERE</span> <span class="keyword">like</span>(tag_id, <span class="string">&#x27;tag%&#x27;</span>);</span><br><span class="line"></span><br><span class="line">┌─groupBitmapOr(z)─┐</span><br><span class="line">│             <span class="number">15</span>   │</span><br><span class="line">└──────────────────┘</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arraySort(bitmapToArray(groupBitmapOrState(z))) <span class="keyword">FROM</span> bitmap_column_expr_test2 <span class="keyword">WHERE</span> <span class="keyword">like</span>(tag_id, <span class="string">&#x27;tag%&#x27;</span>);</span><br><span class="line">┌─arraySort(bitmapToArray(groupBitmapOrState(z)))─┐</span><br><span class="line">│ [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>]           │</span><br><span class="line">└─────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="groupBitmapXor"><a href="#groupBitmapXor" class="headerlink" title="groupBitmapXor"></a>groupBitmapXor</h2><p>Calculations the XOR of a bitmap column, return cardinality of type UInt64, if add suffix -State, then return bitmap object.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupBitmapOr(expr)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>expr</code> – An expression that results in <code>AggregateFunction(groupBitmap, UInt*)</code> type.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Value of the <code>UInt64</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> bitmap_column_expr_test2;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> bitmap_column_expr_test2(tag_id String, z AggregateFunction(groupBitmap, UInt32)) ENGINE <span class="operator">=</span> CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> tag_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag1&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag2&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bitmap_column_expr_test2 <span class="keyword">VALUES</span> (<span class="string">&#x27;tag3&#x27;</span>, bitmapBuild(<span class="built_in">cast</span>([<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">12</span>] <span class="keyword">as</span> <span class="keyword">Array</span>(UInt32))));</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> groupBitmapXor(z) <span class="keyword">FROM</span> bitmap_column_expr_test2 <span class="keyword">WHERE</span> <span class="keyword">like</span>(tag_id, <span class="string">&#x27;tag%&#x27;</span>);</span><br><span class="line">┌─groupBitmapXor(z)─┐</span><br><span class="line">│              <span class="number">10</span>   │</span><br><span class="line">└───────────────────┘</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> arraySort(bitmapToArray(groupBitmapXorState(z))) <span class="keyword">FROM</span> bitmap_column_expr_test2 <span class="keyword">WHERE</span> <span class="keyword">like</span>(tag_id, <span class="string">&#x27;tag%&#x27;</span>);</span><br><span class="line"></span><br><span class="line">┌─arraySort(bitmapToArray(groupBitmapXorState(z)))─┐</span><br><span class="line">│ [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>]                       │</span><br><span class="line">└──────────────────────────────────────────────────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="groupUniqArray"><a href="#groupUniqArray" class="headerlink" title="groupUniqArray"></a>groupUniqArray</h2><p>Creates an array from different argument values. Memory consumption is the same as for the uniqExact function.</p>
<p>The second version (with the <code>max_size</code> parameter) limits the size of the resulting array to <code>max_size</code> elements.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupUniqArray(x)</span><br><span class="line">groupUniqArray(max_size)(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>x</code> — input values.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>array of values. Type is Array.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> groupUniqArray(number) <span class="keyword">from</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupUniqArray(number)─────────┐</span><br><span class="line">│ [0, 8, 3, 9, 7, 2, 1, 6, 4, 5] │</span><br><span class="line">└────────────────────────────────┘</span><br></pre></td></tr></table></figure>
<!-- TODO: Below Function Does Not Work In CNCH, Check with ChenXing -->
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> groupUniqArray(<span class="number">5</span>)(number) <span class="keyword">from</span> numbers(<span class="number">10</span>); </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─groupArray(5)(number)─┐</span><br><span class="line">│ [0, 1, 2, 3, 4]       │</span><br><span class="line">└───────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="histogram"><a href="#histogram" class="headerlink" title="histogram"></a>histogram</h2><p>Calculates an adaptive histogram. It does not guarantee precise results.</p>
<p>The functions uses <a target="_blank" rel="noopener" href="http://jmlr.org/papers/volume11/ben-haim10a/ben-haim10a.pdf">A Streaming Parallel Decision Tree Algorithm</a> . The borders of histogram bins are adjusted as new data enters a function. In common case, the widths of bins are not equal.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram(number_of_bins)(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>number_of_bins</code> — Upper limit for the number of bins in the histogram. The function automatically calculates the number of bins. It tries to reach the specified number of bins, but if it fails, it uses fewer bins.</li>
<li><code>values</code> — Expression resulting in input values.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>Array of Tuples of the following format:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[(lower_1, upper_1, height_1), ... (lower_N, upper_N, height_N)]</span><br><span class="line"></span><br><span class="line">- `lower` — Lower bound of the bin.</span><br><span class="line">- `upper` — Upper bound of the bin.</span><br><span class="line">- `height` — Calculated height of the bin.</span><br></pre></td></tr></table></figure>

<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> histogram(<span class="number">5</span>)(number <span class="operator">+</span> <span class="number">1</span>) <span class="keyword">FROM</span> numbers(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─histogram(5)(plus(number, 1))───────────────────────────────────────────┐</span><br><span class="line">│ [(1,4.5,4),(4.5,8.5,4),(8.5,12.75,4.125),(12.75,17,4.625),(17,20,3.25)] │</span><br><span class="line">└─────────────────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>You can visualize a histogram with the bar function, for example:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">WITH</span> histogram(<span class="number">5</span>)(rand() <span class="operator">%</span> <span class="number">100</span>) <span class="keyword">AS</span> hist</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    arrayJoin(hist)<span class="number">.3</span> <span class="keyword">AS</span> height,</span><br><span class="line">    bar(height, <span class="number">0</span>, <span class="number">6</span>, <span class="number">5</span>) <span class="keyword">AS</span> bar</span><br><span class="line"><span class="keyword">FROM</span> numbers(<span class="number">20</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">┌─height─┬─bar───┐</span><br><span class="line"></span><br><span class="line">│  2.125 │ █▋    │</span><br><span class="line"></span><br><span class="line">│   3.25 │ ██▌   │</span><br><span class="line"></span><br><span class="line">│  5.625 │ ████▏ │</span><br><span class="line"></span><br><span class="line">│  5.625 │ ████▏ │</span><br><span class="line"></span><br><span class="line">│  3.375 │ ██▌   │</span><br><span class="line"></span><br><span class="line">└────────┴───────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>In this case, you should remember that you do not know the histogram bin borders.</p>
<h2 id="max"><a href="#max" class="headerlink" title="max"></a>max</h2><p>Aggregate function that calculates the maximum across a group of values.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">max</span>(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>values</code> — input values.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>maximum value. Type is same as values</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">max</span>(number) <span class="keyword">FROM</span> numbers(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─max(number)─┐</span><br><span class="line">│ 19          │</span><br><span class="line">└─────────────┘</span><br></pre></td></tr></table></figure>

<p>If you need non-aggregate function to choose a maximum of two values, see <code>greatest</code> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> greatest(a, b) <span class="keyword">FROM</span> <span class="keyword">table</span>;</span><br></pre></td></tr></table></figure>

<h2 id="median"><a href="#median" class="headerlink" title="median"></a>median</h2><p>The <code>median*</code> functions are the aliases for the corresponding <code>quantile*</code> functions. They calculate median of a numeric data sample.</p>
<p>Functions:</p>
<ul>
<li><code>median</code> — Alias for quantile. </li>
<li><code>medianDeterministic</code> — Alias for quantileDeterministic. </li>
<li><code>medianExact</code> — Alias for quantileExact. </li>
<li><code>medianExactWeighted</code> — Alias for quantileExactWeighted. </li>
<li><code>medianTiming</code> — Alias for quantileTiming.</li>
<li><code>medianTimingWeighted</code> — Alias for quantileTimingWeighted. </li>
<li><code>medianTDigest</code> — Alias for quantileTDigest. </li>
<li><code>medianTDigestWeighted</code> — Alias for quantileTDigestWeighted. </li>
<li><code>medianBFloat16</code> — Alias for quantileBFloat16.</li>
</ul>
<h2 id="medianDeterministic"><a href="#medianDeterministic" class="headerlink" title="medianDeterministic"></a>medianDeterministic</h2><p>Alias for quantileDeterministic.</p>
<h2 id="medianExact"><a href="#medianExact" class="headerlink" title="medianExact"></a>medianExact</h2><p>Alias for quantileExact.</p>
<h2 id="medianExactWeighted"><a href="#medianExactWeighted" class="headerlink" title="medianExactWeighted"></a>medianExactWeighted</h2><p>Alias for quantileExactWeighted.</p>
<h2 id="medianTDigest"><a href="#medianTDigest" class="headerlink" title="medianTDigest"></a>medianTDigest</h2><p>Alias for quantileTDigest.</p>
<h2 id="medianTDigestWeighted"><a href="#medianTDigestWeighted" class="headerlink" title="medianTDigestWeighted"></a>medianTDigestWeighted</h2><p>Alias for quantileTDigestWeighted.</p>
<h2 id="medianTiming"><a href="#medianTiming" class="headerlink" title="medianTiming"></a>medianTiming</h2><p>Alias for quantileTiming.</p>
<h2 id="medianTimingWeighted"><a href="#medianTimingWeighted" class="headerlink" title="medianTimingWeighted"></a>medianTimingWeighted</h2><p>Alias for quantileTimingWeighted.</p>
<h2 id="quantile"><a href="#quantile" class="headerlink" title="quantile"></a>quantile</h2><p>Computes an approximate <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence.</p>
<p>This function applies <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Reservoir_sampling">reservoir sampling</a> with a reservoir size up to 8192 and a random number generator for sampling. The result is non-deterministic. To get an exact quantile, use the quantileExact function.</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantile(level)(expr)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>median</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over the column values resulting in numeric, Date, or DateTime.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Approximate quantile of the specified level.<br>Type:</li>
<li>Float64 for numeric data type input. </li>
<li>Date if input values have the <code>Date</code> type.</li>
<li>DateTime if input values have the <code>DateTime</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantile(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantile(number)─┐</span><br><span class="line">│ 4.5e+00          │</span><br><span class="line">└──────────────────┘</span><br></pre></td></tr></table></figure>


<h2 id="quantileDeterministic"><a href="#quantileDeterministic" class="headerlink" title="quantileDeterministic"></a>quantileDeterministic</h2><p>Computes an approximate <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence.</p>
<p>This function applies <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Reservoir_sampling">reservoir sampling</a> with a reservoir size up to 8192 and deterministic algorithm of sampling. The result is deterministic. To get an exact quantile, use the quantileExact function.</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileDeterministic(level)(expr, determinator)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>medianDeterministic</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over the column values resulting in numeric data types, Date or DateTime. </li>
<li><code>determinator</code> — Number whose hash is used instead of a random number generator in the reservoir sampling algorithm to make the result of sampling deterministic. As a determinator you can use any deterministic positive number, for example, a user id or an event id. If the same determinator value occures too often, the function works incorrectly.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Approximate quantile of the specified level.<br>Type:</li>
<li>Float64 for numeric data type input. </li>
<li>Date if input values have the <code>Date</code> type.</li>
<li>DateTime if input values have the <code>DateTime</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantileDeterministic(number, <span class="number">1</span>) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantileDeterministic(number, 1)─┐</span><br><span class="line">│ 4.5e+00                          │</span><br><span class="line">└──────────────────────────────────┘</span><br></pre></td></tr></table></figure>


<h2 id="quantileExact"><a href="#quantileExact" class="headerlink" title="quantileExact"></a>quantileExact</h2><p>Exactly computes the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence.</p>
<p>To get exact value, all the passed values are combined into an array, which is then partially sorted. Therefore, the function consumes <code>O(n)</code> memory, where <code>n</code> is a number of values that were passed. However, for a small number of values, the function is very effective.</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileExact(level)(expr)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>medianExact</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over the column values resulting in numeric data types, Date or DateTime.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Quantile of the specified level.<br>Type:</li>
<li>Float64 for numeric data type input. </li>
<li>Date if input values have the <code>Date</code> type. </li>
<li>DateTime if input values have the <code>DateTime</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantileExact(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantileExact(number)─┐</span><br><span class="line">│                     5 │</span><br><span class="line">└───────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="quantileExactWeighted"><a href="#quantileExactWeighted" class="headerlink" title="quantileExactWeighted"></a>quantileExactWeighted</h2><p>Exactly computes the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence, taking into account the weight of each element.</p>
<p>To get exact value, all the passed values are combined into an array, which is then partially sorted. Each value is counted with its weight, as if it is present <code>weight</code> times. A hash table is used in the algorithm. Because of this, if the passed values are frequently repeated, the function consumes less RAM than quantileExact. You can use this function instead of <code>quantileExact</code> and specify the weight 1.</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileExactWeighted(level)(expr, weight)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>medianExactWeighted</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over the column values resulting in numeric, Date or DateTime. </li>
<li><code>weight</code> — Column with weights of sequence members. Weight is a number of value occurrences.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Quantile of the specified level.<br>Type:</li>
<li>Float64 for numeric data type input. </li>
<li>Date if input values have the <code>Date</code> type. </li>
<li>DateTime if input values have the <code>DateTime</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionQuantileExactWeighted (n UInt8, val UInt8) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> n;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionQuantileExactWeighted <span class="keyword">VALUES</span> (<span class="number">0</span>,<span class="number">3</span>),(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">2</span>,<span class="number">1</span>),(<span class="number">5</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">SELECT</span> quantileExactWeighted(n, val) <span class="keyword">FROM</span> test.functionQuantileExactWeighted;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantileExactWeighted(n, val)─┐</span><br><span class="line">│                             1 │</span><br><span class="line">└───────────────────────────────┘</span><br></pre></td></tr></table></figure>



<h2 id="quantileTDigest"><a href="#quantileTDigest" class="headerlink" title="quantileTDigest"></a>quantileTDigest</h2><p>Computes an approximate <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence using the <a target="_blank" rel="noopener" href="https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf">t-digest</a> algorithm.</p>
<p>Memory consumption is <code>log(n)</code> , where <code>n</code> is a number of values. The result depends on the order of running the query, and is nondeterministic.</p>
<p>The performance of the function is lower than performance of quantile or quantileTiming. In terms of the ratio of State size to precision, this function is much better than <code>quantile</code> .</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileTDigest(level)(expr)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>medianTDigest</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over the column values resulting in numeric data types, Date or DateTime.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Approximate quantile of the specified level.<br>Type:</li>
<li>Float64 for numeric data type input. </li>
<li>Date if input values have the <code>Date</code> type. </li>
<li>DateTime if input values have the <code>DateTime</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantileTDigest(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantileTDigest(number)─┐</span><br><span class="line">│ 4.5e+00                 │</span><br><span class="line">└─────────────────────────┘</span><br></pre></td></tr></table></figure>


<h2 id="quantileTDigestWeighted"><a href="#quantileTDigestWeighted" class="headerlink" title="quantileTDigestWeighted"></a>quantileTDigestWeighted</h2><p>Computes an approximate <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence using the <a target="_blank" rel="noopener" href="https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf">t-digest</a> algorithm. The function takes into account the weight of each sequence member. The maximum error is 1%. Memory consumption is <code>log(n)</code> , where <code>n</code> is a number of values.</p>
<p>The performance of the function is lower than the performance of quantile or quantileTiming. In terms of the ratio of State size to precision, this function is much better than <code>quantile</code>.</p>
<p>The result depends on the order of running the query and is nondeterministic.</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p>[block:callout]<br>{<br>  “type”: “info”,<br>  “title”: “Note”,<br>  “body”: “Using <code>quantileTDigestWeighted</code> <a target="_blank" rel="noopener" href="https://github.com/tdunning/t-digest/issues/167#issuecomment-828650275">is not recommended for tiny data sets</a> and can lead to significat error. In this case, consider possibility of using <code>quantileTDigest</code> instead.”<br>}<br>[&#x2F;block]<br><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileTDigestWeighted(level)(expr, weight)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>medianTDigestWeighted</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over the column values resulting in numeric data types, Date or DateTime. </li>
<li><code>weight</code> — Column with weights of sequence elements. Weight is a number of value occurrences.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Approximate quantile of the specified level.<br>Type:</li>
<li>Float64 for numeric data type input. </li>
<li>Date if input values have the <code>Date</code> type. </li>
<li>DateTime if input values have the <code>DateTime</code> type.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantileTDigestWeighted(number, <span class="number">1</span>) <span class="keyword">FROM</span> numbers(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantileTDigestWeighted(number, 1)─┐</span><br><span class="line">│ 4.5e+00                            │</span><br><span class="line">└────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="quantileTiming"><a href="#quantileTiming" class="headerlink" title="quantileTiming"></a>quantileTiming</h2><p>With the determined precision computes the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence.</p>
<p>The result is deterministic (it does not depend on the query processing order). The function is optimized for working with sequences which describe distributions like loading web pages times or backend response times.</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileTiming(level)(expr)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>medianTiming</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over a column values returning a Float* -type number. <ul>
<li>If negative values are passed to the function, the behavior is undefined. </li>
<li>If the value is greater than 30,000 (a page loading time of more than 30 seconds), it is assumed to be 30,000.</li>
</ul>
</li>
</ul>
<p><strong>Accuracy</strong><br>The calculation is accurate if:</p>
<ul>
<li>Total number of values does not exceed 5670. </li>
<li>Total number of values exceeds 5670, but the page loading time is less than 1024ms.</li>
</ul>
<p>Otherwise, the result of the calculation is rounded to the nearest multiple of 16 ms.</p>
<p>!!! note “Note”<br>For calculating page loading time quantiles, this function is more effective and accurate than quantile.</p>
<p><strong>Returned value</strong></p>
<ul>
<li>Quantile of the specified level.<br>Type: <code>Float32</code> .</li>
</ul>
<p>!!! note “Note”<br>If no values are passed to the function (when using <code>quantileTimingIf</code> ), NaN is returned. The purpose of this is to differentiate these cases from cases that result in zero. See ORDER BY clause for notes on sorting <code>NaN</code> values.</p>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionQuantileTiming (response_time UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> response_time;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionQuantileTiming <span class="keyword">VALUES</span> (<span class="number">72</span>),(<span class="number">112</span>),(<span class="number">126</span>),(<span class="number">145</span>),(<span class="number">104</span>),(<span class="number">242</span>),(<span class="number">313</span>),(<span class="number">168</span>),(<span class="number">108</span>);</span><br><span class="line"><span class="keyword">SELECT</span> quantileTiming(response_time) <span class="keyword">FROM</span> test.functionQuantileTiming;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantileTiming(response_time)─┐</span><br><span class="line">│ 1.26e+02                      │</span><br><span class="line">└───────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="quantileTimingWeighted"><a href="#quantileTimingWeighted" class="headerlink" title="quantileTimingWeighted"></a>quantileTimingWeighted</h2><p>With the determined precision computes the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quantile">quantile</a> of a numeric data sequence according to the weight of each sequence member.</p>
<p>The result is deterministic (it does not depend on the query processing order). The function is optimized for working with sequences which describe distributions like loading web pages times or backend response times.</p>
<p>When using multiple <code>quantile*</code> functions with different levels in a query, the internal states are not combined (that is, the query works less efficiently than it could). In this case, use the quantiles function.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileTimingWeighted(level)(expr, weight)</span><br></pre></td></tr></table></figure>
<p>Alias: <code>medianTimingWeighted</code> .</p>
<p><strong>Arguments</strong></p>
<ul>
<li><code>level</code> — Level of quantile. Optional parameter. Constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code> . Default value: 0.5. At <code>level=0.5</code> the function calculates <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Median">median</a> . </li>
<li><code>expr</code> — Expression over a column values returning a Float* -type number. </li>
<li>If negative values are passed to the function, the behavior is undefined.</li>
<li>If the value is greater than 30,000 (a page loading time of more than 30 seconds), it is assumed to be 30,000.</li>
<li><code>weight</code> — Column with weights of sequence elements. Weight is a number of value occurrences.</li>
</ul>
<p><strong>Accuracy</strong><br>The calculation is accurate if:</p>
<ul>
<li>Total number of values does not exceed 5670. </li>
<li>Total number of values exceeds 5670, but the page loading time is less than 1024ms.</li>
</ul>
<p>Otherwise, the result of the calculation is rounded to the nearest multiple of 16 ms.</p>
<p>!!! note “Note”<br>For calculating page loading time quantiles, this function is more effective and accurate than quantile.</p>
<p><strong>Returned value</strong></p>
<ul>
<li>Quantile of the specified level.<br>Type: <code>Float32</code> .</li>
</ul>
<p>!!! note “Note”<br>If no values are passed to the function (when using <code>quantileTimingIf</code> ), NaN is returned. The purpose of this is to differentiate these cases from cases that result in zero. See ORDER BY clause for notes on sorting <code>NaN</code> values.</p>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionQuantileTimingWeighted (response_time UInt32, weight UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> response_time;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionQuantileTimingWeighted <span class="keyword">VALUES</span> (<span class="number">68</span>,<span class="number">1</span>),(<span class="number">104</span>,<span class="number">2</span>),(<span class="number">112</span>,<span class="number">3</span>),(<span class="number">126</span>,<span class="number">2</span>),(<span class="number">138</span>,<span class="number">1</span>),(<span class="number">162</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> quantileTimingWeighted(response_time, weight) <span class="keyword">FROM</span> test.functionQuantileTimingWeighted;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantileTimingWeighted(response_time, weight)─┐</span><br><span class="line">│ 1.12e+02                                      │</span><br><span class="line">└───────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="quantiles"><a href="#quantiles" class="headerlink" title="quantiles"></a>quantiles</h2><p>All the quantile functions also have corresponding quantiles functions: <code>quantiles</code> , <code>quantilesDeterministic</code> , <code>quantilesTiming</code> , <code>quantilesTimingWeighted</code> , <code>quantilesExact</code> , <code>quantilesExactWeighted</code> , <code>quantilesTDigest</code> , <code>quantilesBFloat16</code> . These functions calculate all the quantiles of the listed levels in one pass, and return an array of the resulting values.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantiles(level1, level2, …)(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>level1,level2...</code> — Levels of quantiles. Each level is a constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code>.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>A list of quantiles.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> quantiles(<span class="number">0.5</span>,<span class="number">0.4</span>)(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantiles(0.5, 0.4)(number)─┐</span><br><span class="line">│ [4.5e+00, 3.6e+00]          │</span><br><span class="line">└─────────────────────────────┘</span><br></pre></td></tr></table></figure>
<p>quantiles(0.5,0.4)(number) equivalent to quantile(0.5)(number) and quantile(0.4)(number).</p>
<h2 id="quantilesTimingWeighted"><a href="#quantilesTimingWeighted" class="headerlink" title="quantilesTimingWeighted"></a>quantilesTimingWeighted</h2><p>Same as <code>quantileTimingWeighted</code> , but accept multiple parameters with quantile levels and return an Array filled with many values of that quantiles.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantileTimingWeighted(level1, level2, …)(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>level1,level2...</code> — Levels of quantiles. Each level is a constant floating-point number from 0 to 1. We recommend using a <code>level</code> value in the range of <code>[0.01, 0.99]</code>.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>A list of quantiles.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionQuantilesTimingWeighted (response_time UInt32, weight UInt32) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> response_time;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionQuantilesTimingWeighted <span class="keyword">VALUES</span> (<span class="number">68</span>,<span class="number">1</span>),(<span class="number">104</span>,<span class="number">2</span>),(<span class="number">112</span>,<span class="number">3</span>),(<span class="number">126</span>,<span class="number">2</span>),(<span class="number">138</span>,<span class="number">1</span>),(<span class="number">162</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> quantilesTimingWeighted(<span class="number">0.5</span>, <span class="number">0.99</span>)(response_time, weight) <span class="keyword">FROM</span> test.functionQuantilesTimingWeighted;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─quantilesTimingWeighted(0.5, 0.99)(response_time, weight)─┐</span><br><span class="line">│ [1.12e+02, 1.62e+02]                                      │</span><br><span class="line">└───────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>



<h2 id="sequenceCount"><a href="#sequenceCount" class="headerlink" title="sequenceCount"></a>sequenceCount</h2><p>sequenceCount(pattern)(time, cond1, cond2, …)</p>
<p>Counts the number of event chains that matched the pattern. The function searches event chains that do not overlap. It starts to search for the next chain after the current chain is matched.</p>
<p>!!! warning “Warning”<br>Events that occur at the same second may lay in the sequence in an undefined order affecting the result.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequenceCount(<span class="keyword">pattern</span>)(<span class="type">timestamp</span>, cond1, cond2, ...)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>pattern</code> — Pattern string. See Pattern syntax. </li>
<li><code>timestamp</code> — Column considered to contain time data. Typical data types are <code>Date</code> and <code>DateTime</code> . You can also use any of the supported UInt data types. </li>
<li><code>cond1</code> , <code>cond2</code> — Conditions that describe the chain of events. Data type: <code>UInt8</code> . You can pass up to 32 condition arguments. The function takes only the events described in these conditions into account. If the sequence contains data that isn’t described in a condition, the function skips them.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>Number of non-overlapping event chains that are matched.<br>Type: <code>UInt64</code> .</li>
</ul>
<p><strong>Example</strong><br>Count how many times the number 2 occurs after the number 1 with any amount of other numbers between them:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.functionSequenceCount (<span class="type">time</span> DateTime, number UInt8) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">time</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionSequenceCount <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">3</span>),(<span class="number">3</span>,<span class="number">2</span>),(<span class="number">4</span>,<span class="number">1</span>),(<span class="number">5</span>,<span class="number">3</span>),(<span class="number">6</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> sequenceCount(<span class="string">&#x27;(?1).*(?2)&#x27;</span>)(<span class="type">time</span>, number <span class="operator">=</span> <span class="number">1</span>, number <span class="operator">=</span> <span class="number">2</span>) <span class="keyword">FROM</span> test.functionSequenceCount;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─sequenceCount(&#x27;(?1).*(?2)&#x27;)(time, equals(number, 1), equals(number, 2))─┐</span><br><span class="line">│                                                                       2 │</span><br><span class="line">└─────────────────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>



<h2 id="sequenceMatch"><a href="#sequenceMatch" class="headerlink" title="sequenceMatch"></a>sequenceMatch</h2><p>sequenceMatch(pattern)(timestamp, cond1, cond2, …)</p>
<p>Checks whether the sequence contains an event chain that matches the pattern.</p>
<p>!!! warning “Warning”<br>Events that occur at the same second may lay in the sequence in an undefined order affecting the result.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sequenceMatch(<span class="keyword">pattern</span>)(<span class="type">timestamp</span>, cond1, cond2, ...)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>pattern</code> — Pattern string. See Pattern syntax. </li>
<li><code>timestamp</code> — Column considered to contain time data. Typical data types are <code>Date</code> and <code>DateTime</code> . You can also use any of the supported UInt data types. </li>
<li><code>cond1</code> , <code>cond2</code> — Conditions that describe the chain of events. Data type: <code>UInt8</code> . You can pass up to 32 condition arguments. The function takes only the events described in these conditions into account. If the sequence contains data that isn’t described in a condition, the function skips them.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>1, if the pattern is matched. </li>
<li>0, if the pattern isn’t matched.<br>Type: <code>UInt8</code> .</li>
</ul>
<p><strong>Pattern syntax</strong></p>
<ul>
<li><code>(?N)</code> — Matches the condition argument at position <code>N</code> . Conditions are numbered in the <code>[1, 32]</code> range. For example, <code>(?1)</code> matches the argument passed to the <code>cond1</code> parameter. </li>
<li><code>.*</code> — Matches any number of events. You do not need conditional arguments to match this element of the pattern. </li>
<li><code>(?t operator value)</code> — Sets the time in seconds that should separate two events. For example, pattern <code>(?1)(?t&gt;1800)(?2)</code> matches events that occur more than 1800 seconds from each other. An arbitrary number of any events can lay between these events. You can use the <code>&gt;=</code> , <code>&gt;</code> , <code>&lt;</code> , <code>&lt;=</code> , <code>==</code> operators.</li>
</ul>
<p><strong>Examples</strong><br>Consider data in the <code>t</code> table:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">┌─time─┬─number─┐</span><br><span class="line"></span><br><span class="line">│    1 │      1 │</span><br><span class="line"></span><br><span class="line">│    2 │      3 │</span><br><span class="line"></span><br><span class="line">│    3 │      2 │</span><br><span class="line"></span><br><span class="line">└──────┴────────┘</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Perform the query:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionSequenceMatch (<span class="type">time</span> DateTime, number UInt8) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">time</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionSequenceMatch <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">3</span>),(<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> sequenceMatch(<span class="string">&#x27;(?1)(?2)&#x27;</span>)(<span class="type">time</span>, number <span class="operator">=</span> <span class="number">1</span>, number <span class="operator">=</span> <span class="number">2</span>) <span class="keyword">FROM</span> test.functionSequenceMatch;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─sequenceMatch(&#x27;(?1)(?2)&#x27;)(time, equals(number, 1), equals(number, 2))─┐</span><br><span class="line">│                                                                     1 │</span><br><span class="line">└───────────────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>
<p>The function found the event chain where number 2 follows number 1. It skipped number 3 between them, because the number is not described as an event. If we want to take this number into account when searching for the event chain given in the example, we should make a condition for it.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sequenceMatch(<span class="string">&#x27;(?1)(?2)&#x27;</span>)(<span class="type">time</span>, number <span class="operator">=</span> <span class="number">1</span>, number <span class="operator">=</span> <span class="number">2</span>, number <span class="operator">=</span> <span class="number">3</span>) <span class="keyword">FROM</span> test.functionSequenceMatch;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─sequenceMatch(&#x27;(?1)(?2)&#x27;)(time, equals(number, 1), equals(number, 2), equals(number, 3))─┐</span><br><span class="line">│                                                                                        0 │</span><br><span class="line">└──────────────────────────────────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>In this case, the function couldn’t find the event chain matching the pattern, because the event for number 3 occured between 1 and 2. If in the same case we checked the condition for number 4, the sequence would match the pattern.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sequenceMatch(<span class="string">&#x27;(?1)(?2)&#x27;</span>)(<span class="type">time</span>, number <span class="operator">=</span> <span class="number">1</span>, number <span class="operator">=</span> <span class="number">2</span>, number <span class="operator">=</span> <span class="number">4</span>) <span class="keyword">FROM</span> test.functionSequenceMatch;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─sequenceMatch(&#x27;(?1)(?2)&#x27;)(time, equals(number, 1), equals(number, 2), equals(number, 4))─┐</span><br><span class="line">│                                                                                        1 │</span><br><span class="line">└──────────────────────────────────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>



<h2 id="stddevPop"><a href="#stddevPop" class="headerlink" title="stddevPop"></a>stddevPop</h2><p>The result is equal to the square root of varPop.</p>
<p>This function uses a numerically unstable algorithm. If you need <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Numerical_stability">numerical stability</a> in calculations, use the <code>stddevPopStable</code> function. It works slower but provides a lower computational error.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stddevPop(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>values</code> — input values.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>stddevPop of values. Returns Float64.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> stddevPop(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─stddevPop(number)──────┐</span><br><span class="line">│ 2.8722813232690143e+00 │</span><br><span class="line">└────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="stddevSamp"><a href="#stddevSamp" class="headerlink" title="stddevSamp"></a>stddevSamp</h2><p>The result is equal to the square root of varSamp.</p>
<p>This function uses a numerically unstable algorithm. If you need <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Numerical_stability">numerical stability</a> in calculations, use the <code>stddevSampStable</code> function. It works slower but provides a lower computational error.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stddevSamp(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>values</code> — input values.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>stddevSamp of values. Returns Float64.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> stddevSamp(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─stddevSamp(number)─────┐</span><br><span class="line">│ 3.0276503540974917e+00 │</span><br><span class="line">└────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="STDDEV-POP"><a href="#STDDEV-POP" class="headerlink" title="STDDEV_POP"></a>STDDEV_POP</h2><p>Alias to stddevPop.</p>
<h2 id="STDDEV-SAMP"><a href="#STDDEV-SAMP" class="headerlink" title="STDDEV_SAMP"></a>STDDEV_SAMP</h2><p>Alias to stddevSamp.</p>
<h2 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h2><p>Calculates the sum. Only works for numbers.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>values</code> — input values.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>sum of values. Type is same as values</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">sum</span>(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─sum(number)─┐</span><br><span class="line">│ 45          │</span><br><span class="line">└─────────────┘</span><br></pre></td></tr></table></figure>
<p>sum from 0 to 9.</p>
<h2 id="sumKahan"><a href="#sumKahan" class="headerlink" title="sumKahan"></a>sumKahan</h2><p>Calculates the sum of the numbers with <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kahan_summation_algorithm">Kahan compensated summation algorithm</a><br>Slower than sum function.</p>
<p>The compensation works only for Float types.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sumKahan(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong> </p>
<ul>
<li><code>x</code> — Input value, must be Integer, Float, or Decimal.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>the sum of numbers, with type Integer, Float, or Decimal depends on type of input arguments</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">sum</span>(<span class="number">0.1</span>), sumKahan(<span class="number">0.1</span>) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─sum(0.1)──────────────┬─sumKahan(0.1)─┐</span><br><span class="line">│ 9.999999999999999e-01 │ 1e+00         │</span><br><span class="line">└───────────────────────┴───────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="sumMap"><a href="#sumMap" class="headerlink" title="sumMap"></a>sumMap</h2><p>Totals the <code>value</code> array according to the keys specified in the <code>key</code> array.<br>The number of elements in <code>key</code> and <code>value</code> must be the same for each row that is totaled.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sumMap(key, <span class="keyword">value</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Arguments</strong> </p>
<ul>
<li><code>key</code> — Input keys. Type Array</li>
<li><code>value</code> — Input values. Type Array</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Returns a tuple of two arrays: keys in sorted order, and values summed for the corresponding keys.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.functionSumMap(</span><br><span class="line">    <span class="type">date</span> <span class="type">Date</span>,</span><br><span class="line">    timeslot DateTime,</span><br><span class="line">    status UInt16,</span><br><span class="line">    requests UInt64</span><br><span class="line">) ENGINE <span class="operator">=</span> CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">date</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionSumMap <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:00:00&#x27;</span>, <span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:00:00&#x27;</span>, <span class="number">1</span>,<span class="number">5</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:00:00&#x27;</span>, <span class="number">3</span>,<span class="number">4</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:01:00&#x27;</span>, <span class="number">5</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:01:00&#x27;</span>, <span class="number">7</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> timeslot, sumMap([status], [requests]) <span class="keyword">FROM</span> test.functionSumMap <span class="keyword">GROUP</span> <span class="keyword">BY</span> timeslot;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌─timeslot────────────┬─sumMap(array(status), array(requests))─┐</span><br><span class="line">│ 2000-01-01 00:00:00 │ ([1, 3], [7, 4])                       │</span><br><span class="line">│ 2000-01-01 00:01:00 │ ([5, 7], [6, 8])                       │</span><br><span class="line">└─────────────────────┴────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="sumMapFiltered"><a href="#sumMapFiltered" class="headerlink" title="sumMapFiltered"></a>sumMapFiltered</h2><p>Same behavior as sumMap except that an array of keys is passed as a parameter. This can be especially useful when working with a high cardinality of keys.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sumMapFiltered(keys_to_keep)(keys, <span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Arguments</strong> </p>
<ul>
<li><code>keys_to_keep</code> - Input keys_to_keep. Type Array</li>
<li><code>key</code> — Input keys. Type Array</li>
<li><code>value</code> — Input values. Type Array</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Returns a tuple of two arrays: keys in sorted order, and values summed for the corresponding keys.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.functionSumMapFiltered(</span><br><span class="line">    <span class="type">date</span> <span class="type">Date</span>,</span><br><span class="line">    timeslot DateTime,</span><br><span class="line">    status UInt16,</span><br><span class="line">    requests UInt64</span><br><span class="line">) ENGINE <span class="operator">=</span> CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">date</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionSumMapFiltered <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:00:00&#x27;</span>, <span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:00:00&#x27;</span>, <span class="number">1</span>,<span class="number">5</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:00:00&#x27;</span>, <span class="number">3</span>,<span class="number">4</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:01:00&#x27;</span>, <span class="number">5</span>,<span class="number">6</span>),</span><br><span class="line">    (<span class="string">&#x27;2000-01-01&#x27;</span>, <span class="string">&#x27;2000-01-01 00:01:00&#x27;</span>, <span class="number">7</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> timeslot, sumMapFiltered([<span class="number">1</span>])([status], [requests]) <span class="keyword">FROM</span> test.functionSumMapFiltered <span class="keyword">GROUP</span> <span class="keyword">BY</span> timeslot;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌─timeslot────────────┬─sumMapFiltered([1])(array(status), array(requests))─┐</span><br><span class="line">│ 2000-01-01 00:00:00 │ ([1], [7])                                          │</span><br><span class="line">│ 2000-01-01 00:01:00 │ ([], [])                                            │</span><br><span class="line">└─────────────────────┴─────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="sumWithOverflow"><a href="#sumWithOverflow" class="headerlink" title="sumWithOverflow"></a>sumWithOverflow</h2><p>Computes the sum of the numbers, using the same data type for the result as for the input parameters. If the sum exceeds the maximum value for this data type, it is calculated with overflow.</p>
<p>Only works for numbers.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sumWithOverflow(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Arguments</strong> </p>
<ul>
<li><code>values</code> - Input Values.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>Sum of the numbers.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> test.functionSumWithOverflow (x UInt8) ENGINE<span class="operator">=</span>CnchMergeTree <span class="keyword">ORDER</span> <span class="keyword">BY</span> x;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test.functionSumWithOverflow <span class="keyword">values</span> (<span class="number">254</span>),(<span class="number">254</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">sum</span>(x), sumWithOverflow(x) <span class="keyword">FROM</span> test.functionSumWithOverflow;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─sum(x)─┬─sumWithOverflow(x)─┐</span><br><span class="line">│ 508    │ 252                │</span><br><span class="line">└────────┴────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="topK"><a href="#topK" class="headerlink" title="topK"></a>topK</h2><p>Returns an array of the approximately most frequent values in the specified column. The resulting array is sorted in descending order of approximate frequency of values (not by the values themselves).</p>
<p>Implements the <a target="_blank" rel="noopener" href="http://www.l2f.inesc-id.pt/~fmmb/wiki/uploads/Work/misnis.ref0a.pdf">Filtered Space-Saving</a> algorithm for analyzing TopK, based on the reduce-and-combine algorithm from <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1401.0702.pdf">Parallel Space Saving</a> .</p>
<p>This function does not provide a guaranteed result. In certain situations, errors might occur and it might return frequent values that aren’t the most frequent values.</p>
<p>We recommend using the <code>N &lt; 10</code> value; performance is reduced with large <code>N</code> values. Maximum value of <code>N = 65536</code> .</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topK(N)(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>N</code> – The number of elements to return. If the parameter is omitted, default value 10 is used.</li>
<li><code>x</code> – The values to calculate frequency.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> topK(<span class="number">3</span>)(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─topK(3)(number)─┐</span><br><span class="line">│ [0, 1, 2]       │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="topKWeighted"><a href="#topKWeighted" class="headerlink" title="topKWeighted"></a>topKWeighted</h2><p>Returns an array of the approximately most frequent values in the specified column. The resulting array is sorted in descending order of approximate frequency of values (not by the values themselves). Additionally, the weight of the value is taken into account.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topKWeighted(N)(x, weight)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>N</code> — The number of elements to return. </li>
<li><code>x</code> — The value. </li>
<li><code>weight</code> — The weight. Every value is accounted <code>weight</code> times for frequency calculation. UInt64.</li>
</ul>
<p><strong>Returned value</strong><br>Returns an array of the values with maximum approximate sum of weights.</p>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> topKWeighted(<span class="number">10</span>)(number, number) <span class="keyword">FROM</span> numbers(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<!-- TODO: Verified WITH CNCH. Result Incorrect. -->

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─topKWeighted(10)(number, number)──────────┐</span><br><span class="line">│ [999,998,997,996,995,994,993,992,991,990] │</span><br><span class="line">└───────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>



<h2 id="uniq"><a href="#uniq" class="headerlink" title="uniq"></a>uniq</h2><p>Calculates the approximate number of different values of the argument.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniq(x[, ...])</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li>The function takes a variable number of parameters. Parameters can be <code>Tuple</code> , <code>Array</code> , <code>Date</code> , <code>DateTime</code> , <code>String</code> , or numeric types.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>A UInt64 -type number.</li>
</ul>
<p><strong>Implementation details</strong><br>Function:</p>
<ul>
<li>Calculates a hash for all parameters in the aggregate, then uses it in calculations. </li>
<li>Uses an adaptive sampling algorithm. For the calculation state, the function uses a sample of element hash values up to 65536.</li>
</ul>
<p>This algorithm is very accurate and very efficient on the CPU. When the query contains several of these functions, using <code>uniq</code> is almost as fast as using other aggregate functions.This algorithm is very accurate and very efficient on the CPU. When the query contains several of these functions, using <code>uniq</code> is almost as fast as using other aggregate functions.</p>
<ul>
<li>Provides the result deterministically (it does not depend on the query processing order).</li>
</ul>
<p>We recommend using this function in almost all scenarios.</p>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uniq(number) <span class="keyword">FROM</span> numbers(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>



<h2 id="uniqCombined"><a href="#uniqCombined" class="headerlink" title="uniqCombined"></a>uniqCombined</h2><p>Calculates the approximate number of different argument values.<br>The <code>uniqCombined</code> function is a good choice for calculating the number of different values.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniqCombined(HLL_precision)(x[, ...])</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li>The function takes a variable number of parameters. Parameters can be <code>Tuple</code> , <code>Array</code> , <code>Date</code> , <code>DateTime</code> , <code>String</code> , or numeric types.</li>
<li><code>HLL_precision</code> is the base-2 logarithm of the number of cells in <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/HyperLogLog">HyperLogLog</a> . Optional, you can use the function as <code>uniqCombined(x[, ...])</code> . The default value for <code>HLL_precision</code> is 17, which is effectively 96 KiB of space (2^17 cells, 6 bits each).</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>A number UInt64 -type number.</li>
</ul>
<p><strong>Implementation details</strong><br>Function:</p>
<ul>
<li>Calculates a hash (64-bit hash for <code>String</code> and 32-bit otherwise) for all parameters in the aggregate, then uses it in calculations. </li>
<li>Uses a combination of three algorithms: array, hash table, and HyperLogLog with an error correction table.</li>
</ul>
<p>For a small number of distinct elements, an array is used. When the set size is larger, a hash table is used. For a larger number of elements, HyperLogLog is used, which will occupy a fixed amount of memory.For a small number of distinct elements, an array is used. When the set size is larger, a hash table is used. For a larger number of elements, HyperLogLog is used, which will occupy a fixed amount of memory.</p>
<ul>
<li>Provides the result deterministically (it does not depend on the query processing order).</li>
</ul>
<p>Note</p>
<p>Since it uses 32-bit hash for non- <code>String</code> type, the result will have very high error for cardinalities significantly larger than <code>UINT_MAX</code> (error will raise quickly after a few tens of billions of distinct values), hence in this case you should use uniqCombined64</p>
<p>Compared to the uniq function, the <code>uniqCombined</code> :</p>
<ul>
<li>Consumes several times less memory. </li>
<li>Calculates with several times higher accuracy. </li>
<li>Usually has slightly lower performance. In some scenarios, <code>uniqCombined</code> can perform better than <code>uniq</code> , for example, with distributed queries that transmit a large number of aggregation states over the network.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uniqCombined(number) <span class="keyword">FROM</span> numbers(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="uniqExact"><a href="#uniqExact" class="headerlink" title="uniqExact"></a>uniqExact</h2><p>Calculates the exact number of different argument values.</p>
<p>Use the <code>uniqExact</code> function if you absolutely need an exact result. Otherwise use the uniq function.</p>
<p>The <code>uniqExact</code> function uses more memory than <code>uniq</code> , because the size of the state has unbounded growth as the number of different values increases.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniqExact(x[, ...])</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong><br>The function takes a variable number of parameters. Parameters can be <code>Tuple</code> , <code>Array</code> , <code>Date</code> , <code>DateTime</code> , <code>String</code> , or numeric types.</p>
<p><strong>Returned value</strong></p>
<ul>
<li>A number UInt64 -type number.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uniqExact(number) <span class="keyword">FROM</span> numbers(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─uniqExact(number)─┐</span><br><span class="line">│ 1000              │</span><br><span class="line">└───────────────────┘</span><br></pre></td></tr></table></figure>
<h2 id="uniqHLL12"><a href="#uniqHLL12" class="headerlink" title="uniqHLL12"></a>uniqHLL12</h2><p>Calculates the approximate number of different argument values, using the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/HyperLogLog">HyperLogLog</a> algorithm.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniqHLL12(x[, ...])</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong><br>The function takes a variable number of parameters. Parameters can be <code>Tuple</code> , <code>Array</code> , <code>Date</code> , <code>DateTime</code> , <code>String</code> , or numeric types.</p>
<p><strong>Returned value</strong></p>
<ul>
<li>A UInt64 -type number.</li>
</ul>
<p><strong>Implementation details</strong><br>Function:</p>
<ul>
<li>Calculates a hash for all parameters in the aggregate, then uses it in calculations. </li>
<li>Uses the HyperLogLog algorithm to approximate the number of different argument values.<br>2^12 5-bit cells are used. The size of the state is slightly more than 2.5 KB. The result is not very accurate (up to ~10% error) for small data sets (&lt;10K elements). However, the result is fairly accurate for high-cardinality data sets (10K-100M), with a maximum error of ~1.6%. Starting from 100M, the estimation error increases, and the function will return very inaccurate results for data sets with extremely high cardinality (1B+ elements).</li>
<li>Provides the determinate result (it does not depend on the query processing order).</li>
</ul>
<p>We do not recommend using this function. In most cases, use the uniq or uniqCombined function.</p>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uniqHLL12(number) <span class="keyword">FROM</span> numbers(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="uniqUpTo"><a href="#uniqUpTo" class="headerlink" title="uniqUpTo"></a>uniqUpTo</h2><p>Calculates the number of different argument values if it is less than or equal to N. If the number of different argument values is greater than N, it returns N + 1.</p>
<p>Recommended for use with small Ns, up to 10. The maximum value of N is 100.</p>
<p>For the state of an aggregate function, it uses the amount of memory equal to 1 + N * the size of one value of bytes.</p>
<p>For strings, it stores a non-cryptographic hash of 8 bytes. That is, the calculation is approximated for strings.</p>
<p>The function also works for several arguments.</p>
<p>It works as fast as possible, except for cases when a large N value is used and the number of unique values is slightly less than N.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uniqUpTo(N)(x)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>N</code> The function takes a variable number of parameters. Parameters can be <code>Tuple</code> , <code>Array</code> , <code>Date</code> , <code>DateTime</code> , <code>String</code> , or numeric types.</li>
</ul>
<p><strong>Returned value</strong></p>
<ul>
<li>A UInt64 -type number.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uniqUpTo(<span class="number">5</span>)(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─uniqUpTo(5)(number)─┐</span><br><span class="line">│ 6                   │</span><br><span class="line">└─────────────────────┘</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uniqUpTo(<span class="number">5</span>)(number) <span class="keyword">FROM</span> numbers(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─uniqUpTo(5)(number)─┐</span><br><span class="line">│ 4                   │</span><br><span class="line">└─────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="varPop"><a href="#varPop" class="headerlink" title="varPop"></a>varPop</h2><p>Calculates the amount <code>Σ((x - x̅)^2) / n</code> , where <code>n</code> is the sample size and <code>x̅</code> is the average value of <code>x</code> .</p>
<p>This function uses a numerically unstable algorithm. If you need <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Numerical_stability">numerical stability</a> in calculations, use the <code>varPopStable</code> function. It works slower but provides a lower computational error.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">varPop(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>values</code> — input values.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>varPop of values. Returns Float64.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> varPop(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─varPop(number)─┐</span><br><span class="line">│ 8.25e+00       │</span><br><span class="line">└────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="varSamp"><a href="#varSamp" class="headerlink" title="varSamp"></a>varSamp</h2><p>Calculates the amount <code>Σ((x - x̅)^2) / (n - 1)</code> , where <code>n</code> is the sample size and <code>x̅</code> is the average value of <code>x</code> .</p>
<p>It represents an unbiased estimate of the variance of a random variable if passed values form its sample.</p>
<p>This function uses a numerically unstable algorithm. If you need <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Numerical_stability">numerical stability</a> in calculations, use the <code>varSampStable</code> function. It works slower but provides a lower computational error.</p>
<p><strong>Syntax</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">varSamp(<span class="keyword">values</span>)</span><br></pre></td></tr></table></figure>

<p><strong>Arguments</strong></p>
<ul>
<li><code>values</code> — input values.</li>
</ul>
<p><strong>Returned values</strong></p>
<ul>
<li>varSamp of values. Returns Float64.</li>
<li>When <code>n &lt;= 1</code> , returns <code>NaN</code> .</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> varSamp(number) <span class="keyword">FROM</span> numbers(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─varSamp(number)───────┐</span><br><span class="line">│ 9.166666666666666e+00 │</span><br><span class="line">└───────────────────────┘</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> varSamp(number) <span class="keyword">FROM</span> numbers(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌─varSamp(number)─┐</span><br><span class="line">│ NaN             │</span><br><span class="line">└─────────────────┘</span><br></pre></td></tr></table></figure>
<h2 id="VAR-POP"><a href="#VAR-POP" class="headerlink" title="VAR_POP"></a>VAR_POP</h2><p>Alias to varPop.</p>
<h2 id="VAR-SAMP"><a href="#VAR-SAMP" class="headerlink" title="VAR_SAMP"></a>VAR_SAMP</h2><p>Alias to varSamp.</p>

                
            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,linkedin,qq,wechat,weibo" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/zh-cn/docs/SQL%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E/string/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="String">
                        
                        <span class="card-title">String</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-01-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Docs/" class="post-category">
                                    Docs
                                </a>
                            
                            <a href="/categories/Docs/SQL-Syntax/" class="post-category">
                                    SQL_Syntax
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/zh-cn/docs/SQL%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E/functions/arithmetic/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="Arithmetic">
                        
                        <span class="card-title">Arithmetic</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-01-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Docs/" class="post-category">
                                    Docs
                                </a>
                            
                            <a href="/categories/Docs/SQL-Syntax/" class="post-category">
                                    SQL_Syntax
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2023</span>
            
            <!-- <span id="year">2022</span> -->
            <a href="/about" target="_blank">ByteDance Inc.</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/byconity" class="tooltipped" target="_blank" data-tooltip="GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>















    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
