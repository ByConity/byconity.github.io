<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-basic-guide/data-import">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Import Data | ByConity</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" name="twitter:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" property="og:url" content="https://byconity.github.io/docs/basic-guide/data-import"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Import Data | ByConity"><meta data-rh="true" name="description" content="Document Type: Tutorial"><meta data-rh="true" property="og:description" content="Document Type: Tutorial"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://byconity.github.io/docs/basic-guide/data-import"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/basic-guide/data-import" hreflang="en"><link data-rh="true" rel="alternate" href="https://byconity.github.io/zh-cn/docs/basic-guide/data-import" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/basic-guide/data-import" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ByConity RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ByConity Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BYY7CCPJZ6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BYY7CCPJZ6",{})</script><link rel="stylesheet" href="/assets/css/styles.ca3e33a6.css">
<link rel="preload" href="/assets/js/runtime~main.e47d5ba9.js" as="script">
<link rel="preload" href="/assets/js/main.1953c696.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_dYNx" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_HwYA"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_rLhL themedImage--light_CjtC"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_rLhL themedImage--dark_quyK"></div><b class="navbar__title text--truncate">ByConity</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/main-principle-concepts">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/users">Users</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="/docs/basic-guide/data-import" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/docs/basic-guide/data-import" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文（中国）</a></li></ul></div><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"><span>GitHub</span></a><div class="searchBox_ldyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MxCR docsWrapper_h_X8"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Kzpt" type="button"></button><div class="docPage_GWs5"><aside class="theme-doc-sidebar-container docSidebarContainer_ldoy"><div class="sidebarViewport_TwFD"><div class="sidebar_H_01 sidebarWithHideableNavbar_Ezn7"><a tabindex="-1" class="sidebarLogo_NiAm" href="/"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_rLhL themedImage--light_CjtC"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_rLhL themedImage--dark_quyK"><b>ByConity</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_J18w"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction/main-principle-concepts">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-syntax/ansi-compatibility">SQL Syntax</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/basic-guide/background-task-management">Basic Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/background-task-management">Background Tasks Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/client-connection">Client Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/cluster-configuration">Cluster Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/data-export">Export Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/basic-guide/data-import">Import Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/data-type">Data Type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/data-visualisation">Data Visualisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/database-table-design">Database Table Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/deployment-requirements">Deployment Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/docker-playground">Docker Playground</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/monitoring">Monitor Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/virtual-warehouse-configuration">Virtual Warehouse Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/advanced-guide/background-task-configuration">Advanced Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/community/become-maintainer">Community</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/deploy-k8s">Deployment</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_baW4"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Njrt"><div class="docItemContainer_ZzVP"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_HWXL" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_IT7R"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Basic Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Import Data</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_GIgr theme-doc-toc-mobile tocMobile_JEhh"><button type="button" class="clean-btn tocCollapsibleButton_Q9up">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Import Data</h1><p>Document Type: Tutorial</p><p>Document structure: tutorial purpose, pre-preparation, step-by-step explanation of principles &amp; examples, and related document recommendations;</p><p>Summary:</p><ol><li>Which methods are supported to import data, and are there any suggestions on the import method (such as directly writing and merging part files after attaching)</li><li>How to connect to upstream supported data sources</li><li>How to check the data import status</li><li>What to do for common import errors</li></ol><h1>Supported data sources</h1><p>Various data import schemes are provided, and different data import methods can be selected for different data sources.</p><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="divide-by-scene">Divide by scene<a href="#divide-by-scene" class="hash-link" aria-label="Direct link to Divide by scene" title="Direct link to Divide by scene">​</a></h2><p>Data source</p><p>Import method</p><p>local files</p><p>Streaming import data (local files and memory data)</p><p>HDFS</p><p>Import from external strorage data</p><p>Kafka</p><p>Import data from Kafka</p><p>Import from spark</p><p>Import external data from Spark</p><p>Mysql、Hive</p><p>Access to external data sources via ByConity</p><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="supported-data-formats">Supported data formats<a href="#supported-data-formats" class="hash-link" aria-label="Direct link to Supported data formats" title="Direct link to Supported data formats">​</a></h2><p>Import method</p><p>Supported Data Formats</p><p>HDFS</p><p>Parquet，ORC，csv，gzip</p><p>Local files and memory data</p><p>snappy compression format</p><p>json, csv, TSKV，Parquet，ORC</p><p>Kafka</p><p>csv, gzip,json</p><h1>Import Method</h1><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="streaming-import-data-local-files-and-memory-data">Streaming import data (local files and memory data)<a href="#streaming-import-data-local-files-and-memory-data" class="hash-link" aria-label="Direct link to Streaming import data (local files and memory data)" title="Direct link to Streaming import data (local files and memory data)">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="method-1">Method 1:<a href="#method-1" class="hash-link" aria-label="Direct link to Method 1:" title="Direct link to Method 1:">​</a></h3><p>Method 1 uses the regular syntax of the VALUES format, which is suitable for temporarily inserting a small amount of data for testing:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO [db.]table [(c1, c2, c3...)] VALUES (v11, v12, v13), (v21, v22, v23), ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Among them, c1, c2, c3 are column field declarations, which can be ignored. Immediately after VALUES is the written data composed of tuples, which corresponds to the column field declaration through subscript bits. The data supports batch statement writing, and multiple lines of data are separated by commas.</p><p>For example, consider this table:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE test.insert_select_testtable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `a` Int8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `b` String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `c` Int8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `date` Date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchMergeTree()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION by toYYYYMM(date)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY tuple()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO insert_select_testtable VALUES (1, &#x27;a&#x27;, 1,&#x27;2022-11-10&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When writing data using the syntax of the VALUES format, expressions or functions are supported, for example:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO insert_select_testtable VALUES (1, &#x27;a&#x27;, 1, now());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="method-2">Method 2:<a href="#method-2" class="hash-link" aria-label="Direct link to Method 2:" title="Direct link to Method 2:">​</a></h3><p>The second way is to use the syntax of the specified format:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO [db.]table [(c1, c2, c3...)] FORMAT format_name data_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ByConity supports multiple data formats, taking the commonly used CSV format as an example:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO insert_select_testtable FORMAT CSV \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1, &#x27;a&#x27;, 1, &#x27;2022-11-10&#x27;\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2, &#x27;b&#x27;, 2, &#x27;2022-11-11&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At the same time, it also supports inserting data into tables from files. For example:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO [db.]table [(c1, c2, c3)] FORMAT format_name INFILE file_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Use the above statement to read data from the client’s file and insert it into the table. file_name and type are both String types, and the format of the input file must be set in the FORMAT statement.</p><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="method-3">Method 3:<a href="#method-3" class="hash-link" aria-label="Direct link to Method 3:" title="Direct link to Method 3:">​</a></h3><p>The third way is to use the form of the SELECT clause, which is suitable for the situation where the results of a certain table need to be saved and used for subsequent queries:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO [db.]table [(c1, c2, c3...)] SELECT ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">The corresponding relationship with the SELECT column when writing is to use the position to correspond, although the names in the SELECT expression and INSERT are different. If necessary, the corresponding type conversion will be performed.</span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The query result can be written into the data table through the SELECT clause. Assuming that the data of insert_select_testtable_1 needs to be written into insert_select_testtable, the following statement can be used:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO insert_select_testtable SELECT * from insert_select_testtable_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When writing data through the SELECT clause, it also supports adding expressions or functions, for example:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO insert_select_testtable SELECT 1, &#x27;a&#x27;, 1, now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Although both the forms of VALUES and SELECT clauses support declaring expressions or functions, expressions and functions will bring additional performance overhead, resulting in degraded write performance. So if you pursue the ultimate write performance. So if you pursue the ultimate write performance, you should avoid using them.</p><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="import-data-from-external-storage">Import data from external storage<a href="#import-data-from-external-storage" class="hash-link" aria-label="Direct link to Import data from external storage" title="Direct link to Import data from external storage">​</a></h2><p>ByConity also supports importing data from local or HDFS, for example:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO [db.]table [(c1, c2, c3)] FORMAT format_name INFILE &#x27;hdfs://ip:port/file_name&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="import-data-using-kakfa">Import data using kakfa<a href="#import-data-using-kakfa" class="hash-link" aria-label="Direct link to Import data using kakfa" title="Direct link to Import data using kakfa">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="function-definition">Function definition<a href="#function-definition" class="hash-link" aria-label="Direct link to Function definition" title="Direct link to Function definition">​</a></h3><p>CnchKafka is a table engine adapted to the cloud-native architecture implemented by ByConity based on the self-developed community ClickHouse Kafka table engine. It is used to efficiently and quickly import user data from Apache Kafka into ByConity in real time; At the same time, some functions have been enhanced based on the community implementation.</p><p>The main features of CnchKafka include:</p><ul><li>Provide automatic fault tolerance based on the advantages of cloud-native architecture to reduce operation and maintenance costs;</li><li>Scalable consumption capability: support to adjust the number of consumers through the SYSTEM command, and the maximum number of partitions corresponding to the topic can be adapted;</li><li>Enhanced consumption semantics: Rely on Transaction guarantee, implement Exactly-Once consumption semantics through engine management offset;</li><li>Consumption performance: largely depends on the schema complexity of the user table, usually the experience value is 2k-2M entries/second, and the throughput is about 15MiB/s;</li><li>Support multiple data types, including but not limited to Json, ProtoBuf, CSV, etc.;</li><li>Supports recording consumption logs, which not only facilitates troubleshooting, but also provides the ability to audit data.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="implementation-principle">Implementation principle<a href="#implementation-principle" class="hash-link" aria-label="Direct link to Implementation principle" title="Direct link to Implementation principle">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h4><p>CnchKafka inherits the basic design of the community, that is, realizes the entire consumption link through a &lt;CnchKafka consumption table, Materialized View materialized view table, storage table&gt; triplet, in which:</p><ul><li>CnchKafka consumption table: responsible for subscribing to Kafka topics and consuming messages; parsing the obtained messages and writing them as Blocks;</li><li>Materialized View materialized view table: build a data path from the consumption table to the storage table, write the block consumed by CnchKafka into the storage table, and provide a simple filtering function;</li><li>Storage table: Support various MergeTree storage tables of Cnch.</li></ul><p>The basic data path is as follows:</p><p><img loading="lazy" src="/assets/images/boxcnbeMipMsWmYggoqbR4DT88c-8f3b6d8f7092df4cbff90bfd5115de2c.png" width="852" height="492" class="img_Ne1E"></p><p>The components in the figure are the components of the ByConity cloud-native architecture that involve CnchKafka. In order to avoid readers&#x27; ignorance, here is a brief description of each component; but due to space limitations and key points, please refer to the architecture document for more detailed architecture design details.</p><ul><li><strong>Server</strong></li><li>Application access layer, the entrance of all query and import tasks;</li><li>Lightweight design, no specific query and import itself, mainly responsible for task scheduling forwarding and metadata access, including:</li><li>Preprocess the query request, read the metadata from the Catalog, send the original data and query sql to the query node, and return the query result to the upper layer (call interface or user, etc.);</li><li>Manage import tasks: select the import node to execute the import task;</li><li>Interact with Catalog to query or update metadata;</li><li>Interact with Resource Manager to select task execution nodes to ensure load balancing;</li><li><strong>Virtual Ware House</strong></li><li>Computing layer, the execution node of all query and import tasks, stateless service;</li><li>Support exclusive use by tenants to achieve resource and data isolation;</li><li>Support read-write separation, query and import can create and specify different Virtual WareHouse;</li><li><strong>Catalog</strong></li><li>KV database, used for metadata management, including database table meta information, part meta information, etc.;</li><li>CnchKafka consumption offset is also stored in the catalog;</li><li><strong>VFS</strong></li><li>Underlying storage, supporting multiple storage systems, including HDFS, S3, etc.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="kafkaconsumemanager">KafkaConsumeManager<a href="#kafkaconsumemanager" class="hash-link" aria-label="Direct link to KafkaConsumeManager" title="Direct link to KafkaConsumeManager">​</a></h4><p>Each CnchKafka consumption table will start a Manager at the server layer to be responsible for scheduling and managing all consumer tasks. The Manager itself is a resident thread on the server side, and its service is guaranteed to be stable through the high availability of the server and DaemonManager.</p><p>The main implementation and functions of KafkaConsumeManager include:</p><ul><li>Distribute the topic partition evenly to each consumer according to the configured number of consumers;</li><li>Interact with the Catalog to obtain the offset consumed by the partition;</li><li>Schedule the consumer to the configured Virtual Warehouse node for execution:</li><li>Node selection supports multiple policy configurations to ensure load balancing;</li><li>Regularly detect each consumer task to ensure the stability of task execution.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="kafkaconsumer">KafkaConsumer<a href="#kafkaconsumer" class="hash-link" aria-label="Direct link to KafkaConsumer" title="Direct link to KafkaConsumer">​</a></h4><p>Each KafkaConsumer is implemented as a resident thread and executed on the Virtual Warehouse node. It is responsible for consuming data from the specified topic partition, converting it into parts and writing it to VFS, and submitting meta information back to the server side for writing to the Catalog. main feature:</p><ul><li>Inherit the batch writing mode of the community (each consumption cycle defaults to 8 seconds);</li><li>Each consumption process guarantees atomicity through Transaction:</li><li>Create transactions by interacting with Server RPC;</li><li>The transaction commit will submit the written part meta-information and the latest consumed offset at the same time.</li></ul><p>Refer to the figure below for the execution process of a single consumption:</p><p><img loading="lazy" src="/assets/images/boxcnlEuwS4ogryA87WHPdDK1Md-d42dcff9e6716fe35060170db3994a06.png" width="852" height="580" class="img_Ne1E"></p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="exactly-once">Exactly-Once<a href="#exactly-once" class="hash-link" aria-label="Direct link to Exactly-Once" title="Direct link to Exactly-Once">​</a></h4><p>Compared with the community implementation, the CnchKafka implementation has enhanced consumption semantics, that is, from the community&#x27;s At-Least-Once semantics to Exactly-Once semantics. This is mainly due to the guarantee of the new architecture Transaction.</p><p>Since each round of consumption will go through transaction management, and the corresponding offset will be submitted at the same time as the data metadata information is submitted each time. Since the transaction guarantees the atomicity of the commit, the data metadata and offset are either submitted successfully at the same time, or both fail to be submitted.</p><p>This ensures that the data and offset are always consistent, and each restart of consumption will continue to consume from the last submitted offset position, thus realizing Exactly-Once.</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="automatic-fault-tolerance-implementation">Automatic fault tolerance implementation<a href="#automatic-fault-tolerance-implementation" class="hash-link" aria-label="Direct link to Automatic fault tolerance implementation" title="Direct link to Automatic fault tolerance implementation">​</a></h4><p>CnchKafka&#x27;s overall fault-tolerant strategy adopts <strong>fast failure</strong> approach, namely:</p><ul><li>KafkaConsumeManager regularly detects consumer tasks, if the detection fails, a new consumer is immediately pulled;</li><li>In each execution of KafkaConsumer, the two interactions with Server RPC (creating transaction and submitting transaction) will verify the validity of itself to the Manager. If the verification fails (for example, the Manager has pulled a new consumer, etc.), it will Take the initiative to kill yourself.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="users-guidance">user&#x27;s guidance<a href="#users-guidance" class="hash-link" aria-label="Direct link to user&#x27;s guidance" title="Direct link to user&#x27;s guidance">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="create-table">Create table<a href="#create-table" class="hash-link" aria-label="Direct link to Create table" title="Direct link to Create table">​</a></h4><p>Creating a CnchKafka consumption table is similar to creating a Kafka table natively in the community. You need to configure the Kafka data source and consumption parameters through the Setting parameter. Examples are as follows:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE kafka_test.cnch_kafka_consume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `i` Int64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `ts` DateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchKafka()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SETTINGS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_broker_list = &#x27;10.10.10.10:9092&#x27;,  -- replace with your own broker list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_topic_list = &#x27;my_kafka_test_topic&#x27;, -- topic name to subcribe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_group_name = &#x27;hansome_boy_consume_group&#x27;, -- your consumer-group name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_format = &#x27;JSONEachRow&#x27;, -- always be json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_row_delimiter = &#x27;\n&#x27;, -- always be \n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_num_consumers = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(For setting parameter description and other more parameter support, please refer to the description below)</p><p>Since the Kafka consumption design requires three tables, two other tables need to be created synchronously.</p><p>First create a storage table (take CnchMergeTree as an example):</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE kafka_test.cnch_store_kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `i` Int64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `ts` DateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchMergeTree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION BY toDate(ts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, create the materialized view table (it must be created after the Kafka table and storage table are successfully created):</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE MATERIALIZED VIEW kafka_test.cnch_kafka_view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TO kafka_test.cnch_store_kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `i` Int64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `ts` DateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * -- you can add virtual columns here if you need</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM kafka_test.cnch_kafka_consume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you have the consumption permission corresponding to the topic, after the three tables are created, the consumption will start automatically.</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="virtual-column-support">Virtual column support<a href="#virtual-column-support" class="hash-link" aria-label="Direct link to Virtual column support" title="Direct link to Virtual column support">​</a></h4><p>Sometimes the business needs to obtain the metadata of Kafka messages (e.g. message partition, offset, etc.). At this time, you can use the virtual columns function to meet this requirement. Virtual columns do not need to be specified when creating a table, they are attributes of the table engine itself. It can be placed in the SELECT statement of the VIEW table and stored in the bottom table (when the corresponding column is added to the bottom table):</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _topic,    -- String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _partition,    -- UInt64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _key,    -- String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _offset,    -- UInt64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _content,  -- String: complete message content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *    -- Normal columns can be expanded by *, virtual columns cannot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM kafka_test.cnch_kafka_consume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="setting-parameter-description">Setting Parameter Description<a href="#setting-parameter-description" class="hash-link" aria-label="Direct link to Setting Parameter Description" title="Direct link to Setting Parameter Description">​</a></h4><p><strong>Parameter Name</strong></p><p><strong>type</strong></p><p><strong>required/default</strong></p><p><strong>Description</strong></p><p>kafka_cluster / kafka_broker_list</p><p>String</p><p>required</p><p>Kafka cluster within the company</p><p>Community version Kafka please use <code>kafka_broker_list</code> parameter</p><p>kafka_topic_list</p><p>String</p><p>required</p><p>Can be multiple, separated by commas</p><p>kafka_group_name</p><p>String</p><p>required</p><p>consumer group name, consumer group</p><p>kafka_format</p><p>String</p><p>required</p><p>Message format; currently most commonly used JSONEachRow</p><p>kafka_row_delimiter</p><p>String</p><p>&#x27;\0&#x27;</p><p>common use &#x27;\n&#x27;</p><p>kafka_num_consumers</p><p>UInt64</p><p>1</p><p>The number of consumers, it is recommended not to exceed the maximum number of partitions in the topic</p><p>kafka_max_block_size</p><p>UInt64</p><p>65536</p><p>write block_size，the upper limit is 1M</p><p>kafka_max_poll_interval_ms</p><p>Milliseconds</p><p>7500</p><p>the max time to poll from broker each iteration</p><p>kafka_schema</p><p>String</p><p>&quot;&quot;</p><p>Schema file setting parameters, set in the format of file name + colon + message name</p><p>Such as: <code>schema.proto:MyMessage</code></p><p>kafka_format_schema_path</p><p>String</p><p>&quot;&quot;</p><p>Remote schema file path (without file name) setting parameter, currently only supports hdfs.</p><p>(If this parameter is not set, it will be read from the default path set in the configuration file)</p><p>kafka_protobuf_enable_multiple_message</p><p>bool</p><p>true</p><p>If set to true, it means that multiple protobuf messages can be read from one kafka message, separated by their respective lengths</p><p>kafka_protobuf_default_length_parser</p><p>bool</p><p>false</p><p>It only takes effect when <code>kafka_protobuf_enable_multiple_message</code> is true: true means that the message header has a variable record length; false means use a fixed 8 bytes as the header record length.</p><p>kafka_extra_librdkafka_config</p><p>Json format string</p><p>&quot;&quot;</p><p>(More params refer to <a href="https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md#:~:text=see%20dedicated%20API-,ssl.ca.location,-*" target="_blank" rel="noopener noreferrer">here</a>)</p><p>Other parameters supported by rdkafka, usually used for authentication</p><ul><li><strong>SCRAM</strong>: &quot;{&quot;sasl.mechanisms&quot;:&quot;SCRAM-SHA-512&quot;,&quot;sasl.password&quot;:&quot;<strong>*<!-- -->&quot;,&quot;sasl.username&quot;:&quot;bytehouse-dev&quot;,&quot;security.protocol&quot;:&quot;sasl_ssl&quot;,&quot;ssl.ca.location&quot;:&quot;</strong>&quot;}&quot;</li><li><strong>PLAIN</strong>: &quot;{&quot;sasl.mechanisms&quot;:&quot;PLAIN&quot;,&quot;sasl.password&quot;:&quot;admin&quot;,&quot;sasl.username&quot;:&quot;admin&quot;,&quot;security.protocol&quot;:&quot;sasl_plaintext&quot;}&quot;</li></ul><p>cnch_vw_write</p><p>String</p><p>&quot;vw_write&quot;</p><p>Configure consumption to use Virtual Warehouse, and the consumer task will be scheduled to the configured Virtual Warehouse node for execution</p><p>kafka_cnch_schedule_mode</p><p>String</p><p>&quot;random&quot;</p><p>The scheduling strategy used by ConsumeManager when scheduling consumer tasks currently supports: random, hash, and <strong>least_consumers; </strong>If it is an independent vw or the number of consumers is greater than 10, it is recommended to use <strong>least_consumers</strong></p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="modify-consumption-parameters">Modify consumption parameters<a href="#modify-consumption-parameters" class="hash-link" aria-label="Direct link to Modify consumption parameters" title="Direct link to Modify consumption parameters">​</a></h4><p>Supports quick modification of Setting parameters through the ALTER command, which is mainly used to adjust the number of consumers and improve consumption capabilities.</p><p>command:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE &lt;cnch_kafka_name&gt; MODIFY SETTING &lt;name1&gt; = &lt;value1&gt;, &lt;name2&gt; = &lt;value2&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Execution of this command will automatically restart the consumption task.</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="manually-start-and-stop-consumption">Manually start and stop consumption<a href="#manually-start-and-stop-consumption" class="hash-link" aria-label="Direct link to Manually start and stop consumption" title="Direct link to Manually start and stop consumption">​</a></h4><p>In some scenarios, users may need to manually stop consumption, and then manually resume; we provide the corresponding SYSTEM command implementation:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">SYSTEM START/STOP/RESTART CONSUME &lt;cnch_kafka_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: The START/STOP command will persist the corresponding state to the Catalog, so after executing the STOP command, if you do not execute START, even if the service restarts, the consumption task will not resume.</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="reset-offset">reset offset<a href="#reset-offset" class="hash-link" aria-label="Direct link to reset offset" title="Direct link to reset offset">​</a></h4><p>Since CnchKafka&#x27;s offset is managed and saved by the engine itself, when the user needs to restart the offset, we also implement the SYSTEM command operation. Specifically, the following three methods are supported:</p><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="a-is-reset-to-a-special-position-latest-positionstart-position">A is reset to a special position: latest position/start position<a href="#a-is-reset-to-a-special-position-latest-positionstart-position" class="hash-link" aria-label="Direct link to A is reset to a special position: latest position/start position" title="Direct link to A is reset to a special position: latest position/start position">​</a></h5><p>command:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">SYSTEM RESET CONSUME OFFSET &#x27;{&quot;database_name&quot;:&quot;XXX&quot;, &quot;table_name&quot;: &quot;XXX&quot;, &quot;offset_value&quot;:-1}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Possible position-specific value values:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">    enum Offset {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_BEGINNING = -2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_END = -1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_STORED = -1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_INVALID = -1001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="b-reset-by-timestamp">B reset by timestamp<a href="#b-reset-by-timestamp" class="hash-link" aria-label="Direct link to B reset by timestamp" title="Direct link to B reset by timestamp">​</a></h5><p>Version requirements &gt;= cnch-1.4) command:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">SYSTEM RESET CONSUME OFFSET &#x27;{&quot;database_name&quot;:&quot;XXX&quot;, &quot;table_name&quot;: &quot;XXX&quot;, &quot;timestamp&quot;:1646125258000}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The value of timestamp should be the timestamp of a certain time within the validity period of the data on the Kafka side, and it is in milliseconds.</p><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="c-specifies-the-offset-specific-value">C specifies the offset specific value<a href="#c-specifies-the-offset-specific-value" class="hash-link" aria-label="Direct link to C specifies the offset specific value" title="Direct link to C specifies the offset specific value">​</a></h5><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">system reset consume offset &#x27;{&quot;database_name&quot;:&quot;XXX&quot;, &quot;table_name&quot;: &quot;XXX&quot;, &quot;topic_name&quot;: &quot;XXX&quot;, &quot;offset_values&quot;:[{&quot;partition&quot;:0, &quot;offset&quot;:100}, {&quot;partition&quot;:10, &quot;offset&quot;:101}]}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is relatively rare to assign a specific topic partition to a specific offset value.</p><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="operation-manual">Operation Manual<a href="#operation-manual" class="hash-link" aria-label="Direct link to Operation Manual" title="Direct link to Operation Manual">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="common-consumer-performance-tuning">Common consumer performance tuning<a href="#common-consumer-performance-tuning" class="hash-link" aria-label="Direct link to Common consumer performance tuning" title="Direct link to Common consumer performance tuning">​</a></h4><p>When consumption continues to lag, it is usually insufficient consumption capacity. CnchKafka creates a table with one consumer by default, and the maximum block size for a single consumption write is 65536. When the consumption capacity is insufficient, the consumer and block-size parameters should be adjusted first. For the adjustment method, refer to the above <strong>Modify Consumption Parameters</strong></p><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="adjust-max-block-size">Adjust max-block-size<a href="#adjust-max-block-size" class="hash-link" aria-label="Direct link to Adjust max-block-size" title="Direct link to Adjust max-block-size">​</a></h5><ul><li>This parameter directly affects the consumption memory usage, the larger the value is, the more memory is required. For some consumption tables with large single data, carefully adjust this parameter to avoid memory explosion. (up to 1M)</li><li>When the user does not have high requirements for data delay and the amount of data is large and the memory is sufficient, this parameter and the &quot;kafka_max_poll_interval_ms&quot; parameter can be adjusted synchronously to increase the consumption time of each round, increase the part written each time, and reduce the pressure of MERGE , to improve query performance.</li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="adjust-num_consumers">Adjust num_consumers<a href="#adjust-num_consumers" class="hash-link" aria-label="Direct link to Adjust num_consumers" title="Direct link to Adjust num_consumers">​</a></h5><ul><li>The upper limit of this parameter is the number of partitions corresponding to the consumption topic.</li><li>In the case of no lag in consumption, reduce this parameter as much as possible (that is, avoid meaninglessly increasing this parameter), reduce resource usage, and avoid excessive consumption of fragmented parts, which increases MERGE pressure and is not conducive to queries.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="system-table-for-auxiliary-troubleshooting">System table for auxiliary troubleshooting<a href="#system-table-for-auxiliary-troubleshooting" class="hash-link" aria-label="Direct link to System table for auxiliary troubleshooting" title="Direct link to System table for auxiliary troubleshooting">​</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="consumption-event-cnch_systemcnch_kafka_log">Consumption event: cnch_system.cnch_kafka_log<a href="#consumption-event-cnch_systemcnch_kafka_log" class="hash-link" aria-label="Direct link to Consumption event: cnch_system.cnch_kafka_log" title="Direct link to Consumption event: cnch_system.cnch_kafka_log">​</a></h5><p>The kakfa_log table records some basic consumption events. To enable it, you need to configure the kafka_log item in config.xml (both server and worker need to be configured), and it will take effect after restarting.</p><p>The kafka_log is written by the consumer task in the Virtual Warehouse, and is aggregated into the global cnch_system.cnch_kafka_log table in real time, so that the consumption records of all consumption tables can be viewed from the server segment.</p><p><strong>Field Description</strong></p><p><strong>column name</strong></p><p><strong>type</strong></p><p><strong>illustrate</strong></p><p>event_type</p><p>Enum8</p><p>see table below</p><p>event_date</p><p>date</p><p>Date of occurrence of time. Partition field, it is recommended to bring it in every query.</p><p>event_time</p><p>DateTime</p><p>The time of occurrence of the time, in seconds</p><p>duration_ms</p><p>UInt64</p><p>Event duration, in seconds</p><p>cnch_database</p><p>String</p><p>CnchKafka library name</p><p>cnch_table</p><p>String</p><p>CnchKafka table name</p><p>database</p><p>String</p><p>consumer task library name (currently the same as cnch_database)</p><p>table</p><p>String</p><p>consumer task table name (usually cnch_table plus timestamp and consumer number suffix)</p><p>consumer</p><p>String</p><p>consumer number</p><p>metric</p><p>UInt64</p><p>consumption line</p><p>has_error</p><p>UInt8</p><p>1 means abnormal; 0 means no abnormal.</p><p>exception</p><p>String</p><p>exception description,</p><p><strong>Event Description</strong></p><p><strong>UInt8 value</strong></p><p><strong>String value</strong></p><p><strong>illustrate</strong></p><p>1</p><p>POLL</p><p>Metric indicates how many pieces of data are consumed, and duration_ms covers a complete consumption process, including the time of WRITE.</p><p>2</p><p>PARSE_ERROR</p><p>The metric indicates the number of consumption items with parsing errors. If there are multiple parsing errors, only one will be selected and printed out.</p><p>3</p><p>WRITE</p><p>Metric indicates the number of rows written to the data, and duration_ms is basically equivalent to the data persistence time</p><p>4</p><p>EXCEPTION</p><p>Abnormal consumption process. The common ones are: authentication exception, data persistence failure, and VIEW SELECT execution failure.</p><p>5</p><p>EMPTY_MESSAGE</p><p>The number of empty messages.</p><p>6</p><p>FILTER</p><p>The data to be filtered during the write phase.</p><p>7</p><p>COMMIT</p><p>The last transaction submission record, only this record indicates that the data was written successfully, which can be used as a data audit standard</p><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="consumption-status-systemcnch_kafka_tables">Consumption status: system.cnch_kafka_tables<a href="#consumption-status-systemcnch_kafka_tables" class="hash-link" aria-label="Direct link to Consumption status: system.cnch_kafka_tables" title="Direct link to Consumption status: system.cnch_kafka_tables">​</a></h5><p>kafka_tables records the real-time status of the CnchKafka table, which starts by default and is a memory table;</p><p><strong>Field Description</strong></p><p><strong>field name</strong></p><p><strong>type of data</strong></p><p><strong>illustrate</strong></p><p>database</p><p>String</p><p>Database name</p><p>name</p><p>String</p><p>Kafka table name</p><p>uuid</p><p>String</p><p>Kafka table unique identifier UUID</p><p>kafka_cluster</p><p>String</p><p>kafka cluster</p><p>topics</p><p>Array(String)</p><p>Consume topic list</p><p>consumer_group</p><p>String</p><p>Belonging to the consumer group</p><p>num_consumers</p><p>UInt32</p><p>The number of consumers currently actually executing</p><p>consumer_tables</p><p>Array(String)</p><p>The data table name corresponding to each consumer</p><p>consumer_hosts</p><p>Array(String)</p><p>Execution nodes to which each consumer is distributed</p><p>consumemr_partitions</p><p>Array(String)</p><p>The partitions that each consumer is assigned to consume</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="common-troubleshooting-consumption-exception-records">Common troubleshooting consumption exception records<a href="#common-troubleshooting-consumption-exception-records" class="hash-link" aria-label="Direct link to Common troubleshooting consumption exception records" title="Direct link to Common troubleshooting consumption exception records">​</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="view-the-real-time-status-of-cnchkafka-consumption-table">View the real-time status of CnchKafka consumption table<a href="#view-the-real-time-status-of-cnchkafka-consumption-table" class="hash-link" aria-label="Direct link to View the real-time status of CnchKafka consumption table" title="Direct link to View the real-time status of CnchKafka consumption table">​</a></h5><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM system.cnch_kafka_tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE database = &lt;database_name&gt; AND name = &lt;cnch_kafka_table&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="view-recent-consumption-records">View recent consumption records<a href="#view-recent-consumption-records" class="hash-link" aria-label="Direct link to View recent consumption records" title="Direct link to View recent consumption records">​</a></h5><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM cnch_system.cnch_kafka_log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE event_date = today()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> AND cnch_database = &lt;database_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> AND cnch_table = &lt;cnch_kafka_table&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> AND event_time &gt; now() - 600 -- 最近十分钟</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY event_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="statistics-of-consumption-records-of-the-day-by-hour">Statistics of consumption records of the day by hour<a href="#statistics-of-consumption-records-of-the-day-by-hour" class="hash-link" aria-label="Direct link to Statistics of consumption records of the day by hour" title="Direct link to Statistics of consumption records of the day by hour">​</a></h5><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> toHour(event_time) as hour,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sumIf(metric, event_type = &#x27;POLL&#x27;) as poll_rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sumIf(metric, event_type = &#x27;PARSE_ERROR&#x27;) as error_rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sumIf(metric, event_type = &#x27;COMMIT&#x27;) as commit_rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM cnch_system.cnch_kafka_log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE event_date = today()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> AND cnch_database = &lt;database_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> AND cnch_table = &lt;cnch_kafka_table&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY hour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY hour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="import-external-data-through-spark">Import external data through Spark<a href="#import-external-data-through-spark" class="hash-link" aria-label="Direct link to Import external data through Spark" title="Direct link to Import external data through Spark">​</a></h2><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">   Use the part writer tool to import ByConity, and the part writer tool can directly convert data files into part files without going through the ByConity engine. Using the part writer can realize the separation of ByConity query and construction, alleviate the resource competition of data import and query to a certain extent, and improve query performance. At present, the development of the part writer and ByConity&#x27;s corresponding function of loading part files is basically completed. The following describes how to use the part writer to import data into ByConity.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (1) Use part writer to generate part file</span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The part writer receives a sql statement as a parameter, and the user specifies the source data file, data file format, data schema, part file storage path and other detailed information through the sql statement. The usage is as follows:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">./part_writer &quot;load CSV file &#x27;/path/to/data/test.csv&#x27; as table db.tablename(col1 UInt64, col2 String, col3 Nullable(String)) partition by col1 order by (col2, col3) location &#x27;/ path/to/dest/&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example SQL,</p><ol><li>&#x27;CSV&#x27; specifies the source data file format; in addition, the part writer can also use CSVWithNames, JSONEachRow and other data file formats natively supported by clickhouse.</li><li>&#x27;/path/to/data/test.csv&#x27; specifies the source data file; it supports reading source data from local and hdfs. If using hdfs data files, specify the path as: &#x27;hdfs://host:port/path/to/data/file&#x27;;</li><li>&#x27;/path/to/dest/&#x27; specifies the destination folder where part files are written; it supports writing part files directly to hdfs, and ByConity can pull and load part files from hdfs.</li><li>as table specifies the schema information of the inserted data</li><li>partition by and order by specify the partition key and sort key of the data table respectively. Multiple keys are separated by commas and need to be wrapped in parentheses, such as: partition by (name, id).</li><li>The ByConity special option, settings cnch=1, is used to directly dump the generated part into the ByConity part format and write it into the hdfs path specified by the location option.</li></ol><p>(2) Import part files into ByConity</p><p>The generated part file can be directly copied to the data file path corresponding to the ByConity table, and then loaded by restarting the ByConity server;</p><p>You can also copy the part file directory to the detached directory of the table, and load the part file through the attach command, such as</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">alter table test attach part &#x27;partfile&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you specify to upload directly to hdfs when using part writer to generate part files, you can execute the following command:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">system fetch parts into db.table &#x27;hdfs://host:port/path/to/part/&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ByConity will automatically pull the part file from the hdfs path and load it.</p><p>ByConity attach syntax:</p><p>Used to import the parts dumped to hdfs into the target table:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">alter table test attach parts from &#x27;/hdfs/path/to/dumped/dir&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At the same time, the fourth form also supports spark import:</p><p>In the actual application scenario, it is necessary to import a large amount of data into the ByConity cluster, you can consider using spark. First read the data into the spark dataset from the outside; then repartition the dataset according to the sharding key to ensure that the data to be sent to different ByConity nodes falls on different partitions (it may be necessary to adjust the parameters of spark.sql.shuffle.partitions according to the actual situation Make the partition not less than the number of ByConity master nodes); for each partition, first generate a part file by calling the part writer, and specify the part file to upload to hdfs, and then notify ByConity to load the part file by sending an http request to the corresponding ByConity node. The data flow diagram is as follows:</p><p>![](./assets/import data/boxcnlSkMX0zkWno7WT7250zU1f.png)</p><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="access-external-data-sources-through-byconity">Access external data sources through ByConity<a href="#access-external-data-sources-through-byconity" class="hash-link" aria-label="Direct link to Access external data sources through ByConity" title="Direct link to Access external data sources through ByConity">​</a></h2><p>###MySQL</p><p>The <code>MySQL</code> engine allows users to access MySQL tables through ByConity, and can make SELECT and INSERT queries.</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="create-tables-in-mysql">Create Tables in MySQL<a href="#create-tables-in-mysql" class="hash-link" aria-label="Direct link to Create Tables in MySQL" title="Direct link to Create Tables in MySQL">​</a></h4><ul><li>create database</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE DATABASE db1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create tables in mysql</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE db1.table1(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id Int,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    column1 VARCHAR(255)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>insert some date</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO db1.table1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (id, column1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (1, &#x27;mysql-ab&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (2, &#x27;mysql-cd&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Create a user in mysql to connect to mysql in ByConity</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE USER &#x27;mysql_byconity&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;Password123!&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Granted permission. (Here, for demonstration purposes, the <code>mysql_byconity</code> user has been granted admin privileges)</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">GRANT ALL PRIVILEGES ON *.* TO &#x27;mysql_byconity&#x27;@&#x27;%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="create-mysql-table-in-byconity">Create MySQL table in ByConity<a href="#create-mysql-table-in-byconity" class="hash-link" aria-label="Direct link to Create MySQL table in ByConity" title="Direct link to Create MySQL table in ByConity">​</a></h4><p>Now let&#x27;s create a ByConity table that uses the <strong>MySQL</strong> table engine:</p><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE mysql_table1 (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   idUInt64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   column1 String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = MySQL(&#x27;mysql-host.domain.com&#x27;,&#x27;db1&#x27;,&#x27;table1&#x27;,&#x27;mysql_byconity&#x27;,&#x27;Password123!&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The parameters of the <code>MySQL</code> engine are as follows:</p><p>parameter</p><p>describe</p><p>example</p><p>host</p><p>Domain name or IP:Port</p><p>mysql-host.domain.com</p><p>database</p><p>mysql database name</p><p>db1</p><p>tabele</p><p>mysql table name</p><p>table1</p><p>user</p><p>user to connect to mysql</p><p>mysql_byconity</p><p>password</p><p>Password to connect to mysql</p><p>Password123!</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="test-connection-mysql-table-in-byconity">Test connection mysql table in ByConity<a href="#test-connection-mysql-table-in-byconity" class="hash-link" aria-label="Direct link to Test connection mysql table in ByConity" title="Direct link to Test connection mysql table in ByConity">​</a></h4><ul><li>Test SELECT query</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">select * from mysql_table1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>![](./assets/import data/boxcnJv89B9UChc3nI0EPHoba6c.png)</p><ul><li>Test INSERT query</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO mysql_table1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (id, column1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VALUES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (3, &#x27;byconity-test&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Validate data inserted from ByConity in MySQL</li></ul><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; select id, column1 from db1.table1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>![](./assets/import data/boxcnQdV8Jpg8jcqEKwAOjONxkh.png)</p><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="hive">Hive<a href="#hive" class="hash-link" aria-label="Direct link to Hive" title="Direct link to Hive">​</a></h3><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CnchHive is a table engine provided by ByConity, which supports federated query in the form of external tables, and users can directly accelerate data query without importing data.</span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="use">use:<a href="#use" class="hash-link" aria-label="Direct link to use:" title="Direct link to use:">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="example-1-build-a-complete-set-of-hive-tables">Example 1: Build a complete set of hive tables<a href="#example-1-build-a-complete-set-of-hive-tables" class="hash-link" aria-label="Direct link to Example 1: Build a complete set of hive tables" title="Direct link to Example 1: Build a complete set of hive tables">​</a></h4><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">--Create hive table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   client_ip String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   request String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   status_code INT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   object_size INT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   date String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchHive(&#x27;psm&#x27;, &#x27;hive_database_name&#x27;, &#x27;hive_table_name&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION BY date;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--Parameter Description:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--psm:hivemetastore-psm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--hive_database_name: hive database name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--hive_table_name: hive table name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--Query hive external table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from  t where xxx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="example-2-building-a-subset-of-hive-tables">Example 2: Building a subset of hive tables<a href="#example-2-building-a-subset-of-hive-tables" class="hash-link" aria-label="Direct link to Example 2: Building a subset of hive tables" title="Direct link to Example 2: Building a subset of hive tables">​</a></h4><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_ip   String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request     String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  date String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchHive(&#x27;psm&#x27;, &#x27;hive_database_name&#x27;, &#x27;hive_table_name&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION BY date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--Parameter Description:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--psm：hivemetastore psm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--hive_database_name：hive database name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--hive_table_name：hive table name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--Query hive external table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from  t where xxx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="example-3-hive-bucket-table-construction">Example 3: hive bucket table construction<a href="#example-3-hive-bucket-table-construction" class="hash-link" aria-label="Direct link to Example 3: hive bucket table construction" title="Direct link to Example 3: hive bucket table construction">​</a></h4><div class="codeBlockContainer_sAXX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_pc2u"><pre tabindex="0" class="prism-code language-text codeBlock_fjSB thin-scrollbar"><code class="codeBlockLines_FFvy"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_ip   String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  request     String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  device_id   String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server_time String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  date String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchHive(&#x27;psm&#x27;, &#x27;hive_database_name&#x27;, &#x27;hive_table_name&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION BY date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTER BY device_id INTO 65536 BUCKETS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY server_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SETTINGS cnch_vw_default =&#x27;vw_default&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--Parameter Description：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--psm：hivemetastore psm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--hive_database_name：hive database name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--hive_table_name：hive table name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--Query hive external table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select * from  t where xxx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tcEP"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Zxeh" aria-hidden="true"><svg class="copyButtonIcon_Pc49" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_Ol7y" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>illustrate:</p><ul><li>External column</li><li>The column names need to correspond one-to-one with the hive table</li><li>The order of the columns does not need to correspond one-to-one with hive</li><li>You can select only some of the columns in the hive table, but the partition columns must include all of them.</li><li>The partition of the external column needs to be specified through the partition by statement, and it needs to be defined in the description list like ordinary columns.</li><li>When the Hive table is a bucket table, you need to specify the bucket column and the number of buckets when building the CnchHive engine. (CLUSTER BY xxx INTO xxx BUCKETS )</li><li>When there is an ORDER BY field in the Hive table, the ORDER BY field needs to be specified when building the CnchHive engine.</li><li>ENGINE specified as CnchHive</li><li>engine parameters</li><li>psm:hivemetastore-psm</li><li>hive_database_name: specifies the database in hive</li><li>hive_table_name: specifies the table in hive, does not support view.</li><li>The supported column types correspond to the following table:</li></ul><p>hive column type</p><p>CnchHive column type</p><p>describe</p><p>INT/INTERGER</p><p>INT/INTERGER</p><p>BIGINT</p><p>BIGINT</p><p>TIMESTAMP</p><p>DateTime</p><p>STRING</p><p>String</p><p>VARCHAR</p><p>FixedString</p><p>内部转换为 FixedString</p><p>CHAR</p><p>FixedString</p><p>Internally converted to FixedString</p><p>DOUBLE</p><p>DOUBLE</p><p>FLOAT</p><p>FLOAT</p><p>DECIMAL</p><p>DECIMAL</p><p>MAP</p><p>Map</p><p>ARRAY</p><p>Array</p><p>Description:</p><ul><li>The hive table schema change will not be automatically synchronized, and the hive table needs to be rebuilt in Clickhouse</li><li>The current hive storage format only supports Parquet</li><li>Currently CnchHive does not support insert and alter operations</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="settings">SETTINGS<a href="#settings" class="hash-link" aria-label="Direct link to SETTINGS" title="Direct link to SETTINGS">​</a></h4><p>cnch_vw_default：to specify vw</p><p>max_read_row_group_threads: Used to specify the number of concurrent reads of Parquet row groups.</p><h4 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="operation-manual-1">Operation Manual<a href="#operation-manual-1" class="hash-link" aria-label="Direct link to Operation Manual" title="Direct link to Operation Manual">​</a></h4><p>keywords</p><p>Solution</p><p>DB::Exception: Can not insert NULL data into non-nullable column &quot;name&quot;</p><p>Add Nullable attribute to column field.</p><p>DB::Exception: The hive type is not match in cnch.</p><p>CnchHive schema type does not match Hive schema.</p><p>DB::Exception: column name xxx doesn&#x27;t match.</p><p>CnchHive schema name does not match Hive schema.</p><p>DB::Exception: CnchHive only support parquet format. Current format is org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat.</p><p>CnchHive currently only supports Parquet as the storage format.</p><p>DB::Exception: No available nnproxy xxx.</p><p>There is a problem with the psm of HiveMetastore, you need to check whether the psm of HiveMetastore is accessible.</p><h1>Common errors and handling</h1><p>keywords</p><p>reason</p><p>Solution</p><p>Too many map keys in table</p><p>(more than 10000)</p><p>The number of key types in the Map column exceeds 10,000</p><p>If it exceeds 10000, it cannot be imported, please import data to reduce the number of map keys</p><p>Memory limit (total)</p><p>Memory limit exceeded during import</p><p>Cannot parse JSON</p><p>The data type in json does not match that of clickhouse</p><p>Ask the user to check whether the upstream generated data type matches;</p><p>Duplicate field found while parsing JSONEachRow format: hour</p><p>The json data has repeated fields, and the repeated field here is hour, that is, the repeated field after &quot;format:&quot;</p><p>Check whether the upstream data is correct and the configuration is correct</p><p>HDFS json size xxx &gt; 1099511627776</p><p>Import data is too large (1T), import is prohibited</p><p>Reduce the amount of imported data</p><p>Unable to parse hdfs json file</p><p>Data format error in hdfs</p><p>Ask the user to check whether the file in hdfs is legal json</p><p>DB::Exception: Error while reading parquet data: IOError: definition level exceeds maximum. Stack trace</p><p>hdsf file error reading error, most of which are caused by missing blocks.</p><p>HDFS files need to be regenerated</p><p>DB::Exception: Cannot parse string &#x27;time=&quot;2021-11-12&#x27; as Date: syntax error at position 10 (parsed just &#x27;time=&quot;2021&#x27;). Note: there are toDateOrZero and toDateOrNull functions, which returns zero/ NULL instead of throwing exception.: while pushing to view</p><p>In this case, there is dirty data in the user topic; when the Kafka table is consumed, it is parsed normally according to the string; but the writing to the bottom table is found to be illegal through the conversion of functions such as toDate, resulting in writing failure and blocking consumption</p><ol><li><p>Temporarily modify the VIEW table to filter dirty data;</p></li><li><p>User upstream to add data cleaning and protection mechanism</p></li><li><p>The Kafka table analysis is consistent with the bottom table. It is not recommended to convert it during the writing phase. If Kafka analysis fails, dirty data can be discarded without blocking the entire consumption</p></li></ol><p>Code: 1001, type: cppkafka::Exception, e.what() = Failed to create consumer handle: consumer regist error, please check output!</p><p>Open the trace log to view the specific error information on the Kafka side</p><p>Handle according to the error message</p><p>Code: 49, e.displayText() = DB::Exception: Check dependencies failed for</p><p>VIEW table not found</p><p>Rebuild the VIEW table</p><p>Code: 6001. DB::Exception: DB::Exception: Cannot get metadata of table XXX by UUID : XXX.</p><p>An error is reported when executing the ALTER TABLE command. The cnch table is bound to the server. This is because the table is not executed on the corresponding server.</p><p>First query system.cnch_table_host to obtain the server corresponding to the table, and then execute on the corresponding server</p><p>No space left on device: while pushing to view</p><p>disk full</p><p>clean disk</p><h1>Import parameter tuning</h1><h2 class="anchor anchorWithHideOnScrollNavbar_kuKB" id="direct-write-mode-tuning">Direct write mode tuning<a href="#direct-write-mode-tuning" class="hash-link" aria-label="Direct link to Direct write mode tuning" title="Direct link to Direct write mode tuning">​</a></h2><p>When using INSERT VALUES, INSERT INFILE or PartWriter tools to write, the number of Parts generated at the end will affect the number of times written to HDFS and affect the overall writing time, so the number of Parts should be reduced as much as possible. The direct writing process is as follows:</p><ul><li>read part of file data</li><li>Split this part of data according to PartitionBy</li><li>Split this part of data according to ClusterBy</li><li>Write the split data into a new Part and write it to HDFS</li></ul><p>Tuning means:</p><ol><li>In order to reduce the number of Parts, we can arrange the data with the same partition and Bucket in the file together, so that after reading some new data each time, the number of Parts generated will be as small as possible. The data can be sorted according to the requirement that the partitions are the same and the buckets in the partitions are the same. The calculation rules of the buckets are:</li></ol><ul><li>If SPLIT_NUMBER is not specified, SipHash will be calculated for the column used by ClusterByKey and then the BucketNumber will be moduloed to get BucketNumber</li><li>if SPLIT_NUMBER is specified</li><li>Calculate SplitValue</li><li>If a column is ClusterBy, use the dtspartition function to calculate the corresponding SplitValue</li><li>If ClusterBy has multiple columns, use SipHash to calculate the corresponding SplitValue of these columns</li><li>Calculate BucketNumber</li><li>If it is WithRange, use SplitValue <!-- -->*<!-- --> BucketCount / SplitNumber to calculate the corresponding BucketNumber</li><li>If not WithRange, use SplitValue % BucketCount to calculate the corresponding BucketNumber</li></ul><ol><li>When reading a file</li><li>If the data size of each row is not large, you can read a larger block at a time by increasing max_insert_block_size, thereby generating a larger Part</li><li>If the file to be read is not HDFS/CFS and multiple files are matched using wildcards, you can also increase min_insert_block_size_rows and min_insert_block_size_bytes at the same time</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags__Zuh padding--none margin-left--sm"><li class="tag_G1J1"><a class="tag_lVyf tagRegular_MP1R" href="/docs/tags/docs">Docs</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ByConity/byconity.github.io/tree/main/docs/basic-guide/data-import.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_rssB" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_ZTIL"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/basic-guide/data-export"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Export Data</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/basic-guide/data-type"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Data Type</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_a4zv thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#divide-by-scene" class="table-of-contents__link toc-highlight">Divide by scene</a></li><li><a href="#supported-data-formats" class="table-of-contents__link toc-highlight">Supported data formats</a></li><li><a href="#streaming-import-data-local-files-and-memory-data" class="table-of-contents__link toc-highlight">Streaming import data (local files and memory data)</a><ul><li><a href="#method-1" class="table-of-contents__link toc-highlight">Method 1:</a></li><li><a href="#method-2" class="table-of-contents__link toc-highlight">Method 2:</a></li><li><a href="#method-3" class="table-of-contents__link toc-highlight">Method 3:</a></li></ul></li><li><a href="#import-data-from-external-storage" class="table-of-contents__link toc-highlight">Import data from external storage</a></li><li><a href="#import-data-using-kakfa" class="table-of-contents__link toc-highlight">Import data using kakfa</a><ul><li><a href="#function-definition" class="table-of-contents__link toc-highlight">Function definition</a></li><li><a href="#implementation-principle" class="table-of-contents__link toc-highlight">Implementation principle</a></li><li><a href="#users-guidance" class="table-of-contents__link toc-highlight">user&#39;s guidance</a></li><li><a href="#operation-manual" class="table-of-contents__link toc-highlight">Operation Manual</a></li></ul></li><li><a href="#import-external-data-through-spark" class="table-of-contents__link toc-highlight">Import external data through Spark</a></li><li><a href="#access-external-data-sources-through-byconity" class="table-of-contents__link toc-highlight">Access external data sources through ByConity</a><ul><li><a href="#hive" class="table-of-contents__link toc-highlight">Hive</a></li><li><a href="#use" class="table-of-contents__link toc-highlight">use:</a></li></ul></li><li><a href="#direct-write-mode-tuning" class="table-of-contents__link toc-highlight">Direct write mode tuning</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row"><div class="col col--3"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_rLhL themedImage--light_CjtC footer__logo"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_rLhL themedImage--dark_quyK footer__logo"></div><div class="col"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/main-principle-concepts">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community">Community</a></li><li class="footer__item"><a class="footer__link-item" href="/users">Users</a></li><li class="footer__item"><a href="https://space.bilibili.com/2065226922?spm_id_from=333.1007.0.0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_TSiV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_TSiV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ByteDance.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e47d5ba9.js"></script>
<script src="/assets/js/main.1953c696.js"></script>
</body>
</html>