<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-basic-guide/database-table-design">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Database Table Design | ByConity</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" name="twitter:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" property="og:url" content="https://byconity.github.io/docs/basic-guide/database-table-design"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Database Table Design | ByConity"><meta data-rh="true" name="description" content="Document Type: Tutorial"><meta data-rh="true" property="og:description" content="Document Type: Tutorial"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://byconity.github.io/docs/basic-guide/database-table-design"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/basic-guide/database-table-design" hreflang="en"><link data-rh="true" rel="alternate" href="https://byconity.github.io/zh-cn/docs/basic-guide/database-table-design" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/basic-guide/database-table-design" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Y8UJSN6KEB-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ByConity RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ByConity Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BYY7CCPJZ6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BYY7CCPJZ6",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ByConity" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.25c3bd5d.css">
<link rel="preload" href="/assets/js/runtime~main.24a9e40e.js" as="script">
<link rel="preload" href="/assets/js/main.420fcd10.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_Rzz1" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_hfek"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--light_hbln"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--dark_qgR1"></div><b class="navbar__title text--truncate">ByConity</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/main-principle-concepts">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/users">Users</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="/docs/basic-guide/database-table-design" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/docs/basic-guide/database-table-design" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文（中国）</a></li></ul></div><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"><span>GitHub</span></a><div class="searchBox_mmj0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_NWrx docsWrapper_oNqO"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_LsNq" type="button"></button><div class="docPage_fHU4"><aside class="theme-doc-sidebar-container docSidebarContainer_jEGB"><div class="sidebarViewport_Gc0S"><div class="sidebar_uCr1 sidebarWithHideableNavbar_P_fD"><a tabindex="-1" class="sidebarLogo_XXeG" href="/"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--light_hbln"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--dark_qgR1"><b>ByConity</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_s63m"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction/main-principle-concepts">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/quick-start/basic-database-operations">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-syntax/ansi-compatibility">SQL Syntax</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/basic-guide/background-task-management">Basic Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/background-task-management">Background Tasks Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/client-connection">Client Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/cluster-configuration">Cluster Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/data-export">Export Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/data-import">Import Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/data-type">Data Type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/data-visualisation">Data Visualisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/basic-guide/database-table-design">Database Table Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/hive-external-table">Hive External Table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/monitoring">Monitor Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basic-guide/virtual-warehouse-configuration">Virtual Warehouse Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/advanced-guide/0.2.0_s3_upgrade_checklist">Advanced Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/community/become-maintainer">Community</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/deployment-requirements">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/benchmarks/2023-09-13-byconity-tpcds-benchmark-olap/2023-09-13-byconity-vs-other-olap-engines-tpc-ds-benchmarks">Benchmarks</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_b8RI"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_QMJw"><div class="docItemContainer_EkDS"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_dvLu" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_ObZR"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Basic Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Database Table Design</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_Iw4v theme-doc-toc-mobile tocMobile_L4iJ"><button type="button" class="clean-btn tocCollapsibleButton_Omde">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Database Table Design</h1><p>Document Type: Tutorial</p><p>Document format: tutorial purpose, pre-preparation, step-by-step explanation of principles &amp; examples, and related document recommendations;</p><p>Abstract</p><ol><li>How ByConity organizes databases and data tables</li><li>The specifications of the database table, such as how many data tables are supported by a single database, and how many columns are supported by a single table</li><li>When designing a data table, which configurations should be understood (primary key, etc.)</li><li>In a typical scenario, what is the best practice for designing a data table</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="organization-database-table">Organization Database Table<a href="#organization-database-table" class="hash-link" aria-label="Direct link to Organization Database Table" title="Direct link to Organization Database Table">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="database">database<a href="#database" class="hash-link" aria-label="Direct link to database" title="Direct link to database">​</a></h3><p>ByConity&#x27;s database is a combination of a set of associated tables or views, which is convenient for users to manage the life cycle and permission control of this set of schemas. ByConity has no hard limit on the maximum number of databases.</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="data-sheet">data sheet<a href="#data-sheet" class="hash-link" aria-label="Direct link to data sheet" title="Direct link to data sheet">​</a></h3><p>Logically, a data table is a collection of data columns with the same number of rows and belongs to a certain database. ByConity also has no limit on the number of tables in a database (preferably no more than one million). A table has no more than 100,000 data columns.</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="table-engine">Table Engine<a href="#table-engine" class="hash-link" aria-label="Direct link to Table Engine" title="Direct link to Table Engine">​</a></h4><p>The table engine is the type of the table, which determines:</p><ul><li>How data is organized and stored</li><li>How to index and the type of index</li><li>Which queries are supported and how</li><li>Some other specific features and configurations</li></ul><p>The most common table engine used by ByConity is CnchMergeTree. Other special types of table engines include Hive tables, Kafka tables, etc. The following focuses on the principle of the MergeTree table engine.</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="cnchmergetree-table-principle">CnchMergeTree table principle<a href="#cnchmergetree-table-principle" class="hash-link" aria-label="Direct link to CnchMergeTree table principle" title="Direct link to CnchMergeTree table principle">​</a></h4><p>The CnchMergeTree table is the most commonly used table engine. The core idea is similar to that of LSM-Tree. The data is partitioned according to the partition key (partition by), and then the sort key (order by) is stored in an orderly manner. main feature:</p><ul><li>If a partition key is specified, the data will be divided into different logical data sets according to the partition key (logical partition, Partition)</li></ul><p>Each logical partition can have zero or more data fragments (DataPart). Queries can often be sped up if the query criteria can prune partitions. If no partition key is specified, all data is in one logical partition.</p><ul><li>data fragment</li></ul><p>The data in the data fragment is sorted by the sort key. There will also be a min/max index for each data segment to speed up partition selection.</p><ul><li>Data granules (Granule)</li></ul><p>Each data fragment is logically divided into granules, and the default granule is 8192 rows (determined by the index_granularity configuration of the table). A granule is the smallest indivisible dataset for data query in ByConity. The first row of each granule is marked by the primary key value of the row, and ByConity will create an index file for each data fragment to store these marks. For each column, whether it is included in the primary key or not, ByConity stores a similar flag. These tags allow you to find data directly in the column file. Granule is the index target of ByConity sparse index and also the unit of data scanning in memory.</p><ul><li>Background Merge</li></ul><p>The background task will periodically merge the DataParts of the same partition and keep them in order according to the sort key. Background merging reduces the number of Parts for more efficient storage and improves query performance.</p><h2 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="cnchmergetree-table-creation-statement-and-related-configuration">CnchMergeTree table creation statement and related configuration<a href="#cnchmergetree-table-creation-statement-and-related-configuration" class="hash-link" aria-label="Direct link to CnchMergeTree table creation statement and related configuration" title="Direct link to CnchMergeTree table creation statement and related configuration">​</a></h2><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE [IF NOT EXISTS] [db.]table_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name1 [type1] [NULL|NOT NULL] [DEFAULT|ALIAS expr1] [compression_codec] [TTL expr1],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name2 [type2] [NULL|NOT NULL] [DEFAULT|ALIAS expr2] [compression_codec] [TTL expr2],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INDEX index_name1 expr1 TYPE type1(...) GRANULARITY value1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INDEX index_name2 expr2 TYPE type2(...) GRANULARITY value2，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE = CnchMergeTree()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY expr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PARTITION BY expr]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CLUSTER BY (column, expression, ...) INTO value1 BUCKETS SPLIT_NUMBER value2 WITH_RANGE]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[PRIMARY KEY expr]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[UNIQUE KEY expr]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[SAMPLE BY expr]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[TTL expr]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[SETTINGS name=value, ...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="design-partition-key-partition-by">Design partition key (PARTITION BY)<a href="#design-partition-key-partition-by" class="hash-link" aria-label="Direct link to Design partition key (PARTITION BY)" title="Direct link to Design partition key (PARTITION BY)">​</a></h3><p>A partition key defines a partition, which is a logical data set in a table divided by specified rules. Partitioning can be done by arbitrary criteria, such as by date. To reduce the data that needs to be manipulated, each partition is stored separately. When querying, ByConity tries to use the smallest subset of these partitions. It is specified by the <code>PARTITION BY expr</code> clause when creating a table. The partition key can be any expression of the columns in the table. For example, to specify partition by month, the expression is <code>toYYYYMM(date)</code>; or by expression tuple, such as <code>(toMonday(date), EventType)</code>, etc.</p><p>It should be noted that the value range calculated by the partition expression in the table should not be too large (recommended not to exceed 10,000). Too many partitions will occupy relatively large memory and bring more IO and computing overhead.</p><p>A reasonable design of the partition key can greatly reduce the amount of data that needs to be scanned during the query. Generally, it is considered to design the most commonly used conditions in the query and the column with a value range of no more than 10,000 as the partition key (such as date, etc.).</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="design-sort-key-order-by">Design sort key (ORDER BY)<a href="#design-sort-key-order-by" class="hash-link" aria-label="Direct link to Design sort key (ORDER BY)" title="Direct link to Design sort key (ORDER BY)">​</a></h3><p>Can be a tuple of columns or an arbitrary expression. For example: <code>ORDER BY (OrderID, Date)</code>.</p><p>If sorting is not required, <code>ORDER BY tuple()</code> can be used. The data in the DataPart will be sorted according to the sort key.</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="design-primary-key-primary-key">Design primary key (PRIMARY KEY)<a href="#design-primary-key-primary-key" class="hash-link" aria-label="Direct link to Design primary key (PRIMARY KEY)" title="Direct link to Design primary key (PRIMARY KEY)">​</a></h3><p>By default there is no need to specify explicitly, ByConity will use the sort key as the primary key. When there is a special scenario where the primary key is inconsistent with the sort key, the primary key must be the leftmost prefix of the sort key. If the sort key is (OrderID, Date), the primary key must be OrderID, not Date. In some special table engines, such as CnchAggregatingMergeTree, CnchSumMergeTree, the primary key will be different from the sort key.</p><p>ByConity will create a sparse index with Granule as the unit on the primary key (in contrast, the so-called dense index means that each row will create index information).</p><p>If the query condition can match the leftmost prefix of the primary key index, the data particles that may need to be read can be quickly filtered out through the primary key index, which is usually much more efficient than scanning the entire DataPart.</p><p>In addition, it should be noted that PRIMARY KEY cannot guarantee uniqueness, so data rows with duplicate primary keys can be inserted.</p><p>Partition (PARTITION BY) and primary key (PRIMARY KEY) are two different ways to speed up data query. When defining, you should try to stagger and use different columns to define the two to cover more query scenarios. For example, the first column of order by must not be placed in partition by repeatedly. Here are some considerations for how to choose a primary key:</p><ul><li>Whether it is a commonly used column in the query condition</li><li>is not the first column of a non-partition key</li><li>The selectivity of this column, such as gender, yes/no, and columns with too few optional values ​​are not recommended to be placed in the primary key</li><li>If the current primary key is (a, b), if in most cases (a, b) corresponds to a large range of data (including multiple Granules), you can consider attaching a new common query column to the primary key , which allows more data to be filtered.</li><li>Excessively long primary keys have a negative impact on insert performance and memory consumption, but have no impact on query performance.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="unique-key-index-unique-key">Unique key index (UNIQUE KEY)<a href="#unique-key-index-unique-key" class="hash-link" aria-label="Direct link to Unique key index (UNIQUE KEY)" title="Direct link to Unique key index (UNIQUE KEY)">​</a></h3><p>The primary key (PRIMARY KEY) cannot be guaranteed to be deduplicated. If there is a need to deduplicate the unique key, you need to set the unique key index when creating the table. After setting the unique key, ByConity provides upsert update write semantics, which can efficiently update data rows according to the unique key. Queries automatically return the latest value for each unique key.</p><p>A unique key can be a tuple of columns or an arbitrary expression, such as <code>UNIQUE KEY (product_id, sipHash64(city))</code>.</p><p>The unique index can be built by configuring <code>partition_level_unique_keys</code> to control whether it is unique at the partition level or unique for the entire table. The current recommended practice is: unique index for partition, and the data volume of a single partition should not exceed tens of millions<strong>. </strong>If it is unique in the entire table, it is recommended that the data volume of the entire table should not exceed tens of millions.</p><p>When querying through the unique key, the unique key index will be used to filter data to speed up the query, so usually the primary key can be set to a different column from the unique key to cover more query conditions. However, if you want to use the partial column update function, you need the unique key to be the leftmost prefix of the sort key.</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="jump-index-index">Jump index (Index)<a href="#jump-index-index" class="hash-link" aria-label="Direct link to Jump index (Index)" title="Direct link to Jump index (Index)">​</a></h3><p>When creating a table, you can define the jump index like this</p><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">INDEX index_name expr TYPE type(...) GRANULARITY granularity_value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="available-index-types">Available index types<a href="#available-index-types" class="hash-link" aria-label="Direct link to Available index types" title="Direct link to Available index types">​</a></h4><ul><li><code>minmax</code> stores the extreme value of the specified expression (if the expression is <code>tuple</code>, stores the extreme value of each element in <code>tuple</code>), this information is used to skip data blocks, similar to the primary key.</li></ul><p>The hop index function is being tested, and the supported hop index types will be added after completion.</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="design-bucket">Design Bucket<a href="#design-bucket" class="hash-link" aria-label="Direct link to Design Bucket" title="Direct link to Design Bucket">​</a></h3><p>CNCH Bucket table best practice manual</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="sampling">Sampling<a href="#sampling" class="hash-link" aria-label="Direct link to Sampling" title="Direct link to Sampling">​</a></h3><p>The expression to use for sampling, optional.</p><p>If a sampling expression is to be used, it must be included in the primary key. For example: <code>SAMPLE BY intHash32(UserID) ORDER BY (CounterID, EventDate, intHash32(UserID))</code>.</p><p>For details, refer to the sampling function (a separate sampling function is required)</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="ttl-for-columns-and-tables">TTL for columns and tables<a href="#ttl-for-columns-and-tables" class="hash-link" aria-label="Direct link to TTL for columns and tables" title="Direct link to TTL for columns and tables">​</a></h3><p>A list of rules that specify the duration of the row store and define the logic for moving pieces of data across disks and volumes, optional.</p><p>There must be at least one <code>Date</code> or <code>DateTime</code> type column in the expression, for example:</p><p><code>TTL date + INTERVAl 1 DAY</code></p><p>For more details, please check <a href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree#table_engine-mergetree-ttl" target="_blank" rel="noopener noreferrer">TTL of tables and columns</a> (too many, maybe To be an independent TTL)</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="advanced-configuration">Advanced configuration<a href="#advanced-configuration" class="hash-link" aria-label="Direct link to Advanced configuration" title="Direct link to Advanced configuration">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="granule-configuration">Granule configuration<a href="#granule-configuration" class="hash-link" aria-label="Direct link to Granule configuration" title="Direct link to Granule configuration">​</a></h4><ul><li><code>index_granularity</code> — index granularity. The number of data rows between adjacent &quot;tags&quot; in the index (corresponding to the size of the granule). The default value is 8192 .</li></ul><p>The latter three configurations are to be tested, and RD has not verified functionality.</p><ul><li><code>index_granularity_bytes</code> — index granularity in bytes, default: 10Mb. Set to 0 (not recommended) if you want to limit the index granularity by the number of data rows only.</li><li><code>min_index_granularity_bytes</code> - Minimum data granularity allowed, default: 1024b. This option is used to prevent misuse, adding a table with a very low index granularity.</li><li><code>enable_mixed_granularity_parts</code> — Whether to enable controlling the size of the index granularity via <code>index_granularity_bytes</code>. In older versions only the <code>index_granularity</code> configuration can be used to limit the size of the index granularity. The <code>index_granularity_bytes</code> configuration can improve ByConity&#x27;s performance when querying data from tables with very large rows (tens to hundreds of megabytes). If your table has very large rows, you can enable this configuration to improve the performance of <code>SELECT</code> queries.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="compute-group-configuration">Compute group configuration<a href="#compute-group-configuration" class="hash-link" aria-label="Direct link to Compute group configuration" title="Direct link to Compute group configuration">​</a></h4><p>Refer to <!-- -->[Tutorial]<!-- --> Configuring Computing Groups</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="merge-related-configuration">merge related configuration<a href="#merge-related-configuration" class="hash-link" aria-label="Direct link to merge related configuration" title="Direct link to merge related configuration">​</a></h4><p>Refer to background task chapter</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="storage-related-configuration">Storage related configuration<a href="#storage-related-configuration" class="hash-link" aria-label="Direct link to Storage related configuration" title="Direct link to Storage related configuration">​</a></h4><p>Reference storage related chapters</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="unique-index-related-configuration">Unique index related configuration<a href="#unique-index-related-configuration" class="hash-link" aria-label="Direct link to Unique index related configuration" title="Direct link to Unique index related configuration">​</a></h4><ul><li><code>partition_level_unique_keys</code> - Whether the unique index is partition unique, default value: <code>true</code>; if it is <code>false</code>, it means that the unique index is at the whole table level;</li><li><code>cloud_enable_staging_area</code> - Whether to enable asynchronous writing mode, default value: <code>false</code>.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="other-configuration">Other configuration<a href="#other-configuration" class="hash-link" aria-label="Direct link to Other configuration" title="Direct link to Other configuration">​</a></h4><h2 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="best-practices-for-primary-key-indexes">Best practices for primary key indexes<a href="#best-practices-for-primary-key-indexes" class="hash-link" aria-label="Direct link to Best practices for primary key indexes" title="Direct link to Best practices for primary key indexes">​</a></h3><p>[https://clickhouse.com/docs/en/guides/improving-query-performance/sparse-primary-indexes/]<!-- -->(<a href="https://clickhouse.com/docs/en/guides/improving-query-performance/sparse" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/guides/improving-query-performance/sparse</a> -primary-indexes/)</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="secondary-index-best-practices">Secondary Index Best Practices<a href="#secondary-index-best-practices" class="hash-link" aria-label="Direct link to Secondary Index Best Practices" title="Direct link to Secondary Index Best Practices">​</a></h3><p><a href="https://clickhouse.com/docs/en/guides/improving-query-performance/skipping-indexes" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/guides/improving-query-performance/skipping-indexes</a></p><h3></h3><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="column-type-considerations">Column type considerations<a href="#column-type-considerations" class="hash-link" aria-label="Direct link to Column type considerations" title="Direct link to Column type considerations">​</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="avoid-blindly-using-the-string-type">Avoid blindly using the String type<a href="#avoid-blindly-using-the-string-type" class="hash-link" aria-label="Direct link to Avoid blindly using the String type" title="Direct link to Avoid blindly using the String type">​</a></h3><p>Use Int(8|16|32|64|128|256) / Date / Date32 / DateTime / DateTime64 / Float / Decimal instead of String if possible</p><p>The easiest way to judge is to see if it can be converted to the target type, such as <code>SELECT countIf(toUInt8OrNull(col) IS NULL) FROM table</code>, <code>SELECT countIf(toDateOrNull(col) IS NULL) FROM table</code></p><p>For String Column with relatively fixed content, you can consider using Enum instead, such as the name of a province. Enum can add new values ​​through <code>ALTER TABLE</code> later</p><p>Use FixedString when the difference between the minimum and maximum length of String does not exceed 8, because String stores 8 bytes more offset in memory than FixedString <code>SELECT min(length(col)), max(length(col)) FROM table</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="nullable-selection">Nullable selection<a href="#nullable-selection" class="hash-link" aria-label="Direct link to Nullable selection" title="Direct link to Nullable selection">​</a></h3><p>If you are sure that the column does not contain Null, do not use Nullable type, it will have a negative impact on performance</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="low-cardinality">Low Cardinality<a href="#low-cardinality" class="hash-link" aria-label="Direct link to Low Cardinality" title="Direct link to Low Cardinality">​</a></h3><p>If the cardinality of a column is low, for example, there are no more than 10,000 unequal values in a DataPart, you can consider using the LowCardinality type. The LowCardinality type dictionary-encodes the original column. For many applications, processing dictionary-encoded data can significantly increase query speed, reduce storage space, and improve IO efficiency.</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="column-codec-selection">Column Codec Selection<a href="#column-codec-selection" class="hash-link" aria-label="Direct link to Column Codec Selection" title="Direct link to Column Codec Selection">​</a></h3><p>Generic encoding lz4/lz4hc/zstd/deflate_qpl</p><p><a href="https://clickhouse.com/docs/en/sql-reference/statements/create/table/#general-purpose-codecs" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/sql-reference/statements/create/table/#general-purpose-codecs</a></p><p>Generally speaking, lz4 encoding is fast but the compression rate is not as high as zstd. You can consider using qpl on platforms that support Intel IAA</p><p>Special encodings can be used together with the general encodings above: Delta / DoubleDelta / Gorilla / FPC / T64</p><p><a href="https://clickhouse.com/docs/en/sql-reference/statements/create/table/#specialized-codecs" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/sql-reference/statements/create/table/#specialized-codecs</a></p><p>Generally speaking, doubledelta can be used for timing, and gorilla can be used for values that change with time sequence. FPC works better on 64bit floating point numbers. T64 is to find the common high bits of 64 values for clipping, and only record the changed part</p><p>Here are some best practices</p><ul><li>DateTime type: unsorted, it is recommended to use Delta+LZ4</li><li>DateTime type: sorting, it is recommended to use LZ4</li><li>Date type: unsorted, ZSTD is recommended</li><li>Date type: sorting (eg: PK), it is recommended to use LZ4</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="reference-documentation">Reference Documentation<a href="#reference-documentation" class="hash-link" aria-label="Direct link to Reference Documentation" title="Direct link to Reference Documentation">​</a></h3><p><a href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree#table_engine-mergetree-data_skipping-indexes" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree#table_engine-mergetree-data_skipping-indexes</a></p><p><a href="https://clickhouse.com/docs/en/sql-reference/statements/create/table/#column-compression-codecs" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/sql-reference/statements/create/table/#column-compression-codecs</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_HAaO padding--none margin-left--sm"><li class="tag_Ut5_"><a class="tag_sQub tagRegular_dfhI" href="/docs/tags/docs">Docs</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ByConity/byconity.github.io/tree/main/docs/basic-guide/database-table-design.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_O9Og" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_DEFe"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/basic-guide/data-visualisation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Data Visualisation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/basic-guide/hive-external-table"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hive External Table</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Q7NC thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#organization-database-table" class="table-of-contents__link toc-highlight">Organization Database Table</a><ul><li><a href="#database" class="table-of-contents__link toc-highlight">database</a></li><li><a href="#data-sheet" class="table-of-contents__link toc-highlight">data sheet</a></li></ul></li><li><a href="#cnchmergetree-table-creation-statement-and-related-configuration" class="table-of-contents__link toc-highlight">CnchMergeTree table creation statement and related configuration</a><ul><li><a href="#design-partition-key-partition-by" class="table-of-contents__link toc-highlight">Design partition key (PARTITION BY)</a></li><li><a href="#design-sort-key-order-by" class="table-of-contents__link toc-highlight">Design sort key (ORDER BY)</a></li><li><a href="#design-primary-key-primary-key" class="table-of-contents__link toc-highlight">Design primary key (PRIMARY KEY)</a></li><li><a href="#unique-key-index-unique-key" class="table-of-contents__link toc-highlight">Unique key index (UNIQUE KEY)</a></li><li><a href="#jump-index-index" class="table-of-contents__link toc-highlight">Jump index (Index)</a></li><li><a href="#design-bucket" class="table-of-contents__link toc-highlight">Design Bucket</a></li><li><a href="#sampling" class="table-of-contents__link toc-highlight">Sampling</a></li><li><a href="#ttl-for-columns-and-tables" class="table-of-contents__link toc-highlight">TTL for columns and tables</a></li><li><a href="#advanced-configuration" class="table-of-contents__link toc-highlight">Advanced configuration</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#best-practices-for-primary-key-indexes" class="table-of-contents__link toc-highlight">Best practices for primary key indexes</a></li><li><a href="#secondary-index-best-practices" class="table-of-contents__link toc-highlight">Secondary Index Best Practices</a></li><li><a href="#column-type-considerations" class="table-of-contents__link toc-highlight">Column type considerations</a></li><li><a href="#avoid-blindly-using-the-string-type" class="table-of-contents__link toc-highlight">Avoid blindly using the String type</a></li><li><a href="#nullable-selection" class="table-of-contents__link toc-highlight">Nullable selection</a></li><li><a href="#low-cardinality" class="table-of-contents__link toc-highlight">Low Cardinality</a></li><li><a href="#column-codec-selection" class="table-of-contents__link toc-highlight">Column Codec Selection</a></li><li><a href="#reference-documentation" class="table-of-contents__link toc-highlight">Reference Documentation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row"><div class="col col--3"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_DeRy themedImage--light_hbln footer__logo"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_DeRy themedImage--dark_qgR1 footer__logo"></div><div class="col"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/main-principle-concepts">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community">Community</a></li><li class="footer__item"><a class="footer__link-item" href="/users">Users</a></li><li class="footer__item"><a href="https://space.bilibili.com/2065226922?spm_id_from=333.1007.0.0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_LBPb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_LBPb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ByteDance.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.24a9e40e.js"></script>
<script src="/assets/js/main.420fcd10.js"></script>
</body>
</html>