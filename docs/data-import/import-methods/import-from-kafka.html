<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-data-import/import-methods/import-from-kafka">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Import from Kafka | ByConity</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" name="twitter:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" property="og:url" content="https://byconity.github.io/docs/data-import/import-methods/import-from-kafka"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Import from Kafka | ByConity"><meta data-rh="true" name="description" content="Importing from Kafka"><meta data-rh="true" property="og:description" content="Importing from Kafka"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://byconity.github.io/docs/data-import/import-methods/import-from-kafka"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/data-import/import-methods/import-from-kafka" hreflang="en"><link data-rh="true" rel="alternate" href="https://byconity.github.io/zh-cn/docs/data-import/import-methods/import-from-kafka" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/data-import/import-methods/import-from-kafka" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Y8UJSN6KEB-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ByConity RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ByConity Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BYY7CCPJZ6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BYY7CCPJZ6",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ByConity" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.25c3bd5d.css">
<link rel="preload" href="/assets/js/runtime~main.323eb1cd.js" as="script">
<link rel="preload" href="/assets/js/main.f4c0025d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_Rzz1" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_hfek"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--light_hbln"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--dark_qgR1"></div><b class="navbar__title text--truncate">ByConity</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/what-is-byconity">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community/become-maintainer">Community</a><a class="navbar__item navbar__link" href="/users">Users</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction/what-is-byconity">0.4.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/data-import/import-methods/import-from-kafka">0.4.x</a></li><li><a class="dropdown__link" href="/docs/0.3.0/data-import/import-methods/import-from-kafka">0.3.0</a></li><li><a class="dropdown__link" href="/docs/0.2.0/introduction/main-principle-concepts">0.2.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="/docs/data-import/import-methods/import-from-kafka" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/docs/data-import/import-methods/import-from-kafka" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文（中国）</a></li></ul></div><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"><span>GitHub</span></a><div class="searchBox_mmj0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_NWrx docsWrapper_oNqO"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_LsNq" type="button"></button><div class="docPage_fHU4"><aside class="theme-doc-sidebar-container docSidebarContainer_jEGB"><div class="sidebarViewport_Gc0S"><div class="sidebar_uCr1 sidebarWithHideableNavbar_P_fD"><a tabindex="-1" class="sidebarLogo_XXeG" href="/"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--light_hbln"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--dark_qgR1"><b>ByConity</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_s63m"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction/what-is-byconity">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/quick-start/docker-deploy">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/deployment-requirements">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/data-export/data-export-method">Data Export</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/data-import/data-introduction">Data Import</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-import/data-introduction">Data Description</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-import/data-import-tuning">Data Import Tuning</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/data-import/import-methods/stream-import">Import Methods</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-import/import-methods/stream-import">Stream Import</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-import/import-methods/import-from-hdfs">Import from HDFS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/data-import/import-methods/import-from-kafka">Import from Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-import/import-methods/direct-access-via-mysql">Direct Access via MySQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-import/import-methods/direct-access-via-hive">Direct Access via Hive</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/data-import/import-methods/ad-hoc-import">Ad-hoc Import</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/table-design/data-model">Table Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/data-lakes/hive-external-table">Data Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/query-optimization/query-optimizer">Query Optimization</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/integration/client-connection">Integration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-syntax/data-types">SQL Syntax</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/admin-guides/resource-manager">Admin Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/benchmarks/tpc-ds">Benchmarks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/developer-guides/how-to-build-byconity">Developer Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/faq/all-in-one">FAQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/release-note/0.3.0">Release Note</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_b8RI"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_QMJw"><div class="docItemContainer_EkDS"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_dvLu" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_ObZR"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Data Import</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Import Methods</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Import from Kafka</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.4.x</span><div class="tocCollapsible_Iw4v theme-doc-toc-mobile tocMobile_L4iJ"><button type="button" class="clean-btn tocCollapsibleButton_Omde">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Importing Data</h1><h2 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="importing-from-kafka">Importing from Kafka<a href="#importing-from-kafka" class="hash-link" aria-label="Direct link to Importing from Kafka" title="Direct link to Importing from Kafka">​</a></h2><p>CnchKafka is a table engine developed by ByConity based on the community ClickHouse Kafka table engine and optimized for cloud-native architectures. It efficiently and rapidly imports user data in real-time from Apache Kafka into ByConity. Its design and implementation are tailored to cloud-native infrastructures while enhancing certain functionalities beyond the community&#x27;s implementations.</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="user-guide">User Guide<a href="#user-guide" class="hash-link" aria-label="Direct link to User Guide" title="Direct link to User Guide">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="table-creation">Table Creation<a href="#table-creation" class="hash-link" aria-label="Direct link to Table Creation" title="Direct link to Table Creation">​</a></h4><p>Creating a CnchKafka consumer table is similar to creating a Kafka table in the community version. It requires configuring Kafka data sources and consumption parameters through the <code>Setting</code> parameter. Here&#x27;s an example:</p><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE kafka_test.cnch_kafka_consume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `i` Int64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `ts` DateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchKafka()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SETTINGS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_broker_list = &#x27;10.10.10.10:9092&#x27;,  -- replace with your own broker list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_topic_list = &#x27;my_kafka_test_topic&#x27;, -- topic name to subscribe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_group_name = &#x27;hansome_boy_consume_group&#x27;, -- your consumer-group name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_format = &#x27;JSONEachRow&#x27;, -- always be json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_row_delimiter = &#x27;\n&#x27;, -- always be \n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafka_num_consumers = 1</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(Please refer to the section below for explanations of the <code>Setting</code> parameters and support for additional parameters.)</p><p>Due to the design of Kafka consumption, three tables are required. Therefore, you need to create two additional tables.</p><p>First, create a storage table (using CnchMergeTree as an example):</p><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE kafka_test.cnch_store_kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `i` Int64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `ts` DateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENGINE = CnchMergeTree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARTITION BY toDate(ts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY ts</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, create a materialized view table (only after successfully creating the Kafka table and storage table):</p><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE MATERIALIZED VIEW kafka_test.cnch_kafka_view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TO kafka_test.cnch_store_kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `i` Int64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `ts` DateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * -- you can add virtual columns here if you need</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM kafka_test.cnch_kafka_consume</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once you have the necessary permissions for the corresponding topic, consumption will automatically start executing after all three tables are created.</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="virtual-column-support">Virtual Column Support<a href="#virtual-column-support" class="hash-link" aria-label="Direct link to Virtual Column Support" title="Direct link to Virtual Column Support">​</a></h4><p>Sometimes, there&#x27;s a business need to access metadata from Kafka messages (e.g., message partition, offset, etc.). In such cases, you can use the virtual columns feature to meet this requirement. Virtual columns don&#x27;t need to be specified during table creation; they are inherent properties of the table engine. They can be included in the SELECT statement of the VIEW table and stored in the underlying table (provided the underlying table has the corresponding columns added):</p><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _topic,    -- String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _partition,    -- UInt64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _key,    -- String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _offset,    -- UInt64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _content,  -- String: complete message content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *    -- Normal columns can be expanded with *, but virtual columns cannot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM kafka_test.cnch_kafka_consume</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="setting-description">Setting Description<a href="#setting-description" class="hash-link" aria-label="Direct link to Setting Description" title="Direct link to Setting Description">​</a></h4><p><strong>Table of Parameters</strong></p><table><thead><tr><th><strong>Parameter Name</strong></th><th><strong>Type</strong></th><th><strong>Required/Default</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>kafka_cluster / kafka_broker_list</td><td>String</td><td>Required</td><td>Internal Kafka cluster for the company; for community version of Kafka, use the <code>kafka_broker_list</code> parameter.</td></tr><tr><td>kafka_topic_list</td><td>String</td><td>Required</td><td>Can be multiple, separated by commas.</td></tr><tr><td>kafka_group_name</td><td>String</td><td>Required</td><td>Consumer group name.</td></tr><tr><td>kafka_format</td><td>String</td><td>Required</td><td>Message format; currently, JSONEachRow is the most commonly used.</td></tr><tr><td>kafka_row_delimiter</td><td>String</td><td>&#x27;\0&#x27;</td><td>Generally used as &#x27;\n&#x27;.</td></tr><tr><td>kafka_num_consumers</td><td>UInt64</td><td>1</td><td>Number of consumers, recommended not to exceed the maximum number of partitions in the topic.</td></tr><tr><td>kafka_max_block_size</td><td>UInt64</td><td>65536</td><td>Write block_size, with an upper limit of 1M.</td></tr><tr><td>kafka_max_poll_interval_ms</td><td>Milliseconds</td><td>7500</td><td>The maximum time to poll from the broker during each iteration.</td></tr><tr><td>kafka_schema</td><td>String</td><td>&quot;&quot;</td><td>Schema file setup parameter, set in the format of filename + colon + message name. E.g., <code>schema.proto:MyMessage</code>.</td></tr><tr><td>kafka_format_schema_path</td><td>String</td><td>&quot;&quot;</td><td>Remote schema file path (excluding filename) setup parameter, currently only supports hdfs. (If this parameter is not set, it will read from the default path set in the configuration file).</td></tr><tr><td>kafka_protobuf_enable_multiple_message</td><td>bool</td><td>true</td><td>Set to true to indicate that multiple protobuf messages can be read from a single kafka message, separated by their respective lengths.</td></tr><tr><td>kafka_protobuf_default_length_parser</td><td>bool</td><td>false</td><td>Only effective when <code>kafka_protobuf_enable_multiple_message</code> is true: true indicates that the message header has a variable record length; false indicates that a fixed 8 bytes are used as the header record length.</td></tr><tr><td>kafka_extra_librdkafka_config</td><td>Json format string</td><td>&quot;&quot;</td><td>Other parameters supported by rdkafka, typically used for authentication (More params refer to <a href="https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md#:~:text=see%20dedicated%20API-,ssl.ca.location,-*" target="_blank" rel="noopener noreferrer">here</a>).</td></tr><tr><td>cnch_vw_write</td><td>String</td><td>&quot;vw_write&quot;</td><td>Configures consumption using Virtual WareHouse, where consumer tasks will be scheduled to execute on the configured Virtual Warehouse nodes.</td></tr><tr><td>kafka_cnch_schedule_mode</td><td>String</td><td>&quot;random&quot;</td><td>Scheduling strategy adopted by ConsumeManager when scheduling consumer tasks. Currently supports: random, hash, and least_consumers; if using independent vw or with more than 10 consumers, least_consumers is recommended.</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="modifying-consumption-parameters">Modifying Consumption Parameters<a href="#modifying-consumption-parameters" class="hash-link" aria-label="Direct link to Modifying Consumption Parameters" title="Direct link to Modifying Consumption Parameters">​</a></h4><p>Supports quickly modifying Setting parameters through the ALTER command, primarily used for adjusting consumer count and other parameters to enhance consumption capacity.</p><p>Command:</p><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">ALTER TABLE &lt;cnch_kafka_name&gt; MODIFY SETTING &lt;name1&gt; = &lt;value1&gt;, &lt;name2&gt; = &lt;value2&gt;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Executing this command will automatically restart the consumption task.</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="manual-startstop-consumption">Manual Start/Stop Consumption<a href="#manual-startstop-consumption" class="hash-link" aria-label="Direct link to Manual Start/Stop Consumption" title="Direct link to Manual Start/Stop Consumption">​</a></h4><p>In some scenarios, users may need to manually stop consumption and then resume it later; we provide corresponding SYSTEM commands to achieve this:</p><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">SYSTEM START/STOP/RESTART CONSUME &lt;cnch_kafka_name&gt;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: The START/STOP commands will persist the corresponding state to the Catalog. Therefore, after executing the STOP command, if START is not executed, even if the service is restarted, the consumption task will not resume.</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="resetting-offset">Resetting Offset<a href="#resetting-offset" class="hash-link" aria-label="Direct link to Resetting Offset" title="Direct link to Resetting Offset">​</a></h4><p>Since CnchKafka manages and saves offsets internally, we have implemented SYSTEM commands for users to reset offsets when needed. Specifically, the following three methods are supported:</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="reset-to-special-positions">Reset to Special Positions<a href="#reset-to-special-positions" class="hash-link" aria-label="Direct link to Reset to Special Positions" title="Direct link to Reset to Special Positions">​</a></h4><ul><li>By latest/earliest position</li></ul><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">SYSTEM RESET CONSUME OFFSET &#x27;{&quot;database_name&quot;:&quot;XXX&quot;, &quot;table_name&quot;: &quot;XXX&quot;, &quot;offset_value&quot;:-1}&#x27;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Possible values for special positions:</li></ul><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">    enum Offset {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_BEGINNING = -2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_END = -1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_STORED = -1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OFFSET_INVALID = -1001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Reset by timestamp</li></ul><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">SYSTEM RESET CONSUME OFFSET &#x27;{&quot;database_name&quot;:&quot;XXX&quot;, &quot;table_name&quot;: &quot;XXX&quot;, &quot;timestamp&quot;:1646125258000}&#x27;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The timestamp value should be within the valid data retention period on the Kafka side and should be in milliseconds.</p><ul><li>Specify offset value</li></ul><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">system reset consume offset &#x27;{&quot;database_name&quot;:&quot;XXX&quot;, &quot;table_name&quot;: &quot;XXX&quot;, &quot;topic_name&quot;: &quot;XXX&quot;, &quot;offset_values&quot;:[{&quot;partition&quot;:0, &quot;offset&quot;:100}, {&quot;partition&quot;:10, &quot;offset&quot;:101}]}&#x27;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is less common and used to specify a specific offset value for a particular topic partition.</p><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="operation-and-maintenance-manual">Operation and Maintenance Manual<a href="#operation-and-maintenance-manual" class="hash-link" aria-label="Direct link to Operation and Maintenance Manual" title="Direct link to Operation and Maintenance Manual">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="common-consumption-performance-tuning">Common Consumption Performance Tuning<a href="#common-consumption-performance-tuning" class="hash-link" aria-label="Direct link to Common Consumption Performance Tuning" title="Direct link to Common Consumption Performance Tuning">​</a></h4><p>When there is a persistent lag in consumption, it is usually due to insufficient consumption capacity. By default, CnchKafka creates one consumer with a maximum block size of 65536 for writing in a single consumption. When the consumption capacity is insufficient, it is recommended to adjust the consumer and block-size parameters. Refer to the <strong>Modifying Consumption Parameters</strong> section above for adjustment methods.</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="adjusting-max-block-size">Adjusting max-block-size<a href="#adjusting-max-block-size" class="hash-link" aria-label="Direct link to Adjusting max-block-size" title="Direct link to Adjusting max-block-size">​</a></h4><ul><li>This parameter directly affects consumption memory usage, and a larger value requires more memory. For consumption tables with larger individual data sizes, adjust this parameter carefully to avoid exceeding memory limits (the upper limit is 1M).</li><li>When users have low requirements for data latency and have a large amount of data with sufficient memory, they can simultaneously adjust this parameter and the &quot;kafka_max_poll_interval_ms&quot; parameter to increase the consumption time for each round, making each written part larger, reducing MERGE pressure, and improving query performance.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="adjusting-num_consumers">Adjusting num_consumers<a href="#adjusting-num_consumers" class="hash-link" aria-label="Direct link to Adjusting num_consumers" title="Direct link to Adjusting num_consumers">​</a></h4><ul><li>The upper limit for this parameter is the number of partitions corresponding to the consumed topic.</li><li>When there is no lag in consumption, it is recommended to minimize this parameter (i.e., avoid increasing it unnecessarily) to reduce resource usage, avoid generating too many small parts during consumption, reduce MERGE pressure, and facilitate queries.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="system-tables-for-troubleshooting">System Tables for Troubleshooting<a href="#system-tables-for-troubleshooting" class="hash-link" aria-label="Direct link to System Tables for Troubleshooting" title="Direct link to System Tables for Troubleshooting">​</a></h4><ul><li>Consumption Events: cnch_system.cnch_kafka_log</li></ul><p>The kafka_log table records basic consumption events. To enable it, configure the kafka_log item in config.xml (required for both server and worker), and restart the service for the changes to take effect.</p><p>The kafka_log is written by the consumer task in the Virtual Warehouse and aggregated in real-time into the global cnch_system.cnch_kafka_log table, allowing you to view consumption records for all consumption tables from the server side.</p><h4 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="field-description">Field Description<a href="#field-description" class="hash-link" aria-label="Direct link to Field Description" title="Direct link to Field Description">​</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="event-table-event_table">Event Table (event_table)<a href="#event-table-event_table" class="hash-link" aria-label="Direct link to Event Table (event_table)" title="Direct link to Event Table (event_table)">​</a></h5><table><thead><tr><th><strong>Column Name</strong></th><th><strong>Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>event_type</td><td>Enum8</td><td>See the table below for details</td></tr><tr><td>event_date</td><td>Date</td><td>The date when the event occurred. It is a partition field and is recommended to be included in every query.</td></tr><tr><td>event_time</td><td>DateTime</td><td>The time when the event occurred, in seconds</td></tr><tr><td>duration_ms</td><td>UInt64</td><td>The duration of the event, in milliseconds</td></tr><tr><td>cnch_database</td><td>String</td><td>The name of the CnchKafka database</td></tr><tr><td>cnch_table</td><td>String</td><td>The name of the CnchKafka table</td></tr><tr><td>database</td><td>String</td><td>The database name of the consumer task (currently the same as cnch_database)</td></tr><tr><td>table</td><td>String</td><td>The table name of the consumer task (usually suffixed with a timestamp and consumer ID based on cnch_table)</td></tr><tr><td>consumer</td><td>String</td><td>The consumer ID</td></tr><tr><td>metric</td><td>UInt64</td><td>The number of consumed rows</td></tr><tr><td>has_error</td><td>UInt8</td><td>1 indicates an exception; 0 indicates no exception</td></tr><tr><td>exception</td><td>String</td><td>Exception description</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="event-type-description-event_type">Event Type Description (event_type)<a href="#event-type-description-event_type" class="hash-link" aria-label="Direct link to Event Type Description (event_type)" title="Direct link to Event Type Description (event_type)">​</a></h3><table><thead><tr><th><strong>UInt8 Value</strong></th><th><strong>String Value</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>1</td><td>POLL</td><td>The metric indicates the number of data items consumed, and duration_ms covers the entire consumption process including WRITE time.</td></tr><tr><td>2</td><td>PARSE_ERROR</td><td>The metric represents the number of consumption entries with parsing errors. If multiple entries have errors, only one will be selected for printing.</td></tr><tr><td>3</td><td>WRITE</td><td>The metric represents the number of data rows written, and duration_ms is basically equivalent to the data persistence time.</td></tr><tr><td>4</td><td>EXCEPTION</td><td>Exceptions during the consumption process. Common examples include: authentication exceptions, data persistence failures, and VIEW SELECT execution failures.</td></tr><tr><td>5</td><td>EMPTY_MESSAGE</td><td>The number of empty messages.</td></tr><tr><td>6</td><td>FILTER</td><td>Data filtered during the write phase.</td></tr><tr><td>7</td><td>COMMIT</td><td>Final transaction commit record. Only this record indicates successful data writing and can be used as a data audit standard.</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="consumption-status-table-systemcnch_kafka_tables">Consumption Status Table: system.cnch_kafka_tables<a href="#consumption-status-table-systemcnch_kafka_tables" class="hash-link" aria-label="Direct link to Consumption Status Table: system.cnch_kafka_tables" title="Direct link to Consumption Status Table: system.cnch_kafka_tables">​</a></h3><p>The kafka_tables records the real-time status of CnchKafka tables, which are memory tables by default;</p><table><thead><tr><th><strong>Field Name</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>database</td><td>String</td><td>Database name</td></tr><tr><td>name</td><td>String</td><td>Kafka table name</td></tr><tr><td>uuid</td><td>String</td><td>Unique identifier UUID for the kafka table</td></tr><tr><td>kafka_cluster</td><td>String</td><td>Kafka cluster</td></tr><tr><td>topics</td><td>Array(String)</td><td>List of consumed topics</td></tr><tr><td>consumer_group</td><td>String</td><td>Associated consumer group</td></tr><tr><td>num_consumers</td><td>UInt32</td><td>The current number of actively executing consumers</td></tr><tr><td>consumer_tables</td><td>Array(String)</td><td>Data table names corresponding to each consumer</td></tr><tr><td>consumer_hosts</td><td>Array(String)</td><td>Execution nodes assigned to each consumer</td></tr><tr><td>consumer_partitions</td><td>Array(String)</td><td>Partitions assigned to each consumer for consumption</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="common-queries-for-troubleshooting-consumption-issues">Common Queries for Troubleshooting Consumption Issues<a href="#common-queries-for-troubleshooting-consumption-issues" class="hash-link" aria-label="Direct link to Common Queries for Troubleshooting Consumption Issues" title="Direct link to Common Queries for Troubleshooting Consumption Issues">​</a></h3><ul><li>Checking the real-time status of CnchKafka consumption tables</li></ul><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cnch_kafka_tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;database_name&gt;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;cnch_kafka_table&gt;&#x27;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Viewing recent consumption records</li></ul><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> cnch_system</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cnch_kafka_log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> event_date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> today</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> cnch_database </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;database_name&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> cnch_table </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;cnch_kafka_table&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> event_time </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- Last 10 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> event_time</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Summarizing consumption records for the current day by hour</li></ul><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> toHour</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">hour</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sumIf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metric</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;POLL&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> poll_rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sumIf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metric</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;PARSE_ERROR&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> error_rows</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sumIf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metric</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;COMMIT&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> commit_rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> cnch_system</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cnch_kafka_log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> event_date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> today</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> cnch_database </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;database_name&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> cnch_table </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;cnch_kafka_table&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">hour</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">hour</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_HAaO padding--none margin-left--sm"><li class="tag_Ut5_"><a class="tag_sQub tagRegular_dfhI" href="/docs/tags/docs">Docs</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ByConity/byconity.github.io/tree/main/docs/data-import/import-methods/import-from-kafka.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_O9Og" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_DEFe"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/data-import/import-methods/import-from-hdfs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Import from HDFS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/data-import/import-methods/direct-access-via-mysql"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Direct Access via MySQL</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Q7NC thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#importing-from-kafka" class="table-of-contents__link toc-highlight">Importing from Kafka</a><ul><li><a href="#user-guide" class="table-of-contents__link toc-highlight">User Guide</a></li><li><a href="#operation-and-maintenance-manual" class="table-of-contents__link toc-highlight">Operation and Maintenance Manual</a></li><li><a href="#event-type-description-event_type" class="table-of-contents__link toc-highlight">Event Type Description (event_type)</a></li><li><a href="#consumption-status-table-systemcnch_kafka_tables" class="table-of-contents__link toc-highlight">Consumption Status Table: system.cnch_kafka_tables</a></li><li><a href="#common-queries-for-troubleshooting-consumption-issues" class="table-of-contents__link toc-highlight">Common Queries for Troubleshooting Consumption Issues</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row"><div class="col col--3"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_DeRy themedImage--light_hbln footer__logo"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_DeRy themedImage--dark_qgR1 footer__logo"></div><div class="col"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/main-principle-concepts">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community">Community</a></li><li class="footer__item"><a class="footer__link-item" href="/users">Users</a></li><li class="footer__item"><a href="https://space.bilibili.com/2065226922?spm_id_from=333.1007.0.0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_LBPb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_LBPb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ByteDance.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.323eb1cd.js"></script>
<script src="/assets/js/main.f4c0025d.js"></script>
</body>
</html>