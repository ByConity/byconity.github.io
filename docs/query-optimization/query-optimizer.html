<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-query-optimization/query-optimizer">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Query Optimizer | ByConity</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" name="twitter:image" content="https://byconity.github.io/img/byconity-social-card.png"><meta data-rh="true" property="og:url" content="https://byconity.github.io/docs/query-optimization/query-optimizer"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Query Optimizer | ByConity"><meta data-rh="true" name="description" content="The optimizer is the core of the database system, and an excellent optimizer can greatly improve query performance, especially in complex query scenarios where the optimizer can bring several times to hundreds of times performance improvement."><meta data-rh="true" property="og:description" content="The optimizer is the core of the database system, and an excellent optimizer can greatly improve query performance, especially in complex query scenarios where the optimizer can bring several times to hundreds of times performance improvement."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://byconity.github.io/docs/query-optimization/query-optimizer"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/query-optimization/query-optimizer" hreflang="en"><link data-rh="true" rel="alternate" href="https://byconity.github.io/zh-cn/docs/query-optimization/query-optimizer" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://byconity.github.io/docs/query-optimization/query-optimizer" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Y8UJSN6KEB-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ByConity RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ByConity Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BYY7CCPJZ6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BYY7CCPJZ6",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ByConity" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.25c3bd5d.css">
<link rel="preload" href="/assets/js/runtime~main.488d2ad2.js" as="script">
<link rel="preload" href="/assets/js/main.51896293.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_Rzz1" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_hfek"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--light_hbln"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--dark_qgR1"></div><b class="navbar__title text--truncate">ByConity</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/main-principle-concepts">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/users">Users</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction/what-is-byconity">0.3.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/query-optimization/query-optimizer">0.3.x</a></li><li><a class="dropdown__link" href="/docs/0.2.0/introduction/main-principle-concepts">0.2.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="/docs/query-optimization/query-optimizer" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/docs/query-optimization/query-optimizer" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文（中国）</a></li></ul></div><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"><span>GitHub</span></a><div class="searchBox_mmj0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_NWrx docsWrapper_oNqO"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_LsNq" type="button"></button><div class="docPage_fHU4"><aside class="theme-doc-sidebar-container docSidebarContainer_jEGB"><div class="sidebarViewport_Gc0S"><div class="sidebar_uCr1 sidebarWithHideableNavbar_P_fD"><a tabindex="-1" class="sidebarLogo_XXeG" href="/"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--light_hbln"><img src="/img/logo.png" alt="ByConity Logo" class="themedImage_DeRy themedImage--dark_qgR1"><b>ByConity</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_s63m"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction/what-is-byconity">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/quick-start/docker-deploy">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/deployment-requirements">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/data-export/data-export-method">Data Export</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/data-import/data-introduction">Data Import</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/table-design/data-model">Table Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/data-lakes/hive-external-table">Data Lake</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/query-optimization/query-optimizer">Query Optimization</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/query-optimization/query-optimizer">Query Optimizer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/query-optimization/query-optimization-with-cache-preload">Cache Preload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/query-optimization/complex-query-optimization">Complex Query Tuning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/query-optimization/query-optimization-with-projection">Query Optimization with Projection</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/integration/client-connection">Integration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sql-syntax/data-types">SQL Syntax</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/admin-guides/resource-manager">Admin Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/benchmarks/tpc-ds">Benchmarks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/developer-guides/how-to-build-byconity">Developer Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/faq/all-in-one">FAQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/community/become-maintainer">Community</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/release-note/0.3.0">Release Note</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_b8RI"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_QMJw"><div class="docItemContainer_EkDS"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_dvLu" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_ObZR"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Query Optimization</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Query Optimizer</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.3.x</span><div class="tocCollapsible_Iw4v theme-doc-toc-mobile tocMobile_L4iJ"><button type="button" class="clean-btn tocCollapsibleButton_Omde">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Query Optimizer</h1><p>The optimizer is the core of the database system, and an excellent optimizer can greatly improve query performance, especially in complex query scenarios where the optimizer can bring several times to hundreds of times performance improvement.</p><p>ByConity&#x27;s self-developed optimizer provides ultimate optimization capabilities based on three optimization directions:</p><ul><li>RBO: Rule-Based Optimization. ByConity implements two approaches. One is global rewriting based on Visitor, such as filter pushdown, column pruning, etc. The other is local rewriting based on pattern matching, such as merging two filters. Overall, it supports common heuristic optimization capabilities such as column pruning, partition pruning, expression simplification, subquery decorrelation, predicate pushdown, redundant operator elimination, Outer-JOIN to INNER-JOIN conversion, operator pushdown storage, and distributed operator splitting.</li><li>CBO: Cost-Based Optimization. This optimization relies on the collection of statistical information and is currently implemented based on a search framework called Cascades. ByConity supports cost-based optimization capabilities such as Join Reorder, Outer-Join Reorder, Join/Agg Reorder, CTE, materialized views, Dynamic Filter pushdown, Magic Set, etc. It also integrates Property Enforcement for distributed plans.</li><li>DBO: Dependency-Based Optimization. Supports optimization capabilities based on data dependencies such as unique keys, functional dependencies, order dependencies, inclusion dependencies, etc.</li></ul><p>In ByConity, the optimizer can be enabled using the following parameters:</p><div class="language-bash codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-bash codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">-- Note: If ANSI mode is enabled, the optimizer will also be automatically enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> dialect_type </span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;ANSI&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> enable_optimizer </span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="commands-for-collecting-displaying-and-deleting-statistical-information">Commands for Collecting, Displaying, and Deleting Statistical Information<a href="#commands-for-collecting-displaying-and-deleting-statistical-information" class="hash-link" aria-label="Direct link to Commands for Collecting, Displaying, and Deleting Statistical Information" title="Direct link to Commands for Collecting, Displaying, and Deleting Statistical Information">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="syntax-definition">Syntax Definition:<a href="#syntax-definition" class="hash-link" aria-label="Direct link to Syntax Definition:" title="Direct link to Syntax Definition:">​</a></h3><ul><li>Note: Future versions will have the ability to automatically collect, update, and analyze statistical information.</li></ul><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- NOTE: The parameter ALL represents all tables in the current database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Supports specifying columns and sample configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> STATS </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">IF</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FULLSCAN </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> SAMPLE </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">rows</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ROWS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ratio</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> RATIO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Deletes statistical information</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Supports specifying columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">DROP</span><span class="token plain"> STATS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">coln</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;)&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="collecting-statistical-information">Collecting Statistical Information<a href="#collecting-statistical-information" class="hash-link" aria-label="Direct link to Collecting Statistical Information" title="Direct link to Collecting Statistical Information">​</a></h3><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Creates statistical information for all tables without statistical information in the current database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Creates statistical information for all tables without statistical information in db1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> db1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Creates statistical information for t1.c1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats t1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Creates statistical information for t1.c1 and t1.c2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats t1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Creates statistical information on t1, forcing a full table scan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats t1 </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> fullscan</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Samples the following rows when creating statistical information for each table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- MAX(statistics_sample_row_count, 0.01 * full_rows_count)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> ratio</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Samples the following rows when creating statistical information for each table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- MAX(40000000, 0.01 * full_rows_count)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> ratio </span><span class="token number" style="color:#36acaa">40000000</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">rows</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Uses default settings for sampling,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- controlled by statistics_sample_row_count and statistics_sample_ratio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> sample</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="displaying-statistical-information">Displaying Statistical Information<a href="#displaying-statistical-information" class="hash-link" aria-label="Direct link to Displaying Statistical Information" title="Direct link to Displaying Statistical Information">​</a></h3><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Displays table statistical information for all tables in the current database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">all</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Displays table statistical information for all tables in db1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> stats db1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Displays table statistical information for table t1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> stats t1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Displays column statistical information for table t1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> column_stats t1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Displays column statistical information for columns c1 and c2 in table t1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> column_stats t1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="deleting-statistical-information">Deleting Statistical Information<a href="#deleting-statistical-information" class="hash-link" aria-label="Direct link to Deleting Statistical Information" title="Direct link to Deleting Statistical Information">​</a></h3><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Deletes statistical information for all tables in the current database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> stats </span><span class="token keyword" style="color:#00009f">all</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Deletes statistical information for all tables in db1.*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> stats db1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Deletes statistical information for table t1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> stats t1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Deletes statistical information for columns c1 and c2 in table t1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> stats t1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_l3HI" id="using-explain">Using Explain<a href="#using-explain" class="hash-link" aria-label="Direct link to Using Explain" title="Direct link to Using Explain">​</a></h2><ol><li>Explain + SQL</li></ol><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_customer_sk </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr_customer_sk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_store_sk </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr_store_sk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sr_return_amt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr_total_return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> store_returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> date_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sr_returned_date_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d_date_sk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d_year </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_customer_sk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_store_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> customer_total_return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> c_customer_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> customer_total_return </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> customer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_total_return </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctr_total_return</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> customer_total_return </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_store_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctr2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_store_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s_store_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_store_sk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s_state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;TN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_customer_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c_customer_sk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> c_customer_id </span><span class="token keyword" style="color:#00009f">ASC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Output:</p><p><img loading="lazy" src="/assets/images/boxcnbHJgX6mTV1MHFyLXajy23f-c0effcd2819edf7d1bb23755d9527e39.png" width="2008" height="1712" class="img_astN"></p><ol start="2"><li>Explain analyze + SQL</li></ol><div class="language-sql codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-sql codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ANALYZE</span><span class="token plain"> LOGICAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> customer_total_return </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_customer_sk </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr_customer_sk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_store_sk </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr_store_sk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sr_return_amt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr_total_return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> store_returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> date_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sr_returned_date_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> d_date_sk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d_year </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_customer_sk</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sr_store_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> c_customer_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> customer_total_return </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> customer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_total_return </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">avg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctr_total_return</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> customer_total_return </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> ctr2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_store_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctr2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_store_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s_store_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_store_sk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s_state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;TN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctr1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctr_customer_sk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> c_customer_sk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> c_customer_id </span><span class="token keyword" style="color:#00009f">ASC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">┌─Explain Analyze──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ Limit                                                                                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │     Est. 100 rows, cost 8.2e+05                                                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │     Act. 100 rows (2.4 KB), Throughput: 545.0K rows/s, CPU Time per worker: avg 2.0 us, max 2.0 us, Wall Time: 1.8 ms                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ │     Filtered: 0.0%, QError: 1.0                                                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └─ MergeSorting                                                                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │     Est. 49.2K rows, cost 8.2e+05                                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │     Act. 100 rows (2.4 KB), Throughput: 545.0K rows/s, CPU Time per worker: avg 2.0 us, max 2.0 us, Wall Time: 1.8 ms                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │     Filtered: 96.9%, QError: 504.1                                                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    └─ Union                                                                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │     Est. 49.2K rows, cost 8.2e+05                                                                                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │     Act. 3.1K rows (78.1 KB), Throughput: 17.0M rows/s, CPU Time per worker: avg 0.0 us, max 0.0 us, Wall Time: 1.8 ms                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │     Filtered: 0.0%, QError: 15.8                                                                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └─ PartialSorting                                                                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          │     Est. 49.2K rows, cost 8.2e+05                                                                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          │     Act. 3.1K rows (78.1 KB), Throughput: 17.0M rows/s, CPU Time per worker: avg 40.0 us, max 40.0 us, Wall Time: 1.8 ms                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          │     Filtered: 0.0%, QError: 15.8                                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          └─ Gather Exchange                                                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     Est. 49.2K rows, cost 8.2e+05                                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             └─ MergeSorting                                                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │     Est. 49.2K rows, cost 8.1e+05                                                                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │     Act. 12.5K rows (313.1 KB), Throughput: 108.2M rows/s, CPU Time per worker: avg 23.0 us, max 25.0 us, Wall Time: 1.2 ms                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │     Filtered: -1.6%, QError: 3.9                                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                └─ PartialSorting                                                                                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   │     Est. 49.2K rows, cost 8.1e+05                                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   │     Act. 12.3K rows (308.3 KB), Throughput: 91.6M rows/s, CPU Time per worker: avg 40.0 us, max 40.0 us, Wall Time: 1.3 ms                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   │     Filtered: 0.0%, QError: 4.0                                                                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   └─ Inner Join                                                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Est. 47.5K rows, cost 8.1e+05                                                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Act. 12.3K rows (308.3 KB), Throughput: 91.6M rows/s, CPU Time per worker: avg 41.6 ms, max 41.8 ms, Wall Time: 1.3 ms                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Filtered: 0.0%, QError: 3.9                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Condition: sr_store_sk_1 == s_store_sk                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Filter: `sum(sr_return_amt)_1` &gt; (`avg(ctr_total_return)` * 1.2)                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      ├─ Local Exchange                                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │  │     Est. 49.2K rows, cost 2.9e+05                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │  └─ Inner Join                                                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │     Est. 49.2K rows, cost 2.9e+05                                                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │     Act. 49.3K rows (2.1 MB), Throughput: 542.3M rows/s, CPU Time per worker: avg 6.2 ms, max 6.4 ms, Wall Time: 896.0 us               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │     Filtered: 0.0%, QError: 1.0                                                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │     Condition: c_customer_sk == sr_customer_sk_1                                                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     ├─ Repartition Exchange                                                                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │  │     Est. 97.7K rows, cost 9.0e+04                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │  │     Partition by: {c_customer_sk}                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │  └─ ReadFromStorage tpcds.customer                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │           Est. 97.7K rows, cost 7.4e+04                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │           Act. 97.7K rows (3.1 MB), Throughput: 22.2G rows/s, CPU Time per worker: avg 362.0 us, max 402.0 us, Wall Time: 47.0 us       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     │           Filtered: 0.0%, QError: 1.0                                                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     └─ Repartition Exchange                                                                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │        │     Est. 50.9K rows, cost 6.1e+04                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │        │     Partition by: {sr_customer_sk_1}                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │        └─ CTERef [0]                                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │                 Est. 50.9K rows, cost 5.2e+04                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      └─ Broadcast Exchange                                                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         │     Est. 7 rows, cost 5.6e+04                                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                         └─ Inner Join                                                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     Est. 7 rows, cost 5.6e+04                                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     Act. 6 rows (102.0 Bytes), Throughput: 67.7K rows/s, CPU Time per worker: avg 280.0 us, max 360.0 us, Wall Time: 870.0 us           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     Filtered: 97.9%, QError: 1.2                                                                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     Condition: s_store_sk == sr_store_sk_2                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            ├─ Repartition Exchange                                                                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │  │     Est. 12 rows, cost 1.2e+01                                                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │  │     Partition by: {s_store_sk}                                                                                                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │  └─ Filter                                                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     │     Est. 12 rows, cost 9.8e+00                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     │     Act. 12 rows (240.0 Bytes), Throughput: 28.6M rows/s, CPU Time per worker: avg 16.0 us, max 24.0 us, Wall Time: 5.0 us        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     │     Filtered: 0.0%, QError: 1.0                                                                                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     │     s_state = &#x27;TN&#x27;                                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │     └─ ReadFromStorage tpcds.store                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │              Est. 12 rows, cost 8.9e+00                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │              Act. 12 rows (240.0 Bytes), Throughput: 28.6M rows/s, CPU Time per worker: avg 48.0 us, max 72.0 us, Wall Time: 4.0 us     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            │              Filtered: 0.0%, QError: 1.0                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                            └─ MergingAggregated                                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               │     Est. 6 rows, cost 5.6e+04                                                                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               │     Act. 280 rows (4.9 KB), Throughput: 3.1M rows/s, CPU Time per worker: avg 60.0 us, max 80.0 us, Wall Time: 867.0 us              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               │     Filtered: 0.0%, QError: 46.7                                                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               └─ Repartition Exchange                                                                                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                  │     Est. 6 rows, cost 5.6e+04                                                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                  │     Partition by: {sr_store_sk_2}                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                  └─ Aggregating                                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                     │     Est. 6 rows, cost 5.6e+04                                                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                     │     Act. 14 rows (238.0 Bytes), Throughput: 145.6K rows/s, CPU Time per worker: avg 7.0 us, max 9.0 us, Wall Time: 955.0 us    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                     │     Filtered: 100.0%, QError: 2.3                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                     │     Group by: {sr_store_sk_2}                                                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                     └─ Projection                                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        │     Est. 50.9K rows, cost 5.6e+04                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        │     Act. 49.3K rows (887.4 KB), Throughput: 519.5M rows/s, CPU Time per worker: avg 0.0 us, max 0.0 us, Wall Time: 947.0 us │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        │     Filtered: 0.0%, QError: 1.0                                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                        └─ CTERef [0]                                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                 Est. 50.9K rows, cost 5.2e+04                                                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ CTEDef [0]                                                                                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    MergingAggregated                                                                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │     Est. 50.9K rows, cost 4.3e+05                                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │     Act. 49.3K rows (1.3 MB), Throughput: 497.5M rows/s, CPU Time per worker: avg 34.0 us, max 35.0 us, Wall Time: 996.0 us                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    │     Filtered: 0.0%, QError: 1.0                                                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    └─ Repartition Exchange                                                                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │     Est. 50.9K rows, cost 4.3e+05                                                                                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       │     Partition by: {sr_customer_sk, sr_store_sk}                                                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └─ Aggregating                                                                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          │     Est. 50.9K rows, cost 4.2e+05                                                                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          │     Act. 51.4K rows (1.3 MB), Throughput: 1.1G rows/s, CPU Time per worker: avg 27.0 us, max 28.0 us, Wall Time: 506.0 us                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          │     Filtered: 5.8%, QError: 1.0                                                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          │     Group by: {sr_customer_sk, sr_store_sk}                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│          └─ Inner Join                                                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     Est. 50.9K rows, cost 4.2e+05                                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     Act. 54.5K rows (1.4 MB), Throughput: 1.2G rows/s, CPU Time per worker: avg 14.3 ms, max 15.0 ms, Wall Time: 477.0 us                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     Filtered: -90.6%, QError: 1.1                                                                                                                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     Condition: sr_returned_date_sk == d_date_sk                                                                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             ├─ Local Exchange                                                                                                                                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │  │     Est. 280.8K rows, cost 2.3e+05                                                                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │  └─ Filter                                                                                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     │     Est. 280.8K rows, cost 2.3e+05                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     │     Act. 54.5K rows (1.9 MB), Throughput: 5.7G rows/s, CPU Time per worker: avg 865.0 us, max 885.0 us, Wall Time: 96.0 us                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     │     Filtered: 0.0%, QError: 5.2                                                                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     │     Dynamic Filters: {sr_returned_date_sk:range}                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │     └─ ReadFromStorage tpcds.store_returns                                                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │              Est. 280.8K rows, cost 2.1e+05                                                                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │              Act. 54.5K rows (1.9 MB), Throughput: 5.8G rows/s, CPU Time per worker: avg 2.4 ms, max 2.4 ms, Wall Time: 95.0 us                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             │              Filtered: 0.0%, QError: 5.2                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│             └─ Projection                                                                                                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │     Est. 366 rows, cost 6.0e+04                                                                                                                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │     Act. 28.6K rows (228.8 KB), Throughput: 45.4G rows/s, CPU Time per worker: avg 1.1 ms, max 1.3 ms, Wall Time: 7.0 us                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │     Filtered: 0.0%, QError: 80.0                                                                                                                    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                │     Dynamic Filters Builder: {d_date_sk}                                                                                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                └─ Broadcast Exchange                                                                                                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   │     Est. 366 rows, cost 6.0e+04                                                                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                   └─ Filter                                                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Est. 366 rows, cost 5.9e+04                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Act. 366 rows (6.1 KB), Throughput: 85.1M rows/s, CPU Time per worker: avg 282.0 us, max 283.0 us, Wall Time: 44.0 us                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     Filtered: 0.0%, QError: 1.0                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │     d_year = 2000                                                                                                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      └─ ReadFromStorage tpcds.date_dim                                                                                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               Est. 71.3K rows, cost 5.4e+04                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               Act. 366 rows (6.1 KB), Throughput: 85.1M rows/s, CPU Time per worker: avg 780.0 us, max 840.0 us, Wall Time: 43.0 us                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               Filtered: 0.0%, QError: 199.6                                                                                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ note: Dynamic Filter is applied for 1 times.                                                                                                                         │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ note: CTE(Common Table Expression) is applied for 2 times.                                                                                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Explain analyze distributed + SQL</li></ol><div class="codeBlockContainer_Dtwu theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_sgmo"><pre tabindex="0" class="prism-code language-text codeBlock_zjcW thin-scrollbar"><code class="codeBlockLines_u4eB"><span class="token-line" style="color:#393A34"><span class="token plain">EXPLAIN ANALYZE DISTRIBUTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    i_item_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avg(ss_quantity) AS agg1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avg(ss_list_price) AS agg2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avg(ss_coupon_amt) AS agg3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avg(ss_sales_price) AS agg4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM store_sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">, customer_demographics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">, date_dim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">, item</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">, promotion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE (ss_sold_date_sk = d_date_sk) AND (ss_item_sk = i_item_sk) AND (ss_cdemo_sk = cd_demo_sk) AND (ss_promo_sk = p_promo_sk) AND (cd_gender = &#x27;M&#x27;) AND (cd_marital_status = &#x27;S&#x27;) AND (cd_education_status = &#x27;College&#x27;) AND ((p_channel_email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> = &#x27;N&#x27;) OR (p_channel_event = &#x27;N&#x27;)) AND (d_year = 2000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GROUP BY i_item_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORDER BY i_item_id ASC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LIMIT 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_uzaf"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MWsZ" aria-hidden="true"><svg class="copyButtonIcon_utg0" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_YlgY" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Output：
<img loading="lazy" src="/assets/images/boxcnxiwhbhVnUQkflLLELMblMb-53e97bb3ff821485ece57e29df406c24.png" width="2290" height="1694" class="img_astN"></p><p>Notes:</p><ul><li>QError: This is calculated as max(Est rows, Act rows) / min(Est rows, Act rows), where a value of 1 is optimal.</li><li>Wall Time: This refers to the maximum wall clock time among all the worker nodes. We can use this to identify which step took the longest time.</li><li>CPU Time: By analyzing CPU time, we can detect data skew issues. If the maximum time is significantly greater than the average time, it indicates that one worker node is processing a disproportionate amount of data.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_HAaO padding--none margin-left--sm"><li class="tag_Ut5_"><a class="tag_sQub tagRegular_dfhI" href="/docs/tags/docs">Docs</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ByConity/byconity.github.io/tree/main/docs/query-optimization/query-optimizer.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_O9Og" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_DEFe"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/data-lakes/hive-external-catalog"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">External Catalog</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/query-optimization/query-optimization-with-cache-preload"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cache Preload</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Q7NC thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#commands-for-collecting-displaying-and-deleting-statistical-information" class="table-of-contents__link toc-highlight">Commands for Collecting, Displaying, and Deleting Statistical Information</a><ul><li><a href="#syntax-definition" class="table-of-contents__link toc-highlight">Syntax Definition:</a></li><li><a href="#collecting-statistical-information" class="table-of-contents__link toc-highlight">Collecting Statistical Information</a></li><li><a href="#displaying-statistical-information" class="table-of-contents__link toc-highlight">Displaying Statistical Information</a></li><li><a href="#deleting-statistical-information" class="table-of-contents__link toc-highlight">Deleting Statistical Information</a></li></ul></li><li><a href="#using-explain" class="table-of-contents__link toc-highlight">Using Explain</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row"><div class="col col--3"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_DeRy themedImage--light_hbln footer__logo"><img src="/img/footer-logo.svg" alt="ByConity" class="themedImage_DeRy themedImage--dark_qgR1 footer__logo"></div><div class="col"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/main-principle-concepts">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community">Community</a></li><li class="footer__item"><a class="footer__link-item" href="/users">Users</a></li><li class="footer__item"><a href="https://space.bilibili.com/2065226922?spm_id_from=333.1007.0.0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_LBPb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ByConity/ByConity" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_LBPb"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ByteDance.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.488d2ad2.js"></script>
<script src="/assets/js/main.51896293.js"></script>
</body>
</html>